(function(){"use strict";class SimulationEngine{model;state;params;snapshots=[];onSnapshot;snapshotInterval;constructor(t){this.model=t.model,this.params=t.params,this.onSnapshot=t.onSnapshot,this.snapshotInterval=t.snapshotInterval??1,this.init()}init(){this.state=this.model.init(this.params),this.snapshots=[],this.recordSnapshot()}step(){let t=1;const r=this.params;r.general&&typeof r.general.dt=="number"&&(t=r.general.dt),this.state=this.model.step(this.state,t,this.params);const n=this.state;(typeof n.step_count=="number"?n.step_count:this.snapshots.length)%this.snapshotInterval===0&&this.recordSnapshot()}isComplete(){const t=this.params,r=this.state;return t.general&&typeof t.general.t_end=="number"&&typeof r.t=="number"?r.t>=t.general.t_end:!1}getState(){return this.state}getParams(){return this.params}resetWithParams(t){this.params=t,this.init()}recordSnapshot(){const t=this.model.getSnapshot(this.state);this.snapshots.push(t),this.onSnapshot&&this.onSnapshot(t)}getStats(){return this.model.computeStats(this.state,this.params)}}function parseVersion(e){const t=e.split(".").map(Number);return{major:t[0]||0,minor:t[1]||0,patch:t[2]||0}}function compareVersions(e,t){return e.major!==t.major?e.major-t.major:e.minor!==t.minor?e.minor-t.minor:e.patch-t.patch}function isCompatible(e,t){return e.major===t.major&&compareVersions(e,t)>=0}function formatVersion(e){return`${e.major}.${e.minor}.${e.patch}`}class ModelRegistry{models=new Map;defaultModelName=null;constructor(){console.log("[Registry] Initializing")}register(t){const r=parseVersion(t.version),n=formatVersion(r),s=t;if(!this.models.has(t.id))this.models.set(t.id,{latestModel:s,versions:new Map([[n,s]])}),console.log(`[Registry] Registered new model: ${t.id} (v${n})`);else{const i=this.models.get(t.id);i.versions.set(n,s);const o=parseVersion(i.latestModel.version);(r.major>o.major||r.major===o.major&&r.minor>o.minor||r.major===o.major&&r.minor===o.minor&&r.patch>o.patch)&&(i.latestModel=s,console.log(`[Registry] Updated model ${t.id} to version ${n}`))}}setDefault(t){if(!this.models.has(t))throw new Error(`Cannot set default: model "${t}" is not registered`);this.defaultModelName=t}get(t){return this.models.get(t)?.latestModel}getVersion(t,r){return this.models.get(t)?.versions.get(r)}getModelNames(){return Array.from(this.models.keys())}getVersions(t){const r=this.models.get(t);return r?Array.from(r.versions.keys()):[]}getDefault(){return this.defaultModelName?this.get(this.defaultModelName):void 0}getDefaultName(){return this.defaultModelName}findCompatibleModel(t){const r=this.models.get(t.model);if(!r)return;const n=parseVersion(t.version);let s,i;for(const[o,c]of r.versions){const a=parseVersion(o);isCompatible(a,n)&&(!i||a.minor>i.minor||a.minor===i.minor&&a.patch>i.patch)&&(s=c,i=a)}return s}has(t){return this.models.has(t)}getAll(){return Array.from(this.models.values()).map(t=>t.latestModel)}}const modelRegistry=new ModelRegistry,DEFAULT_CONTROL_CELL={N_init:25,location:"",R_hard:.4,R_hard_div:.7,R_soft:1.2,color:{r:30,g:100,b:20},dur_G2:.5,dur_mitosis:.5,k_apical_junction:5,k_cytos:5,max_cytoskeleton_length:.5,run:0,running_speed:1,running_mode:0,stiffness_apical_apical:2,stiffness_apical_apical_div:4,stiffness_nuclei_apical:3,stiffness_nuclei_basal:2,stiffness_repulsion:2,stiffness_straightness:5,lifespan_start:5.5,lifespan_end:6.5,INM:0,hetero:!1,events:{time_A_start:1/0,time_A_end:1/0,time_B_start:1/0,time_B_end:1/0,time_S_start:1/0,time_S_end:1/0,time_P_start:1/0,time_P_end:1/0},diffusion:.2,basal_damping_ratio:1,max_basal_junction_dist:4,cytos_init:0,basal_membrane_repulsion:0,apical_junction_init:0},DEFAULT_EMT_CELL={N_init:5,location:"bottom",R_hard:.4,R_hard_div:.7,R_soft:1.2,color:{r:128,g:0,b:128},dur_G2:.5,dur_mitosis:.5,k_apical_junction:1,k_cytos:5,max_cytoskeleton_length:.5,run:0,running_speed:1,running_mode:0,stiffness_apical_apical:2,stiffness_apical_apical_div:4,stiffness_nuclei_apical:3,stiffness_nuclei_basal:2,stiffness_repulsion:4,stiffness_straightness:2,lifespan_start:5.5,lifespan_end:6.5,INM:0,hetero:!0,events:{time_A_start:3,time_A_end:12,time_B_start:3,time_B_end:12,time_S_start:1/0,time_S_end:1/0,time_P_start:1/0,time_P_end:1/0},diffusion:.2,basal_damping_ratio:1,max_basal_junction_dist:4,cytos_init:0,basal_membrane_repulsion:0,apical_junction_init:0},DEFAULT_EHT_PARAMS={metadata:{model:"EHT",version:"1.0.0"},general:{t_end:48,dt:.1,random_seed:0,full_circle:!0,w_init:80,h_init:5,mu:.2,n_substeps:30,alg_dt:.01,w_screen:50,h_screen:25,p_div_out:1,perimeter:105,aspect_ratio:1,hard_sphere_nuclei:!1},cell_prop:{},cell_types:{control:DEFAULT_CONTROL_CELL,emt:DEFAULT_EMT_CELL}};function $constructor(e,t,r){function n(c,a){if(c._zod||Object.defineProperty(c,"_zod",{value:{def:a,constr:o,traits:new Set},enumerable:!1}),c._zod.traits.has(e))return;c._zod.traits.add(e),t(c,a);const u=o.prototype,l=Object.keys(u);for(let h=0;h<l.length;h++){const f=l[h];f in c||(c[f]=u[f].bind(c))}}const s=r?.Parent??Object;class i extends s{}Object.defineProperty(i,"name",{value:e});function o(c){var a;const u=r?.Parent?new i:this;n(u,c),(a=u._zod).deferred??(a.deferred=[]);for(const l of u._zod.deferred)l();return u}return Object.defineProperty(o,"init",{value:n}),Object.defineProperty(o,Symbol.hasInstance,{value:c=>r?.Parent&&c instanceof r.Parent?!0:c?._zod?.traits?.has(e)}),Object.defineProperty(o,"name",{value:e}),o}class $ZodAsyncError extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class $ZodEncodeError extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const globalConfig={};function config(e){return globalConfig}function getEnumValues(e){const t=Object.values(e).filter(n=>typeof n=="number");return Object.entries(e).filter(([n,s])=>t.indexOf(+n)===-1).map(([n,s])=>s)}function jsonStringifyReplacer(e,t){return typeof t=="bigint"?t.toString():t}function cached(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function nullish(e){return e==null}function cleanRegex(e){const t=e.startsWith("^")?1:0,r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}function floatSafeRemainder(e,t){const r=(e.toString().split(".")[1]||"").length,n=t.toString();let s=(n.split(".")[1]||"").length;if(s===0&&/\d?e-\d?/.test(n)){const a=n.match(/\d?e-(\d?)/);a?.[1]&&(s=Number.parseInt(a[1]))}const i=r>s?r:s,o=Number.parseInt(e.toFixed(i).replace(".","")),c=Number.parseInt(t.toFixed(i).replace(".",""));return o%c/10**i}const EVALUATING=Symbol("evaluating");function defineLazy(e,t,r){let n;Object.defineProperty(e,t,{get(){if(n!==EVALUATING)return n===void 0&&(n=EVALUATING,n=r()),n},set(s){Object.defineProperty(e,t,{value:s})},configurable:!0})}function assignProp(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function mergeDefs(...e){const t={};for(const r of e){const n=Object.getOwnPropertyDescriptors(r);Object.assign(t,n)}return Object.defineProperties({},t)}function esc(e){return JSON.stringify(e)}function slugify(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const captureStackTrace="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function isObject(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const allowsEval=cached(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function isPlainObject(e){if(isObject(e)===!1)return!1;const t=e.constructor;if(t===void 0||typeof t!="function")return!0;const r=t.prototype;return!(isObject(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function shallowClone(e){return isPlainObject(e)?{...e}:Array.isArray(e)?[...e]:e}const propertyKeyTypes=new Set(["string","number","symbol"]);function escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function clone(e,t,r){const n=new e._zod.constr(t??e._zod.def);return(!t||r?.parent)&&(n._zod.parent=e),n}function normalizeParams(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function optionalKeys(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const NUMBER_FORMAT_RANGES={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function pick(e,t){const r=e._zod.def,n=r.checks;if(n&&n.length>0)throw new Error(".pick() cannot be used on object schemas containing refinements");const i=mergeDefs(e._zod.def,{get shape(){const o={};for(const c in t){if(!(c in r.shape))throw new Error(`Unrecognized key: "${c}"`);t[c]&&(o[c]=r.shape[c])}return assignProp(this,"shape",o),o},checks:[]});return clone(e,i)}function omit(e,t){const r=e._zod.def,n=r.checks;if(n&&n.length>0)throw new Error(".omit() cannot be used on object schemas containing refinements");const i=mergeDefs(e._zod.def,{get shape(){const o={...e._zod.def.shape};for(const c in t){if(!(c in r.shape))throw new Error(`Unrecognized key: "${c}"`);t[c]&&delete o[c]}return assignProp(this,"shape",o),o},checks:[]});return clone(e,i)}function extend(e,t){if(!isPlainObject(t))throw new Error("Invalid input to extend: expected a plain object");const r=e._zod.def.checks;if(r&&r.length>0){const i=e._zod.def.shape;for(const o in t)if(Object.getOwnPropertyDescriptor(i,o)!==void 0)throw new Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}const s=mergeDefs(e._zod.def,{get shape(){const i={...e._zod.def.shape,...t};return assignProp(this,"shape",i),i}});return clone(e,s)}function safeExtend(e,t){if(!isPlainObject(t))throw new Error("Invalid input to safeExtend: expected a plain object");const r=mergeDefs(e._zod.def,{get shape(){const n={...e._zod.def.shape,...t};return assignProp(this,"shape",n),n}});return clone(e,r)}function merge(e,t){const r=mergeDefs(e._zod.def,{get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return assignProp(this,"shape",n),n},get catchall(){return t._zod.def.catchall},checks:[]});return clone(e,r)}function partial(e,t,r){const s=t._zod.def.checks;if(s&&s.length>0)throw new Error(".partial() cannot be used on object schemas containing refinements");const o=mergeDefs(t._zod.def,{get shape(){const c=t._zod.def.shape,a={...c};if(r)for(const u in r){if(!(u in c))throw new Error(`Unrecognized key: "${u}"`);r[u]&&(a[u]=e?new e({type:"optional",innerType:c[u]}):c[u])}else for(const u in c)a[u]=e?new e({type:"optional",innerType:c[u]}):c[u];return assignProp(this,"shape",a),a},checks:[]});return clone(t,o)}function required(e,t,r){const n=mergeDefs(t._zod.def,{get shape(){const s=t._zod.def.shape,i={...s};if(r)for(const o in r){if(!(o in i))throw new Error(`Unrecognized key: "${o}"`);r[o]&&(i[o]=new e({type:"nonoptional",innerType:s[o]}))}else for(const o in s)i[o]=new e({type:"nonoptional",innerType:s[o]});return assignProp(this,"shape",i),i}});return clone(t,n)}function aborted(e,t=0){if(e.aborted===!0)return!0;for(let r=t;r<e.issues.length;r++)if(e.issues[r]?.continue!==!0)return!0;return!1}function prefixIssues(e,t){return t.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(e),r})}function unwrapMessage(e){return typeof e=="string"?e:e?.message}function finalizeIssue(e,t,r){const n={...e,path:e.path??[]};if(!e.message){const s=unwrapMessage(e.inst?._zod.def?.error?.(e))??unwrapMessage(t?.error?.(e))??unwrapMessage(r.customError?.(e))??unwrapMessage(r.localeError?.(e))??"Invalid input";n.message=s}return delete n.inst,delete n.continue,t?.reportInput||delete n.input,n}function getLengthableOrigin(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function issue(...e){const[t,r,n]=e;return typeof t=="string"?{message:t,code:"custom",input:r,inst:n}:{...t}}const initializer$1=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,jsonStringifyReplacer,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},$ZodError=$constructor("$ZodError",initializer$1),$ZodRealError=$constructor("$ZodError",initializer$1,{Parent:Error});function flattenError(e,t=r=>r.message){const r={},n=[];for(const s of e.issues)s.path.length>0?(r[s.path[0]]=r[s.path[0]]||[],r[s.path[0]].push(t(s))):n.push(t(s));return{formErrors:n,fieldErrors:r}}function formatError(e,t=r=>r.message){const r={_errors:[]},n=s=>{for(const i of s.issues)if(i.code==="invalid_union"&&i.errors.length)i.errors.map(o=>n({issues:o}));else if(i.code==="invalid_key")n({issues:i.issues});else if(i.code==="invalid_element")n({issues:i.issues});else if(i.path.length===0)r._errors.push(t(i));else{let o=r,c=0;for(;c<i.path.length;){const a=i.path[c];c===i.path.length-1?(o[a]=o[a]||{_errors:[]},o[a]._errors.push(t(i))):o[a]=o[a]||{_errors:[]},o=o[a],c++}}};return n(e),r}const _parse=e=>(t,r,n,s)=>{const i=n?Object.assign(n,{async:!1}):{async:!1},o=t._zod.run({value:r,issues:[]},i);if(o instanceof Promise)throw new $ZodAsyncError;if(o.issues.length){const c=new(s?.Err??e)(o.issues.map(a=>finalizeIssue(a,i,config())));throw captureStackTrace(c,s?.callee),c}return o.value},_parseAsync=e=>async(t,r,n,s)=>{const i=n?Object.assign(n,{async:!0}):{async:!0};let o=t._zod.run({value:r,issues:[]},i);if(o instanceof Promise&&(o=await o),o.issues.length){const c=new(s?.Err??e)(o.issues.map(a=>finalizeIssue(a,i,config())));throw captureStackTrace(c,s?.callee),c}return o.value},_safeParse=e=>(t,r,n)=>{const s=n?{...n,async:!1}:{async:!1},i=t._zod.run({value:r,issues:[]},s);if(i instanceof Promise)throw new $ZodAsyncError;return i.issues.length?{success:!1,error:new(e??$ZodError)(i.issues.map(o=>finalizeIssue(o,s,config())))}:{success:!0,data:i.value}},safeParse$1=_safeParse($ZodRealError),_safeParseAsync=e=>async(t,r,n)=>{const s=n?Object.assign(n,{async:!0}):{async:!0};let i=t._zod.run({value:r,issues:[]},s);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new e(i.issues.map(o=>finalizeIssue(o,s,config())))}:{success:!0,data:i.value}},safeParseAsync$1=_safeParseAsync($ZodRealError),_encode=e=>(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return _parse(e)(t,r,s)},_decode=e=>(t,r,n)=>_parse(e)(t,r,n),_encodeAsync=e=>async(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return _parseAsync(e)(t,r,s)},_decodeAsync=e=>async(t,r,n)=>_parseAsync(e)(t,r,n),_safeEncode=e=>(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return _safeParse(e)(t,r,s)},_safeDecode=e=>(t,r,n)=>_safeParse(e)(t,r,n),_safeEncodeAsync=e=>async(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return _safeParseAsync(e)(t,r,s)},_safeDecodeAsync=e=>async(t,r,n)=>_safeParseAsync(e)(t,r,n),cuid=/^[cC][^\s-]{8,}$/,cuid2=/^[0-9a-z]+$/,ulid=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,xid=/^[0-9a-vA-V]{20}$/,ksuid=/^[A-Za-z0-9]{27}$/,nanoid=/^[a-zA-Z0-9_-]{21}$/,duration$1=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,guid=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,uuid=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,email=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,_emoji$1="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function emoji(){return new RegExp(_emoji$1,"u")}const ipv4=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,cidrv4=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,cidrv6=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,base64url=/^[A-Za-z0-9_-]*$/,e164=/^\+[1-9]\d{6,14}$/,dateSource="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",date$1=new RegExp(`^${dateSource}$`);function timeSource(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function time$1(e){return new RegExp(`^${timeSource(e)}$`)}function datetime$1(e){const t=timeSource({precision:e.precision}),r=["Z"];e.local&&r.push(""),e.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const n=`${t}(?:${r.join("|")})`;return new RegExp(`^${dateSource}T(?:${n})$`)}const string$1=e=>{const t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},integer=/^-?\d+$/,number$1=/^-?\d+(?:\.\d+)?$/,boolean$1=/^(?:true|false)$/i,lowercase=/^[^A-Z]*$/,uppercase=/^[^a-z]*$/,$ZodCheck=$constructor("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),numericOriginMap={number:"number",bigint:"bigint",object:"date"},$ZodCheckLessThan=$constructor("$ZodCheckLessThan",(e,t)=>{$ZodCheck.init(e,t);const r=numericOriginMap[typeof t.value];e._zod.onattach.push(n=>{const s=n._zod.bag,i=(t.inclusive?s.maximum:s.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<i&&(t.inclusive?s.maximum=t.value:s.exclusiveMaximum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value<=t.value:n.value<t.value)||n.issues.push({origin:r,code:"too_big",maximum:typeof t.value=="object"?t.value.getTime():t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),$ZodCheckGreaterThan=$constructor("$ZodCheckGreaterThan",(e,t)=>{$ZodCheck.init(e,t);const r=numericOriginMap[typeof t.value];e._zod.onattach.push(n=>{const s=n._zod.bag,i=(t.inclusive?s.minimum:s.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>i&&(t.inclusive?s.minimum=t.value:s.exclusiveMinimum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value>=t.value:n.value>t.value)||n.issues.push({origin:r,code:"too_small",minimum:typeof t.value=="object"?t.value.getTime():t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),$ZodCheckMultipleOf=$constructor("$ZodCheckMultipleOf",(e,t)=>{$ZodCheck.init(e,t),e._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=t.value)}),e._zod.check=r=>{if(typeof r.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%t.value===BigInt(0):floatSafeRemainder(r.value,t.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:t.value,input:r.value,inst:e,continue:!t.abort})}}),$ZodCheckNumberFormat=$constructor("$ZodCheckNumberFormat",(e,t)=>{$ZodCheck.init(e,t),t.format=t.format||"float64";const r=t.format?.includes("int"),n=r?"int":"number",[s,i]=NUMBER_FORMAT_RANGES[t.format];e._zod.onattach.push(o=>{const c=o._zod.bag;c.format=t.format,c.minimum=s,c.maximum=i,r&&(c.pattern=integer)}),e._zod.check=o=>{const c=o.value;if(r){if(!Number.isInteger(c)){o.issues.push({expected:n,format:t.format,code:"invalid_type",continue:!1,input:c,inst:e});return}if(!Number.isSafeInteger(c)){c>0?o.issues.push({input:c,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,inclusive:!0,continue:!t.abort}):o.issues.push({input:c,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,inclusive:!0,continue:!t.abort});return}}c<s&&o.issues.push({origin:"number",input:c,code:"too_small",minimum:s,inclusive:!0,inst:e,continue:!t.abort}),c>i&&o.issues.push({origin:"number",input:c,code:"too_big",maximum:i,inclusive:!0,inst:e,continue:!t.abort})}}),$ZodCheckMaxLength=$constructor("$ZodCheckMaxLength",(e,t)=>{var r;$ZodCheck.init(e,t),(r=e._zod.def).when??(r.when=n=>{const s=n.value;return!nullish(s)&&s.length!==void 0}),e._zod.onattach.push(n=>{const s=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<s&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const s=n.value;if(s.length<=t.maximum)return;const o=getLengthableOrigin(s);n.issues.push({origin:o,code:"too_big",maximum:t.maximum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),$ZodCheckMinLength=$constructor("$ZodCheckMinLength",(e,t)=>{var r;$ZodCheck.init(e,t),(r=e._zod.def).when??(r.when=n=>{const s=n.value;return!nullish(s)&&s.length!==void 0}),e._zod.onattach.push(n=>{const s=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>s&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const s=n.value;if(s.length>=t.minimum)return;const o=getLengthableOrigin(s);n.issues.push({origin:o,code:"too_small",minimum:t.minimum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),$ZodCheckLengthEquals=$constructor("$ZodCheckLengthEquals",(e,t)=>{var r;$ZodCheck.init(e,t),(r=e._zod.def).when??(r.when=n=>{const s=n.value;return!nullish(s)&&s.length!==void 0}),e._zod.onattach.push(n=>{const s=n._zod.bag;s.minimum=t.length,s.maximum=t.length,s.length=t.length}),e._zod.check=n=>{const s=n.value,i=s.length;if(i===t.length)return;const o=getLengthableOrigin(s),c=i>t.length;n.issues.push({origin:o,...c?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:n.value,inst:e,continue:!t.abort})}}),$ZodCheckStringFormat=$constructor("$ZodCheckStringFormat",(e,t)=>{var r,n;$ZodCheck.init(e,t),e._zod.onattach.push(s=>{const i=s._zod.bag;i.format=t.format,t.pattern&&(i.patterns??(i.patterns=new Set),i.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=s=>{t.pattern.lastIndex=0,!t.pattern.test(s.value)&&s.issues.push({origin:"string",code:"invalid_format",format:t.format,input:s.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(n=e._zod).check??(n.check=()=>{})}),$ZodCheckRegex=$constructor("$ZodCheckRegex",(e,t)=>{$ZodCheckStringFormat.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),$ZodCheckLowerCase=$constructor("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=lowercase),$ZodCheckStringFormat.init(e,t)}),$ZodCheckUpperCase=$constructor("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=uppercase),$ZodCheckStringFormat.init(e,t)}),$ZodCheckIncludes=$constructor("$ZodCheckIncludes",(e,t)=>{$ZodCheck.init(e,t);const r=escapeRegex(t.includes),n=new RegExp(typeof t.position=="number"?`^.{${t.position}}${r}`:r);t.pattern=n,e._zod.onattach.push(s=>{const i=s._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(n)}),e._zod.check=s=>{s.value.includes(t.includes,t.position)||s.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:s.value,inst:e,continue:!t.abort})}}),$ZodCheckStartsWith=$constructor("$ZodCheckStartsWith",(e,t)=>{$ZodCheck.init(e,t);const r=new RegExp(`^${escapeRegex(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const s=n._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),e._zod.check=n=>{n.value.startsWith(t.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:n.value,inst:e,continue:!t.abort})}}),$ZodCheckEndsWith=$constructor("$ZodCheckEndsWith",(e,t)=>{$ZodCheck.init(e,t);const r=new RegExp(`.*${escapeRegex(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const s=n._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),e._zod.check=n=>{n.value.endsWith(t.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:n.value,inst:e,continue:!t.abort})}}),$ZodCheckOverwrite=$constructor("$ZodCheckOverwrite",(e,t)=>{$ZodCheck.init(e,t),e._zod.check=r=>{r.value=t.tx(r.value)}});class Doc{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const n=t.split(`
`).filter(o=>o),s=Math.min(...n.map(o=>o.length-o.trimStart().length)),i=n.map(o=>o.slice(s)).map(o=>" ".repeat(this.indent*2)+o);for(const o of i)this.content.push(o)}compile(){const t=Function,r=this?.args,s=[...(this?.content??[""]).map(i=>`  ${i}`)];return new t(...r,s.join(`
`))}}const version={major:4,minor:3,patch:5},$ZodType=$constructor("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=version;const n=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&n.unshift(e);for(const s of n)for(const i of s._zod.onattach)i(e);if(n.length===0)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const s=(o,c,a)=>{let u=aborted(o),l;for(const h of c){if(h._zod.def.when){if(!h._zod.def.when(o))continue}else if(u)continue;const f=o.issues.length,p=h._zod.check(o);if(p instanceof Promise&&a?.async===!1)throw new $ZodAsyncError;if(l||p instanceof Promise)l=(l??Promise.resolve()).then(async()=>{await p,o.issues.length!==f&&(u||(u=aborted(o,f)))});else{if(o.issues.length===f)continue;u||(u=aborted(o,f))}}return l?l.then(()=>o):o},i=(o,c,a)=>{if(aborted(o))return o.aborted=!0,o;const u=s(c,n,a);if(u instanceof Promise){if(a.async===!1)throw new $ZodAsyncError;return u.then(l=>e._zod.parse(l,a))}return e._zod.parse(u,a)};e._zod.run=(o,c)=>{if(c.skipChecks)return e._zod.parse(o,c);if(c.direction==="backward"){const u=e._zod.parse({value:o.value,issues:[]},{...c,skipChecks:!0});return u instanceof Promise?u.then(l=>i(l,o,c)):i(u,o,c)}const a=e._zod.parse(o,c);if(a instanceof Promise){if(c.async===!1)throw new $ZodAsyncError;return a.then(u=>s(u,n,c))}return s(a,n,c)}}defineLazy(e,"~standard",()=>({validate:s=>{try{const i=safeParse$1(e,s);return i.success?{value:i.data}:{issues:i.error?.issues}}catch{return safeParseAsync$1(e,s).then(o=>o.success?{value:o.data}:{issues:o.error?.issues})}},vendor:"zod",version:1}))}),$ZodString=$constructor("$ZodString",(e,t)=>{$ZodType.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??string$1(e._zod.bag),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),$ZodStringFormat=$constructor("$ZodStringFormat",(e,t)=>{$ZodCheckStringFormat.init(e,t),$ZodString.init(e,t)}),$ZodGUID=$constructor("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=guid),$ZodStringFormat.init(e,t)}),$ZodUUID=$constructor("$ZodUUID",(e,t)=>{if(t.version){const n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(n===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=uuid(n))}else t.pattern??(t.pattern=uuid());$ZodStringFormat.init(e,t)}),$ZodEmail=$constructor("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=email),$ZodStringFormat.init(e,t)}),$ZodURL=$constructor("$ZodURL",(e,t)=>{$ZodStringFormat.init(e,t),e._zod.check=r=>{try{const n=r.value.trim(),s=new URL(n);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(s.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(s.protocol.endsWith(":")?s.protocol.slice(0,-1):s.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort})),t.normalize?r.value=s.href:r.value=n;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),$ZodEmoji=$constructor("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=emoji()),$ZodStringFormat.init(e,t)}),$ZodNanoID=$constructor("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=nanoid),$ZodStringFormat.init(e,t)}),$ZodCUID=$constructor("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=cuid),$ZodStringFormat.init(e,t)}),$ZodCUID2=$constructor("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=cuid2),$ZodStringFormat.init(e,t)}),$ZodULID=$constructor("$ZodULID",(e,t)=>{t.pattern??(t.pattern=ulid),$ZodStringFormat.init(e,t)}),$ZodXID=$constructor("$ZodXID",(e,t)=>{t.pattern??(t.pattern=xid),$ZodStringFormat.init(e,t)}),$ZodKSUID=$constructor("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=ksuid),$ZodStringFormat.init(e,t)}),$ZodISODateTime=$constructor("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=datetime$1(t)),$ZodStringFormat.init(e,t)}),$ZodISODate=$constructor("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=date$1),$ZodStringFormat.init(e,t)}),$ZodISOTime=$constructor("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=time$1(t)),$ZodStringFormat.init(e,t)}),$ZodISODuration=$constructor("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=duration$1),$ZodStringFormat.init(e,t)}),$ZodIPv4=$constructor("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=ipv4),$ZodStringFormat.init(e,t),e._zod.bag.format="ipv4"}),$ZodIPv6=$constructor("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=ipv6),$ZodStringFormat.init(e,t),e._zod.bag.format="ipv6",e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),$ZodCIDRv4=$constructor("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=cidrv4),$ZodStringFormat.init(e,t)}),$ZodCIDRv6=$constructor("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=cidrv6),$ZodStringFormat.init(e,t),e._zod.check=r=>{const n=r.value.split("/");try{if(n.length!==2)throw new Error;const[s,i]=n;if(!i)throw new Error;const o=Number(i);if(`${o}`!==i)throw new Error;if(o<0||o>128)throw new Error;new URL(`http://[${s}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function isValidBase64(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const $ZodBase64=$constructor("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=base64),$ZodStringFormat.init(e,t),e._zod.bag.contentEncoding="base64",e._zod.check=r=>{isValidBase64(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}});function isValidBase64URL(e){if(!base64url.test(e))return!1;const t=e.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=t.padEnd(Math.ceil(t.length/4)*4,"=");return isValidBase64(r)}const $ZodBase64URL=$constructor("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=base64url),$ZodStringFormat.init(e,t),e._zod.bag.contentEncoding="base64url",e._zod.check=r=>{isValidBase64URL(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),$ZodE164=$constructor("$ZodE164",(e,t)=>{t.pattern??(t.pattern=e164),$ZodStringFormat.init(e,t)});function isValidJWT(e,t=null){try{const r=e.split(".");if(r.length!==3)return!1;const[n]=r;if(!n)return!1;const s=JSON.parse(atob(n));return!("typ"in s&&s?.typ!=="JWT"||!s.alg||t&&(!("alg"in s)||s.alg!==t))}catch{return!1}}const $ZodJWT=$constructor("$ZodJWT",(e,t)=>{$ZodStringFormat.init(e,t),e._zod.check=r=>{isValidJWT(r.value,t.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),$ZodNumber=$constructor("$ZodNumber",(e,t)=>{$ZodType.init(e,t),e._zod.pattern=e._zod.bag.pattern??number$1,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=Number(r.value)}catch{}const s=r.value;if(typeof s=="number"&&!Number.isNaN(s)&&Number.isFinite(s))return r;const i=typeof s=="number"?Number.isNaN(s)?"NaN":Number.isFinite(s)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:s,inst:e,...i?{received:i}:{}}),r}}),$ZodNumberFormat=$constructor("$ZodNumberFormat",(e,t)=>{$ZodCheckNumberFormat.init(e,t),$ZodNumber.init(e,t)}),$ZodBoolean=$constructor("$ZodBoolean",(e,t)=>{$ZodType.init(e,t),e._zod.pattern=boolean$1,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=!!r.value}catch{}const s=r.value;return typeof s=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:s,inst:e}),r}}),$ZodUnknown=$constructor("$ZodUnknown",(e,t)=>{$ZodType.init(e,t),e._zod.parse=r=>r}),$ZodNever=$constructor("$ZodNever",(e,t)=>{$ZodType.init(e,t),e._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:e}),r)});function handleArrayResult(e,t,r){e.issues.length&&t.issues.push(...prefixIssues(r,e.issues)),t.value[r]=e.value}const $ZodArray=$constructor("$ZodArray",(e,t)=>{$ZodType.init(e,t),e._zod.parse=(r,n)=>{const s=r.value;if(!Array.isArray(s))return r.issues.push({expected:"array",code:"invalid_type",input:s,inst:e}),r;r.value=Array(s.length);const i=[];for(let o=0;o<s.length;o++){const c=s[o],a=t.element._zod.run({value:c,issues:[]},n);a instanceof Promise?i.push(a.then(u=>handleArrayResult(u,r,o))):handleArrayResult(a,r,o)}return i.length?Promise.all(i).then(()=>r):r}});function handlePropertyResult(e,t,r,n,s){if(e.issues.length){if(s&&!(r in n))return;t.issues.push(...prefixIssues(r,e.issues))}e.value===void 0?r in n&&(t.value[r]=void 0):t.value[r]=e.value}function normalizeDef(e){const t=Object.keys(e.shape);for(const n of t)if(!e.shape?.[n]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${n}": expected a Zod schema`);const r=optionalKeys(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(r)}}function handleCatchall(e,t,r,n,s,i){const o=[],c=s.keySet,a=s.catchall._zod,u=a.def.type,l=a.optout==="optional";for(const h in t){if(c.has(h))continue;if(u==="never"){o.push(h);continue}const f=a.run({value:t[h],issues:[]},n);f instanceof Promise?e.push(f.then(p=>handlePropertyResult(p,r,h,t,l))):handlePropertyResult(f,r,h,t,l)}return o.length&&r.issues.push({code:"unrecognized_keys",keys:o,input:t,inst:i}),e.length?Promise.all(e).then(()=>r):r}const $ZodObject=$constructor("$ZodObject",(e,t)=>{if($ZodType.init(e,t),!Object.getOwnPropertyDescriptor(t,"shape")?.get){const c=t.shape;Object.defineProperty(t,"shape",{get:()=>{const a={...c};return Object.defineProperty(t,"shape",{value:a}),a}})}const n=cached(()=>normalizeDef(t));defineLazy(e._zod,"propValues",()=>{const c=t.shape,a={};for(const u in c){const l=c[u]._zod;if(l.values){a[u]??(a[u]=new Set);for(const h of l.values)a[u].add(h)}}return a});const s=isObject,i=t.catchall;let o;e._zod.parse=(c,a)=>{o??(o=n.value);const u=c.value;if(!s(u))return c.issues.push({expected:"object",code:"invalid_type",input:u,inst:e}),c;c.value={};const l=[],h=o.shape;for(const f of o.keys){const p=h[f],m=p._zod.optout==="optional",b=p._zod.run({value:u[f],issues:[]},a);b instanceof Promise?l.push(b.then(T=>handlePropertyResult(T,c,f,u,m))):handlePropertyResult(b,c,f,u,m)}return i?handleCatchall(l,u,c,a,n.value,e):l.length?Promise.all(l).then(()=>c):c}}),$ZodObjectJIT=$constructor("$ZodObjectJIT",(e,t)=>{$ZodObject.init(e,t);const r=e._zod.parse,n=cached(()=>normalizeDef(t)),s=f=>{const p=new Doc(["shape","payload","ctx"]),m=n.value,b=y=>{const g=esc(y);return`shape[${g}]._zod.run({ value: input[${g}], issues: [] }, ctx)`};p.write("const input = payload.value;");const T=Object.create(null);let S=0;for(const y of m.keys)T[y]=`key_${S++}`;p.write("const newResult = {};");for(const y of m.keys){const g=T[y],w=esc(y),x=f[y]?._zod?.optout==="optional";p.write(`const ${g} = ${b(y)};`),x?p.write(`
        if (${g}.issues.length) {
          if (${w} in input) {
            payload.issues = payload.issues.concat(${g}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${w}, ...iss.path] : [${w}]
            })));
          }
        }
        
        if (${g}.value === undefined) {
          if (${w} in input) {
            newResult[${w}] = undefined;
          }
        } else {
          newResult[${w}] = ${g}.value;
        }
        
      `):p.write(`
        if (${g}.issues.length) {
          payload.issues = payload.issues.concat(${g}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${w}, ...iss.path] : [${w}]
          })));
        }
        
        if (${g}.value === undefined) {
          if (${w} in input) {
            newResult[${w}] = undefined;
          }
        } else {
          newResult[${w}] = ${g}.value;
        }
        
      `)}p.write("payload.value = newResult;"),p.write("return payload;");const _=p.compile();return(y,g)=>_(f,y,g)};let i;const o=isObject,c=!globalConfig.jitless,u=c&&allowsEval.value,l=t.catchall;let h;e._zod.parse=(f,p)=>{h??(h=n.value);const m=f.value;return o(m)?c&&u&&p?.async===!1&&p.jitless!==!0?(i||(i=s(t.shape)),f=i(f,p),l?handleCatchall([],m,f,p,h,e):f):r(f,p):(f.issues.push({expected:"object",code:"invalid_type",input:m,inst:e}),f)}});function handleUnionResults(e,t,r,n){for(const i of e)if(i.issues.length===0)return t.value=i.value,t;const s=e.filter(i=>!aborted(i));return s.length===1?(t.value=s[0].value,s[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(i=>i.issues.map(o=>finalizeIssue(o,n,config())))}),t)}const $ZodUnion=$constructor("$ZodUnion",(e,t)=>{$ZodType.init(e,t),defineLazy(e._zod,"optin",()=>t.options.some(s=>s._zod.optin==="optional")?"optional":void 0),defineLazy(e._zod,"optout",()=>t.options.some(s=>s._zod.optout==="optional")?"optional":void 0),defineLazy(e._zod,"values",()=>{if(t.options.every(s=>s._zod.values))return new Set(t.options.flatMap(s=>Array.from(s._zod.values)))}),defineLazy(e._zod,"pattern",()=>{if(t.options.every(s=>s._zod.pattern)){const s=t.options.map(i=>i._zod.pattern);return new RegExp(`^(${s.map(i=>cleanRegex(i.source)).join("|")})$`)}});const r=t.options.length===1,n=t.options[0]._zod.run;e._zod.parse=(s,i)=>{if(r)return n(s,i);let o=!1;const c=[];for(const a of t.options){const u=a._zod.run({value:s.value,issues:[]},i);if(u instanceof Promise)c.push(u),o=!0;else{if(u.issues.length===0)return u;c.push(u)}}return o?Promise.all(c).then(a=>handleUnionResults(a,s,e,i)):handleUnionResults(c,s,e,i)}}),$ZodIntersection=$constructor("$ZodIntersection",(e,t)=>{$ZodType.init(e,t),e._zod.parse=(r,n)=>{const s=r.value,i=t.left._zod.run({value:s,issues:[]},n),o=t.right._zod.run({value:s,issues:[]},n);return i instanceof Promise||o instanceof Promise?Promise.all([i,o]).then(([a,u])=>handleIntersectionResults(r,a,u)):handleIntersectionResults(r,i,o)}});function mergeValues(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(isPlainObject(e)&&isPlainObject(t)){const r=Object.keys(t),n=Object.keys(e).filter(i=>r.indexOf(i)!==-1),s={...e,...t};for(const i of n){const o=mergeValues(e[i],t[i]);if(!o.valid)return{valid:!1,mergeErrorPath:[i,...o.mergeErrorPath]};s[i]=o.data}return{valid:!0,data:s}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const r=[];for(let n=0;n<e.length;n++){const s=e[n],i=t[n],o=mergeValues(s,i);if(!o.valid)return{valid:!1,mergeErrorPath:[n,...o.mergeErrorPath]};r.push(o.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function handleIntersectionResults(e,t,r){const n=new Map;let s;for(const c of t.issues)if(c.code==="unrecognized_keys"){s??(s=c);for(const a of c.keys)n.has(a)||n.set(a,{}),n.get(a).l=!0}else e.issues.push(c);for(const c of r.issues)if(c.code==="unrecognized_keys")for(const a of c.keys)n.has(a)||n.set(a,{}),n.get(a).r=!0;else e.issues.push(c);const i=[...n].filter(([,c])=>c.l&&c.r).map(([c])=>c);if(i.length&&s&&e.issues.push({...s,keys:i}),aborted(e))return e;const o=mergeValues(t.value,r.value);if(!o.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(o.mergeErrorPath)}`);return e.value=o.data,e}const $ZodTuple=$constructor("$ZodTuple",(e,t)=>{$ZodType.init(e,t);const r=t.items;e._zod.parse=(n,s)=>{const i=n.value;if(!Array.isArray(i))return n.issues.push({input:i,inst:e,expected:"tuple",code:"invalid_type"}),n;n.value=[];const o=[],c=[...r].reverse().findIndex(l=>l._zod.optin!=="optional"),a=c===-1?0:r.length-c;if(!t.rest){const l=i.length>r.length,h=i.length<a-1;if(l||h)return n.issues.push({...l?{code:"too_big",maximum:r.length,inclusive:!0}:{code:"too_small",minimum:r.length},input:i,inst:e,origin:"array"}),n}let u=-1;for(const l of r){if(u++,u>=i.length&&u>=a)continue;const h=l._zod.run({value:i[u],issues:[]},s);h instanceof Promise?o.push(h.then(f=>handleTupleResult(f,n,u))):handleTupleResult(h,n,u)}if(t.rest){const l=i.slice(r.length);for(const h of l){u++;const f=t.rest._zod.run({value:h,issues:[]},s);f instanceof Promise?o.push(f.then(p=>handleTupleResult(p,n,u))):handleTupleResult(f,n,u)}}return o.length?Promise.all(o).then(()=>n):n}});function handleTupleResult(e,t,r){e.issues.length&&t.issues.push(...prefixIssues(r,e.issues)),t.value[r]=e.value}const $ZodRecord=$constructor("$ZodRecord",(e,t)=>{$ZodType.init(e,t),e._zod.parse=(r,n)=>{const s=r.value;if(!isPlainObject(s))return r.issues.push({expected:"record",code:"invalid_type",input:s,inst:e}),r;const i=[],o=t.keyType._zod.values;if(o){r.value={};const c=new Set;for(const u of o)if(typeof u=="string"||typeof u=="number"||typeof u=="symbol"){c.add(typeof u=="number"?u.toString():u);const l=t.valueType._zod.run({value:s[u],issues:[]},n);l instanceof Promise?i.push(l.then(h=>{h.issues.length&&r.issues.push(...prefixIssues(u,h.issues)),r.value[u]=h.value})):(l.issues.length&&r.issues.push(...prefixIssues(u,l.issues)),r.value[u]=l.value)}let a;for(const u in s)c.has(u)||(a=a??[],a.push(u));a&&a.length>0&&r.issues.push({code:"unrecognized_keys",input:s,inst:e,keys:a})}else{r.value={};for(const c of Reflect.ownKeys(s)){if(c==="__proto__")continue;let a=t.keyType._zod.run({value:c,issues:[]},n);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(typeof c=="string"&&number$1.test(c)&&a.issues.length&&a.issues.some(h=>h.code==="invalid_type"&&h.expected==="number")){const h=t.keyType._zod.run({value:Number(c),issues:[]},n);if(h instanceof Promise)throw new Error("Async schemas not supported in object keys currently");h.issues.length===0&&(a=h)}if(a.issues.length){t.mode==="loose"?r.value[c]=s[c]:r.issues.push({code:"invalid_key",origin:"record",issues:a.issues.map(h=>finalizeIssue(h,n,config())),input:c,path:[c],inst:e});continue}const l=t.valueType._zod.run({value:s[c],issues:[]},n);l instanceof Promise?i.push(l.then(h=>{h.issues.length&&r.issues.push(...prefixIssues(c,h.issues)),r.value[a.value]=h.value})):(l.issues.length&&r.issues.push(...prefixIssues(c,l.issues)),r.value[a.value]=l.value)}}return i.length?Promise.all(i).then(()=>r):r}}),$ZodEnum=$constructor("$ZodEnum",(e,t)=>{$ZodType.init(e,t);const r=getEnumValues(t.entries),n=new Set(r);e._zod.values=n,e._zod.pattern=new RegExp(`^(${r.filter(s=>propertyKeyTypes.has(typeof s)).map(s=>typeof s=="string"?escapeRegex(s):s.toString()).join("|")})$`),e._zod.parse=(s,i)=>{const o=s.value;return n.has(o)||s.issues.push({code:"invalid_value",values:r,input:o,inst:e}),s}}),$ZodLiteral=$constructor("$ZodLiteral",(e,t)=>{if($ZodType.init(e,t),t.values.length===0)throw new Error("Cannot create literal schema with no valid values");const r=new Set(t.values);e._zod.values=r,e._zod.pattern=new RegExp(`^(${t.values.map(n=>typeof n=="string"?escapeRegex(n):n?escapeRegex(n.toString()):String(n)).join("|")})$`),e._zod.parse=(n,s)=>{const i=n.value;return r.has(i)||n.issues.push({code:"invalid_value",values:t.values,input:i,inst:e}),n}}),$ZodTransform=$constructor("$ZodTransform",(e,t)=>{$ZodType.init(e,t),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new $ZodEncodeError(e.constructor.name);const s=t.transform(r.value,r);if(n.async)return(s instanceof Promise?s:Promise.resolve(s)).then(o=>(r.value=o,r));if(s instanceof Promise)throw new $ZodAsyncError;return r.value=s,r}});function handleOptionalResult(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const $ZodOptional=$constructor("$ZodOptional",(e,t)=>{$ZodType.init(e,t),e._zod.optin="optional",e._zod.optout="optional",defineLazy(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),defineLazy(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${cleanRegex(r.source)})?$`):void 0}),e._zod.parse=(r,n)=>{if(t.innerType._zod.optin==="optional"){const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(i=>handleOptionalResult(i,r.value)):handleOptionalResult(s,r.value)}return r.value===void 0?r:t.innerType._zod.run(r,n)}}),$ZodExactOptional=$constructor("$ZodExactOptional",(e,t)=>{$ZodOptional.init(e,t),defineLazy(e._zod,"values",()=>t.innerType._zod.values),defineLazy(e._zod,"pattern",()=>t.innerType._zod.pattern),e._zod.parse=(r,n)=>t.innerType._zod.run(r,n)}),$ZodNullable=$constructor("$ZodNullable",(e,t)=>{$ZodType.init(e,t),defineLazy(e._zod,"optin",()=>t.innerType._zod.optin),defineLazy(e._zod,"optout",()=>t.innerType._zod.optout),defineLazy(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${cleanRegex(r.source)}|null)$`):void 0}),defineLazy(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(r,n)=>r.value===null?r:t.innerType._zod.run(r,n)}),$ZodDefault=$constructor("$ZodDefault",(e,t)=>{$ZodType.init(e,t),e._zod.optin="optional",defineLazy(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);if(r.value===void 0)return r.value=t.defaultValue,r;const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(i=>handleDefaultResult(i,t)):handleDefaultResult(s,t)}});function handleDefaultResult(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const $ZodPrefault=$constructor("$ZodPrefault",(e,t)=>{$ZodType.init(e,t),e._zod.optin="optional",defineLazy(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>(n.direction==="backward"||r.value===void 0&&(r.value=t.defaultValue),t.innerType._zod.run(r,n))}),$ZodNonOptional=$constructor("$ZodNonOptional",(e,t)=>{$ZodType.init(e,t),defineLazy(e._zod,"values",()=>{const r=t.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),e._zod.parse=(r,n)=>{const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(i=>handleNonOptionalResult(i,e)):handleNonOptionalResult(s,e)}});function handleNonOptionalResult(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const $ZodCatch=$constructor("$ZodCatch",(e,t)=>{$ZodType.init(e,t),defineLazy(e._zod,"optin",()=>t.innerType._zod.optin),defineLazy(e._zod,"optout",()=>t.innerType._zod.optout),defineLazy(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(i=>(r.value=i.value,i.issues.length&&(r.value=t.catchValue({...r,error:{issues:i.issues.map(o=>finalizeIssue(o,n,config()))},input:r.value}),r.issues=[]),r)):(r.value=s.value,s.issues.length&&(r.value=t.catchValue({...r,error:{issues:s.issues.map(i=>finalizeIssue(i,n,config()))},input:r.value}),r.issues=[]),r)}}),$ZodPipe=$constructor("$ZodPipe",(e,t)=>{$ZodType.init(e,t),defineLazy(e._zod,"values",()=>t.in._zod.values),defineLazy(e._zod,"optin",()=>t.in._zod.optin),defineLazy(e._zod,"optout",()=>t.out._zod.optout),defineLazy(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(r,n)=>{if(n.direction==="backward"){const i=t.out._zod.run(r,n);return i instanceof Promise?i.then(o=>handlePipeResult(o,t.in,n)):handlePipeResult(i,t.in,n)}const s=t.in._zod.run(r,n);return s instanceof Promise?s.then(i=>handlePipeResult(i,t.out,n)):handlePipeResult(s,t.out,n)}});function handlePipeResult(e,t,r){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},r)}const $ZodReadonly=$constructor("$ZodReadonly",(e,t)=>{$ZodType.init(e,t),defineLazy(e._zod,"propValues",()=>t.innerType._zod.propValues),defineLazy(e._zod,"values",()=>t.innerType._zod.values),defineLazy(e._zod,"optin",()=>t.innerType?._zod?.optin),defineLazy(e._zod,"optout",()=>t.innerType?._zod?.optout),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(handleReadonlyResult):handleReadonlyResult(s)}});function handleReadonlyResult(e){return e.value=Object.freeze(e.value),e}const $ZodCustom=$constructor("$ZodCustom",(e,t)=>{$ZodCheck.init(e,t),$ZodType.init(e,t),e._zod.parse=(r,n)=>r,e._zod.check=r=>{const n=r.value,s=t.fn(n);if(s instanceof Promise)return s.then(i=>handleRefineResult(i,r,n,e));handleRefineResult(s,r,n,e)}});function handleRefineResult(e,t,r,n){if(!e){const s={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(s.params=n._zod.def.params),t.issues.push(issue(s))}}var _a;class $ZodRegistry{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...r){const n=r[0];return this._map.set(t,n),n&&typeof n=="object"&&"id"in n&&this._idmap.set(n.id,t),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const r=this._map.get(t);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(t),this}get(t){const r=t._zod.parent;if(r){const n={...this.get(r)??{}};delete n.id;const s={...n,...this._map.get(t)};return Object.keys(s).length?s:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function registry(){return new $ZodRegistry}(_a=globalThis).__zod_globalRegistry??(_a.__zod_globalRegistry=registry());const globalRegistry=globalThis.__zod_globalRegistry;function _string(e,t){return new e({type:"string",...normalizeParams(t)})}function _email(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...normalizeParams(t)})}function _guid(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...normalizeParams(t)})}function _uuid(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...normalizeParams(t)})}function _uuidv4(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...normalizeParams(t)})}function _uuidv6(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...normalizeParams(t)})}function _uuidv7(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...normalizeParams(t)})}function _url(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...normalizeParams(t)})}function _emoji(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...normalizeParams(t)})}function _nanoid(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...normalizeParams(t)})}function _cuid(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...normalizeParams(t)})}function _cuid2(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...normalizeParams(t)})}function _ulid(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...normalizeParams(t)})}function _xid(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...normalizeParams(t)})}function _ksuid(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...normalizeParams(t)})}function _ipv4(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...normalizeParams(t)})}function _ipv6(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...normalizeParams(t)})}function _cidrv4(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...normalizeParams(t)})}function _cidrv6(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...normalizeParams(t)})}function _base64(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...normalizeParams(t)})}function _base64url(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...normalizeParams(t)})}function _e164(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...normalizeParams(t)})}function _jwt(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...normalizeParams(t)})}function _isoDateTime(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...normalizeParams(t)})}function _isoDate(e,t){return new e({type:"string",format:"date",check:"string_format",...normalizeParams(t)})}function _isoTime(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...normalizeParams(t)})}function _isoDuration(e,t){return new e({type:"string",format:"duration",check:"string_format",...normalizeParams(t)})}function _number(e,t){return new e({type:"number",checks:[],...normalizeParams(t)})}function _int(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...normalizeParams(t)})}function _boolean(e,t){return new e({type:"boolean",...normalizeParams(t)})}function _unknown(e){return new e({type:"unknown"})}function _never(e,t){return new e({type:"never",...normalizeParams(t)})}function _lt(e,t){return new $ZodCheckLessThan({check:"less_than",...normalizeParams(t),value:e,inclusive:!1})}function _lte(e,t){return new $ZodCheckLessThan({check:"less_than",...normalizeParams(t),value:e,inclusive:!0})}function _gt(e,t){return new $ZodCheckGreaterThan({check:"greater_than",...normalizeParams(t),value:e,inclusive:!1})}function _gte(e,t){return new $ZodCheckGreaterThan({check:"greater_than",...normalizeParams(t),value:e,inclusive:!0})}function _multipleOf(e,t){return new $ZodCheckMultipleOf({check:"multiple_of",...normalizeParams(t),value:e})}function _maxLength(e,t){return new $ZodCheckMaxLength({check:"max_length",...normalizeParams(t),maximum:e})}function _minLength(e,t){return new $ZodCheckMinLength({check:"min_length",...normalizeParams(t),minimum:e})}function _length(e,t){return new $ZodCheckLengthEquals({check:"length_equals",...normalizeParams(t),length:e})}function _regex(e,t){return new $ZodCheckRegex({check:"string_format",format:"regex",...normalizeParams(t),pattern:e})}function _lowercase(e){return new $ZodCheckLowerCase({check:"string_format",format:"lowercase",...normalizeParams(e)})}function _uppercase(e){return new $ZodCheckUpperCase({check:"string_format",format:"uppercase",...normalizeParams(e)})}function _includes(e,t){return new $ZodCheckIncludes({check:"string_format",format:"includes",...normalizeParams(t),includes:e})}function _startsWith(e,t){return new $ZodCheckStartsWith({check:"string_format",format:"starts_with",...normalizeParams(t),prefix:e})}function _endsWith(e,t){return new $ZodCheckEndsWith({check:"string_format",format:"ends_with",...normalizeParams(t),suffix:e})}function _overwrite(e){return new $ZodCheckOverwrite({check:"overwrite",tx:e})}function _normalize(e){return _overwrite(t=>t.normalize(e))}function _trim(){return _overwrite(e=>e.trim())}function _toLowerCase(){return _overwrite(e=>e.toLowerCase())}function _toUpperCase(){return _overwrite(e=>e.toUpperCase())}function _slugify(){return _overwrite(e=>slugify(e))}function _array(e,t,r){return new e({type:"array",element:t,...normalizeParams(r)})}function _refine(e,t,r){return new e({type:"custom",check:"custom",fn:t,...normalizeParams(r)})}function _superRefine(e){const t=_check(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(issue(n,r.value,t._zod.def));else{const s=n;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=t),s.continue??(s.continue=!t._zod.def.abort),r.issues.push(issue(s))}},e(r.value,r)));return t}function _check(e,t){const r=new $ZodCheck({check:"custom",...normalizeParams(t)});return r._zod.check=e,r}function initializeContext(e){let t=e?.target??"draft-2020-12";return t==="draft-4"&&(t="draft-04"),t==="draft-7"&&(t="draft-07"),{processors:e.processors??{},metadataRegistry:e?.metadata??globalRegistry,target:t,unrepresentable:e?.unrepresentable??"throw",override:e?.override??(()=>{}),io:e?.io??"output",counter:0,seen:new Map,cycles:e?.cycles??"ref",reused:e?.reused??"inline",external:e?.external??void 0}}function process(e,t,r={path:[],schemaPath:[]}){var n;const s=e._zod.def,i=t.seen.get(e);if(i)return i.count++,r.schemaPath.includes(e)&&(i.cycle=r.path),i.schema;const o={schema:{},count:1,cycle:void 0,path:r.path};t.seen.set(e,o);const c=e._zod.toJSONSchema?.();if(c)o.schema=c;else{const l={...r,schemaPath:[...r.schemaPath,e],path:r.path};if(e._zod.processJSONSchema)e._zod.processJSONSchema(t,o.schema,l);else{const f=o.schema,p=t.processors[s.type];if(!p)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${s.type}`);p(e,t,f,l)}const h=e._zod.parent;h&&(o.ref||(o.ref=h),process(h,t,l),t.seen.get(h).isParent=!0)}const a=t.metadataRegistry.get(e);return a&&Object.assign(o.schema,a),t.io==="input"&&isTransforming(e)&&(delete o.schema.examples,delete o.schema.default),t.io==="input"&&o.schema._prefault&&((n=o.schema).default??(n.default=o.schema._prefault)),delete o.schema._prefault,t.seen.get(e).schema}function extractDefs(e,t){const r=e.seen.get(t);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");const n=new Map;for(const o of e.seen.entries()){const c=e.metadataRegistry.get(o[0])?.id;if(c){const a=n.get(c);if(a&&a!==o[0])throw new Error(`Duplicate schema id "${c}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);n.set(c,o[0])}}const s=o=>{const c=e.target==="draft-2020-12"?"$defs":"definitions";if(e.external){const h=e.external.registry.get(o[0])?.id,f=e.external.uri??(m=>m);if(h)return{ref:f(h)};const p=o[1].defId??o[1].schema.id??`schema${e.counter++}`;return o[1].defId=p,{defId:p,ref:`${f("__shared")}#/${c}/${p}`}}if(o[1]===r)return{ref:"#"};const u=`#/${c}/`,l=o[1].schema.id??`__schema${e.counter++}`;return{defId:l,ref:u+l}},i=o=>{if(o[1].schema.$ref)return;const c=o[1],{ref:a,defId:u}=s(o);c.def={...c.schema},u&&(c.defId=u);const l=c.schema;for(const h in l)delete l[h];l.$ref=a};if(e.cycles==="throw")for(const o of e.seen.entries()){const c=o[1];if(c.cycle)throw new Error(`Cycle detected: #/${c.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const o of e.seen.entries()){const c=o[1];if(t===o[0]){i(o);continue}if(e.external){const u=e.external.registry.get(o[0])?.id;if(t!==o[0]&&u){i(o);continue}}if(e.metadataRegistry.get(o[0])?.id){i(o);continue}if(c.cycle){i(o);continue}if(c.count>1&&e.reused==="ref"){i(o);continue}}}function finalize(e,t){const r=e.seen.get(t);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");const n=o=>{const c=e.seen.get(o);if(c.ref===null)return;const a=c.def??c.schema,u={...a},l=c.ref;if(c.ref=null,l){n(l);const f=e.seen.get(l),p=f.schema;if(p.$ref&&(e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0")?(a.allOf=a.allOf??[],a.allOf.push(p)):Object.assign(a,p),Object.assign(a,u),o._zod.parent===l)for(const b in a)b==="$ref"||b==="allOf"||b in u||delete a[b];if(p.$ref)for(const b in a)b==="$ref"||b==="allOf"||b in f.def&&JSON.stringify(a[b])===JSON.stringify(f.def[b])&&delete a[b]}const h=o._zod.parent;if(h&&h!==l){n(h);const f=e.seen.get(h);if(f?.schema.$ref&&(a.$ref=f.schema.$ref,f.def))for(const p in a)p==="$ref"||p==="allOf"||p in f.def&&JSON.stringify(a[p])===JSON.stringify(f.def[p])&&delete a[p]}e.override({zodSchema:o,jsonSchema:a,path:c.path??[]})};for(const o of[...e.seen.entries()].reverse())n(o[0]);const s={};if(e.target==="draft-2020-12"?s.$schema="https://json-schema.org/draft/2020-12/schema":e.target==="draft-07"?s.$schema="http://json-schema.org/draft-07/schema#":e.target==="draft-04"?s.$schema="http://json-schema.org/draft-04/schema#":e.target,e.external?.uri){const o=e.external.registry.get(t)?.id;if(!o)throw new Error("Schema is missing an `id` property");s.$id=e.external.uri(o)}Object.assign(s,r.def??r.schema);const i=e.external?.defs??{};for(const o of e.seen.entries()){const c=o[1];c.def&&c.defId&&(i[c.defId]=c.def)}e.external||Object.keys(i).length>0&&(e.target==="draft-2020-12"?s.$defs=i:s.definitions=i);try{const o=JSON.parse(JSON.stringify(s));return Object.defineProperty(o,"~standard",{value:{...t["~standard"],jsonSchema:{input:createStandardJSONSchemaMethod(t,"input",e.processors),output:createStandardJSONSchemaMethod(t,"output",e.processors)}},enumerable:!1,writable:!1}),o}catch{throw new Error("Error converting schema to JSON.")}}function isTransforming(e,t){const r=t??{seen:new Set};if(r.seen.has(e))return!1;r.seen.add(e);const n=e._zod.def;if(n.type==="transform")return!0;if(n.type==="array")return isTransforming(n.element,r);if(n.type==="set")return isTransforming(n.valueType,r);if(n.type==="lazy")return isTransforming(n.getter(),r);if(n.type==="promise"||n.type==="optional"||n.type==="nonoptional"||n.type==="nullable"||n.type==="readonly"||n.type==="default"||n.type==="prefault")return isTransforming(n.innerType,r);if(n.type==="intersection")return isTransforming(n.left,r)||isTransforming(n.right,r);if(n.type==="record"||n.type==="map")return isTransforming(n.keyType,r)||isTransforming(n.valueType,r);if(n.type==="pipe")return isTransforming(n.in,r)||isTransforming(n.out,r);if(n.type==="object"){for(const s in n.shape)if(isTransforming(n.shape[s],r))return!0;return!1}if(n.type==="union"){for(const s of n.options)if(isTransforming(s,r))return!0;return!1}if(n.type==="tuple"){for(const s of n.items)if(isTransforming(s,r))return!0;return!!(n.rest&&isTransforming(n.rest,r))}return!1}const createToJSONSchemaMethod=(e,t={})=>r=>{const n=initializeContext({...r,processors:t});return process(e,n),extractDefs(n,e),finalize(n,e)},createStandardJSONSchemaMethod=(e,t,r={})=>n=>{const{libraryOptions:s,target:i}=n??{},o=initializeContext({...s??{},target:i,io:t,processors:r});return process(e,o),extractDefs(o,e),finalize(o,e)},formatMap={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},stringProcessor=(e,t,r,n)=>{const s=r;s.type="string";const{minimum:i,maximum:o,format:c,patterns:a,contentEncoding:u}=e._zod.bag;if(typeof i=="number"&&(s.minLength=i),typeof o=="number"&&(s.maxLength=o),c&&(s.format=formatMap[c]??c,s.format===""&&delete s.format,c==="time"&&delete s.format),u&&(s.contentEncoding=u),a&&a.size>0){const l=[...a];l.length===1?s.pattern=l[0].source:l.length>1&&(s.allOf=[...l.map(h=>({...t.target==="draft-07"||t.target==="draft-04"||t.target==="openapi-3.0"?{type:"string"}:{},pattern:h.source}))])}},numberProcessor=(e,t,r,n)=>{const s=r,{minimum:i,maximum:o,format:c,multipleOf:a,exclusiveMaximum:u,exclusiveMinimum:l}=e._zod.bag;typeof c=="string"&&c.includes("int")?s.type="integer":s.type="number",typeof l=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(s.minimum=l,s.exclusiveMinimum=!0):s.exclusiveMinimum=l),typeof i=="number"&&(s.minimum=i,typeof l=="number"&&t.target!=="draft-04"&&(l>=i?delete s.minimum:delete s.exclusiveMinimum)),typeof u=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(s.maximum=u,s.exclusiveMaximum=!0):s.exclusiveMaximum=u),typeof o=="number"&&(s.maximum=o,typeof u=="number"&&t.target!=="draft-04"&&(u<=o?delete s.maximum:delete s.exclusiveMaximum)),typeof a=="number"&&(s.multipleOf=a)},booleanProcessor=(e,t,r,n)=>{r.type="boolean"},neverProcessor=(e,t,r,n)=>{r.not={}},unknownProcessor=(e,t,r,n)=>{},enumProcessor=(e,t,r,n)=>{const s=e._zod.def,i=getEnumValues(s.entries);i.every(o=>typeof o=="number")&&(r.type="number"),i.every(o=>typeof o=="string")&&(r.type="string"),r.enum=i},literalProcessor=(e,t,r,n)=>{const s=e._zod.def,i=[];for(const o of s.values)if(o===void 0){if(t.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof o=="bigint"){if(t.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");i.push(Number(o))}else i.push(o);if(i.length!==0)if(i.length===1){const o=i[0];r.type=o===null?"null":typeof o,t.target==="draft-04"||t.target==="openapi-3.0"?r.enum=[o]:r.const=o}else i.every(o=>typeof o=="number")&&(r.type="number"),i.every(o=>typeof o=="string")&&(r.type="string"),i.every(o=>typeof o=="boolean")&&(r.type="boolean"),i.every(o=>o===null)&&(r.type="null"),r.enum=i},customProcessor=(e,t,r,n)=>{if(t.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},transformProcessor=(e,t,r,n)=>{if(t.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},arrayProcessor=(e,t,r,n)=>{const s=r,i=e._zod.def,{minimum:o,maximum:c}=e._zod.bag;typeof o=="number"&&(s.minItems=o),typeof c=="number"&&(s.maxItems=c),s.type="array",s.items=process(i.element,t,{...n,path:[...n.path,"items"]})},objectProcessor=(e,t,r,n)=>{const s=r,i=e._zod.def;s.type="object",s.properties={};const o=i.shape;for(const u in o)s.properties[u]=process(o[u],t,{...n,path:[...n.path,"properties",u]});const c=new Set(Object.keys(o)),a=new Set([...c].filter(u=>{const l=i.shape[u]._zod;return t.io==="input"?l.optin===void 0:l.optout===void 0}));a.size>0&&(s.required=Array.from(a)),i.catchall?._zod.def.type==="never"?s.additionalProperties=!1:i.catchall?i.catchall&&(s.additionalProperties=process(i.catchall,t,{...n,path:[...n.path,"additionalProperties"]})):t.io==="output"&&(s.additionalProperties=!1)},unionProcessor=(e,t,r,n)=>{const s=e._zod.def,i=s.inclusive===!1,o=s.options.map((c,a)=>process(c,t,{...n,path:[...n.path,i?"oneOf":"anyOf",a]}));i?r.oneOf=o:r.anyOf=o},intersectionProcessor=(e,t,r,n)=>{const s=e._zod.def,i=process(s.left,t,{...n,path:[...n.path,"allOf",0]}),o=process(s.right,t,{...n,path:[...n.path,"allOf",1]}),c=u=>"allOf"in u&&Object.keys(u).length===1,a=[...c(i)?i.allOf:[i],...c(o)?o.allOf:[o]];r.allOf=a},tupleProcessor=(e,t,r,n)=>{const s=r,i=e._zod.def;s.type="array";const o=t.target==="draft-2020-12"?"prefixItems":"items",c=t.target==="draft-2020-12"||t.target==="openapi-3.0"?"items":"additionalItems",a=i.items.map((f,p)=>process(f,t,{...n,path:[...n.path,o,p]})),u=i.rest?process(i.rest,t,{...n,path:[...n.path,c,...t.target==="openapi-3.0"?[i.items.length]:[]]}):null;t.target==="draft-2020-12"?(s.prefixItems=a,u&&(s.items=u)):t.target==="openapi-3.0"?(s.items={anyOf:a},u&&s.items.anyOf.push(u),s.minItems=a.length,u||(s.maxItems=a.length)):(s.items=a,u&&(s.additionalItems=u));const{minimum:l,maximum:h}=e._zod.bag;typeof l=="number"&&(s.minItems=l),typeof h=="number"&&(s.maxItems=h)},recordProcessor=(e,t,r,n)=>{const s=r,i=e._zod.def;s.type="object";const o=i.keyType,a=o._zod.bag?.patterns;if(i.mode==="loose"&&a&&a.size>0){const l=process(i.valueType,t,{...n,path:[...n.path,"patternProperties","*"]});s.patternProperties={};for(const h of a)s.patternProperties[h.source]=l}else(t.target==="draft-07"||t.target==="draft-2020-12")&&(s.propertyNames=process(i.keyType,t,{...n,path:[...n.path,"propertyNames"]})),s.additionalProperties=process(i.valueType,t,{...n,path:[...n.path,"additionalProperties"]});const u=o._zod.values;if(u){const l=[...u].filter(h=>typeof h=="string"||typeof h=="number");l.length>0&&(s.required=l)}},nullableProcessor=(e,t,r,n)=>{const s=e._zod.def,i=process(s.innerType,t,n),o=t.seen.get(e);t.target==="openapi-3.0"?(o.ref=s.innerType,r.nullable=!0):r.anyOf=[i,{type:"null"}]},nonoptionalProcessor=(e,t,r,n)=>{const s=e._zod.def;process(s.innerType,t,n);const i=t.seen.get(e);i.ref=s.innerType},defaultProcessor=(e,t,r,n)=>{const s=e._zod.def;process(s.innerType,t,n);const i=t.seen.get(e);i.ref=s.innerType,r.default=JSON.parse(JSON.stringify(s.defaultValue))},prefaultProcessor=(e,t,r,n)=>{const s=e._zod.def;process(s.innerType,t,n);const i=t.seen.get(e);i.ref=s.innerType,t.io==="input"&&(r._prefault=JSON.parse(JSON.stringify(s.defaultValue)))},catchProcessor=(e,t,r,n)=>{const s=e._zod.def;process(s.innerType,t,n);const i=t.seen.get(e);i.ref=s.innerType;let o;try{o=s.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}r.default=o},pipeProcessor=(e,t,r,n)=>{const s=e._zod.def,i=t.io==="input"?s.in._zod.def.type==="transform"?s.out:s.in:s.out;process(i,t,n);const o=t.seen.get(e);o.ref=i},readonlyProcessor=(e,t,r,n)=>{const s=e._zod.def;process(s.innerType,t,n);const i=t.seen.get(e);i.ref=s.innerType,r.readOnly=!0},optionalProcessor=(e,t,r,n)=>{const s=e._zod.def;process(s.innerType,t,n);const i=t.seen.get(e);i.ref=s.innerType},ZodISODateTime=$constructor("ZodISODateTime",(e,t)=>{$ZodISODateTime.init(e,t),ZodStringFormat.init(e,t)});function datetime(e){return _isoDateTime(ZodISODateTime,e)}const ZodISODate=$constructor("ZodISODate",(e,t)=>{$ZodISODate.init(e,t),ZodStringFormat.init(e,t)});function date(e){return _isoDate(ZodISODate,e)}const ZodISOTime=$constructor("ZodISOTime",(e,t)=>{$ZodISOTime.init(e,t),ZodStringFormat.init(e,t)});function time(e){return _isoTime(ZodISOTime,e)}const ZodISODuration=$constructor("ZodISODuration",(e,t)=>{$ZodISODuration.init(e,t),ZodStringFormat.init(e,t)});function duration(e){return _isoDuration(ZodISODuration,e)}const initializer=(e,t)=>{$ZodError.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:r=>formatError(e,r)},flatten:{value:r=>flattenError(e,r)},addIssue:{value:r=>{e.issues.push(r),e.message=JSON.stringify(e.issues,jsonStringifyReplacer,2)}},addIssues:{value:r=>{e.issues.push(...r),e.message=JSON.stringify(e.issues,jsonStringifyReplacer,2)}},isEmpty:{get(){return e.issues.length===0}}})},ZodRealError=$constructor("ZodError",initializer,{Parent:Error}),parse$1=_parse(ZodRealError),parseAsync=_parseAsync(ZodRealError),safeParse=_safeParse(ZodRealError),safeParseAsync=_safeParseAsync(ZodRealError),encode=_encode(ZodRealError),decode=_decode(ZodRealError),encodeAsync=_encodeAsync(ZodRealError),decodeAsync=_decodeAsync(ZodRealError),safeEncode=_safeEncode(ZodRealError),safeDecode=_safeDecode(ZodRealError),safeEncodeAsync=_safeEncodeAsync(ZodRealError),safeDecodeAsync=_safeDecodeAsync(ZodRealError),ZodType=$constructor("ZodType",(e,t)=>($ZodType.init(e,t),Object.assign(e["~standard"],{jsonSchema:{input:createStandardJSONSchemaMethod(e,"input"),output:createStandardJSONSchemaMethod(e,"output")}}),e.toJSONSchema=createToJSONSchemaMethod(e,{}),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone(mergeDefs(t,{checks:[...t.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),{parent:!0}),e.with=e.check,e.clone=(r,n)=>clone(e,r,n),e.brand=()=>e,e.register=((r,n)=>(r.add(e,n),e)),e.parse=(r,n)=>parse$1(e,r,n,{callee:e.parse}),e.safeParse=(r,n)=>safeParse(e,r,n),e.parseAsync=async(r,n)=>parseAsync(e,r,n,{callee:e.parseAsync}),e.safeParseAsync=async(r,n)=>safeParseAsync(e,r,n),e.spa=e.safeParseAsync,e.encode=(r,n)=>encode(e,r,n),e.decode=(r,n)=>decode(e,r,n),e.encodeAsync=async(r,n)=>encodeAsync(e,r,n),e.decodeAsync=async(r,n)=>decodeAsync(e,r,n),e.safeEncode=(r,n)=>safeEncode(e,r,n),e.safeDecode=(r,n)=>safeDecode(e,r,n),e.safeEncodeAsync=async(r,n)=>safeEncodeAsync(e,r,n),e.safeDecodeAsync=async(r,n)=>safeDecodeAsync(e,r,n),e.refine=(r,n)=>e.check(refine(r,n)),e.superRefine=r=>e.check(superRefine(r)),e.overwrite=r=>e.check(_overwrite(r)),e.optional=()=>optional(e),e.exactOptional=()=>exactOptional(e),e.nullable=()=>nullable(e),e.nullish=()=>optional(nullable(e)),e.nonoptional=r=>nonoptional(e,r),e.array=()=>array(e),e.or=r=>union([e,r]),e.and=r=>intersection(e,r),e.transform=r=>pipe(e,transform(r)),e.default=r=>_default(e,r),e.prefault=r=>prefault(e,r),e.catch=r=>_catch(e,r),e.pipe=r=>pipe(e,r),e.readonly=()=>readonly(e),e.describe=r=>{const n=e.clone();return globalRegistry.add(n,{description:r}),n},Object.defineProperty(e,"description",{get(){return globalRegistry.get(e)?.description},configurable:!0}),e.meta=(...r)=>{if(r.length===0)return globalRegistry.get(e);const n=e.clone();return globalRegistry.add(n,r[0]),n},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e.apply=r=>r(e),e)),_ZodString=$constructor("_ZodString",(e,t)=>{$ZodString.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(n,s,i)=>stringProcessor(e,n,s);const r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...n)=>e.check(_regex(...n)),e.includes=(...n)=>e.check(_includes(...n)),e.startsWith=(...n)=>e.check(_startsWith(...n)),e.endsWith=(...n)=>e.check(_endsWith(...n)),e.min=(...n)=>e.check(_minLength(...n)),e.max=(...n)=>e.check(_maxLength(...n)),e.length=(...n)=>e.check(_length(...n)),e.nonempty=(...n)=>e.check(_minLength(1,...n)),e.lowercase=n=>e.check(_lowercase(n)),e.uppercase=n=>e.check(_uppercase(n)),e.trim=()=>e.check(_trim()),e.normalize=(...n)=>e.check(_normalize(...n)),e.toLowerCase=()=>e.check(_toLowerCase()),e.toUpperCase=()=>e.check(_toUpperCase()),e.slugify=()=>e.check(_slugify())}),ZodString=$constructor("ZodString",(e,t)=>{$ZodString.init(e,t),_ZodString.init(e,t),e.email=r=>e.check(_email(ZodEmail,r)),e.url=r=>e.check(_url(ZodURL,r)),e.jwt=r=>e.check(_jwt(ZodJWT,r)),e.emoji=r=>e.check(_emoji(ZodEmoji,r)),e.guid=r=>e.check(_guid(ZodGUID,r)),e.uuid=r=>e.check(_uuid(ZodUUID,r)),e.uuidv4=r=>e.check(_uuidv4(ZodUUID,r)),e.uuidv6=r=>e.check(_uuidv6(ZodUUID,r)),e.uuidv7=r=>e.check(_uuidv7(ZodUUID,r)),e.nanoid=r=>e.check(_nanoid(ZodNanoID,r)),e.guid=r=>e.check(_guid(ZodGUID,r)),e.cuid=r=>e.check(_cuid(ZodCUID,r)),e.cuid2=r=>e.check(_cuid2(ZodCUID2,r)),e.ulid=r=>e.check(_ulid(ZodULID,r)),e.base64=r=>e.check(_base64(ZodBase64,r)),e.base64url=r=>e.check(_base64url(ZodBase64URL,r)),e.xid=r=>e.check(_xid(ZodXID,r)),e.ksuid=r=>e.check(_ksuid(ZodKSUID,r)),e.ipv4=r=>e.check(_ipv4(ZodIPv4,r)),e.ipv6=r=>e.check(_ipv6(ZodIPv6,r)),e.cidrv4=r=>e.check(_cidrv4(ZodCIDRv4,r)),e.cidrv6=r=>e.check(_cidrv6(ZodCIDRv6,r)),e.e164=r=>e.check(_e164(ZodE164,r)),e.datetime=r=>e.check(datetime(r)),e.date=r=>e.check(date(r)),e.time=r=>e.check(time(r)),e.duration=r=>e.check(duration(r))});function string(e){return _string(ZodString,e)}const ZodStringFormat=$constructor("ZodStringFormat",(e,t)=>{$ZodStringFormat.init(e,t),_ZodString.init(e,t)}),ZodEmail=$constructor("ZodEmail",(e,t)=>{$ZodEmail.init(e,t),ZodStringFormat.init(e,t)}),ZodGUID=$constructor("ZodGUID",(e,t)=>{$ZodGUID.init(e,t),ZodStringFormat.init(e,t)}),ZodUUID=$constructor("ZodUUID",(e,t)=>{$ZodUUID.init(e,t),ZodStringFormat.init(e,t)}),ZodURL=$constructor("ZodURL",(e,t)=>{$ZodURL.init(e,t),ZodStringFormat.init(e,t)}),ZodEmoji=$constructor("ZodEmoji",(e,t)=>{$ZodEmoji.init(e,t),ZodStringFormat.init(e,t)}),ZodNanoID=$constructor("ZodNanoID",(e,t)=>{$ZodNanoID.init(e,t),ZodStringFormat.init(e,t)}),ZodCUID=$constructor("ZodCUID",(e,t)=>{$ZodCUID.init(e,t),ZodStringFormat.init(e,t)}),ZodCUID2=$constructor("ZodCUID2",(e,t)=>{$ZodCUID2.init(e,t),ZodStringFormat.init(e,t)}),ZodULID=$constructor("ZodULID",(e,t)=>{$ZodULID.init(e,t),ZodStringFormat.init(e,t)}),ZodXID=$constructor("ZodXID",(e,t)=>{$ZodXID.init(e,t),ZodStringFormat.init(e,t)}),ZodKSUID=$constructor("ZodKSUID",(e,t)=>{$ZodKSUID.init(e,t),ZodStringFormat.init(e,t)}),ZodIPv4=$constructor("ZodIPv4",(e,t)=>{$ZodIPv4.init(e,t),ZodStringFormat.init(e,t)}),ZodIPv6=$constructor("ZodIPv6",(e,t)=>{$ZodIPv6.init(e,t),ZodStringFormat.init(e,t)}),ZodCIDRv4=$constructor("ZodCIDRv4",(e,t)=>{$ZodCIDRv4.init(e,t),ZodStringFormat.init(e,t)}),ZodCIDRv6=$constructor("ZodCIDRv6",(e,t)=>{$ZodCIDRv6.init(e,t),ZodStringFormat.init(e,t)}),ZodBase64=$constructor("ZodBase64",(e,t)=>{$ZodBase64.init(e,t),ZodStringFormat.init(e,t)}),ZodBase64URL=$constructor("ZodBase64URL",(e,t)=>{$ZodBase64URL.init(e,t),ZodStringFormat.init(e,t)}),ZodE164=$constructor("ZodE164",(e,t)=>{$ZodE164.init(e,t),ZodStringFormat.init(e,t)}),ZodJWT=$constructor("ZodJWT",(e,t)=>{$ZodJWT.init(e,t),ZodStringFormat.init(e,t)}),ZodNumber=$constructor("ZodNumber",(e,t)=>{$ZodNumber.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(n,s,i)=>numberProcessor(e,n,s),e.gt=(n,s)=>e.check(_gt(n,s)),e.gte=(n,s)=>e.check(_gte(n,s)),e.min=(n,s)=>e.check(_gte(n,s)),e.lt=(n,s)=>e.check(_lt(n,s)),e.lte=(n,s)=>e.check(_lte(n,s)),e.max=(n,s)=>e.check(_lte(n,s)),e.int=n=>e.check(int(n)),e.safe=n=>e.check(int(n)),e.positive=n=>e.check(_gt(0,n)),e.nonnegative=n=>e.check(_gte(0,n)),e.negative=n=>e.check(_lt(0,n)),e.nonpositive=n=>e.check(_lte(0,n)),e.multipleOf=(n,s)=>e.check(_multipleOf(n,s)),e.step=(n,s)=>e.check(_multipleOf(n,s)),e.finite=()=>e;const r=e._zod.bag;e.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),e.isFinite=!0,e.format=r.format??null});function number(e){return _number(ZodNumber,e)}const ZodNumberFormat=$constructor("ZodNumberFormat",(e,t)=>{$ZodNumberFormat.init(e,t),ZodNumber.init(e,t)});function int(e){return _int(ZodNumberFormat,e)}const ZodBoolean=$constructor("ZodBoolean",(e,t)=>{$ZodBoolean.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>booleanProcessor(e,r,n)});function boolean(e){return _boolean(ZodBoolean,e)}const ZodUnknown=$constructor("ZodUnknown",(e,t)=>{$ZodUnknown.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>unknownProcessor()});function unknown(){return _unknown(ZodUnknown)}const ZodNever=$constructor("ZodNever",(e,t)=>{$ZodNever.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>neverProcessor(e,r,n)});function never(e){return _never(ZodNever,e)}const ZodArray=$constructor("ZodArray",(e,t)=>{$ZodArray.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>arrayProcessor(e,r,n,s),e.element=t.element,e.min=(r,n)=>e.check(_minLength(r,n)),e.nonempty=r=>e.check(_minLength(1,r)),e.max=(r,n)=>e.check(_maxLength(r,n)),e.length=(r,n)=>e.check(_length(r,n)),e.unwrap=()=>e.element});function array(e,t){return _array(ZodArray,e,t)}const ZodObject=$constructor("ZodObject",(e,t)=>{$ZodObjectJIT.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>objectProcessor(e,r,n,s),defineLazy(e,"shape",()=>t.shape),e.keyof=()=>_enum(Object.keys(e._zod.def.shape)),e.catchall=r=>e.clone({...e._zod.def,catchall:r}),e.passthrough=()=>e.clone({...e._zod.def,catchall:unknown()}),e.loose=()=>e.clone({...e._zod.def,catchall:unknown()}),e.strict=()=>e.clone({...e._zod.def,catchall:never()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=r=>extend(e,r),e.safeExtend=r=>safeExtend(e,r),e.merge=r=>merge(e,r),e.pick=r=>pick(e,r),e.omit=r=>omit(e,r),e.partial=(...r)=>partial(ZodOptional,e,r[0]),e.required=(...r)=>required(ZodNonOptional,e,r[0])});function object(e,t){const r={type:"object",shape:e??{},...normalizeParams(t)};return new ZodObject(r)}const ZodUnion=$constructor("ZodUnion",(e,t)=>{$ZodUnion.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>unionProcessor(e,r,n,s),e.options=t.options});function union(e,t){return new ZodUnion({type:"union",options:e,...normalizeParams(t)})}const ZodIntersection=$constructor("ZodIntersection",(e,t)=>{$ZodIntersection.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>intersectionProcessor(e,r,n,s)});function intersection(e,t){return new ZodIntersection({type:"intersection",left:e,right:t})}const ZodTuple=$constructor("ZodTuple",(e,t)=>{$ZodTuple.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>tupleProcessor(e,r,n,s),e.rest=r=>e.clone({...e._zod.def,rest:r})});function tuple(e,t,r){const n=t instanceof $ZodType,s=n?r:t,i=n?t:null;return new ZodTuple({type:"tuple",items:e,rest:i,...normalizeParams(s)})}const ZodRecord=$constructor("ZodRecord",(e,t)=>{$ZodRecord.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>recordProcessor(e,r,n,s),e.keyType=t.keyType,e.valueType=t.valueType});function record(e,t,r){return new ZodRecord({type:"record",keyType:e,valueType:t,...normalizeParams(r)})}const ZodEnum=$constructor("ZodEnum",(e,t)=>{$ZodEnum.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(n,s,i)=>enumProcessor(e,n,s),e.enum=t.entries,e.options=Object.values(t.entries);const r=new Set(Object.keys(t.entries));e.extract=(n,s)=>{const i={};for(const o of n)if(r.has(o))i[o]=t.entries[o];else throw new Error(`Key ${o} not found in enum`);return new ZodEnum({...t,checks:[],...normalizeParams(s),entries:i})},e.exclude=(n,s)=>{const i={...t.entries};for(const o of n)if(r.has(o))delete i[o];else throw new Error(`Key ${o} not found in enum`);return new ZodEnum({...t,checks:[],...normalizeParams(s),entries:i})}});function _enum(e,t){const r=Array.isArray(e)?Object.fromEntries(e.map(n=>[n,n])):e;return new ZodEnum({type:"enum",entries:r,...normalizeParams(t)})}const ZodLiteral=$constructor("ZodLiteral",(e,t)=>{$ZodLiteral.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>literalProcessor(e,r,n),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function literal(e,t){return new ZodLiteral({type:"literal",values:Array.isArray(e)?e:[e],...normalizeParams(t)})}const ZodTransform=$constructor("ZodTransform",(e,t)=>{$ZodTransform.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>transformProcessor(e,r),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new $ZodEncodeError(e.constructor.name);r.addIssue=i=>{if(typeof i=="string")r.issues.push(issue(i,r.value,t));else{const o=i;o.fatal&&(o.continue=!1),o.code??(o.code="custom"),o.input??(o.input=r.value),o.inst??(o.inst=e),r.issues.push(issue(o))}};const s=t.transform(r.value,r);return s instanceof Promise?s.then(i=>(r.value=i,r)):(r.value=s,r)}});function transform(e){return new ZodTransform({type:"transform",transform:e})}const ZodOptional=$constructor("ZodOptional",(e,t)=>{$ZodOptional.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>optionalProcessor(e,r,n,s),e.unwrap=()=>e._zod.def.innerType});function optional(e){return new ZodOptional({type:"optional",innerType:e})}const ZodExactOptional=$constructor("ZodExactOptional",(e,t)=>{$ZodExactOptional.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>optionalProcessor(e,r,n,s),e.unwrap=()=>e._zod.def.innerType});function exactOptional(e){return new ZodExactOptional({type:"optional",innerType:e})}const ZodNullable=$constructor("ZodNullable",(e,t)=>{$ZodNullable.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>nullableProcessor(e,r,n,s),e.unwrap=()=>e._zod.def.innerType});function nullable(e){return new ZodNullable({type:"nullable",innerType:e})}const ZodDefault=$constructor("ZodDefault",(e,t)=>{$ZodDefault.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>defaultProcessor(e,r,n,s),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function _default(e,t){return new ZodDefault({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():shallowClone(t)}})}const ZodPrefault=$constructor("ZodPrefault",(e,t)=>{$ZodPrefault.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>prefaultProcessor(e,r,n,s),e.unwrap=()=>e._zod.def.innerType});function prefault(e,t){return new ZodPrefault({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():shallowClone(t)}})}const ZodNonOptional=$constructor("ZodNonOptional",(e,t)=>{$ZodNonOptional.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>nonoptionalProcessor(e,r,n,s),e.unwrap=()=>e._zod.def.innerType});function nonoptional(e,t){return new ZodNonOptional({type:"nonoptional",innerType:e,...normalizeParams(t)})}const ZodCatch=$constructor("ZodCatch",(e,t)=>{$ZodCatch.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>catchProcessor(e,r,n,s),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function _catch(e,t){return new ZodCatch({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const ZodPipe=$constructor("ZodPipe",(e,t)=>{$ZodPipe.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>pipeProcessor(e,r,n,s),e.in=t.in,e.out=t.out});function pipe(e,t){return new ZodPipe({type:"pipe",in:e,out:t})}const ZodReadonly=$constructor("ZodReadonly",(e,t)=>{$ZodReadonly.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>readonlyProcessor(e,r,n,s),e.unwrap=()=>e._zod.def.innerType});function readonly(e){return new ZodReadonly({type:"readonly",innerType:e})}const ZodCustom=$constructor("ZodCustom",(e,t)=>{$ZodCustom.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>customProcessor(e,r)});function refine(e,t={}){return _refine(ZodCustom,e,t)}function superRefine(e){return _superRefine(e)}const metadataSchema$1=object({model:string(),version:string()}),rgbColorSchema=object({r:number().min(0).max(255),g:number().min(0).max(255),b:number().min(0).max(255)});object({min:number(),max:number()});const emtEventTimesSchema=object({time_A_start:number(),time_A_end:number(),time_B_start:number(),time_B_end:number(),time_S_start:number(),time_S_end:number(),time_P_start:number(),time_P_end:number()}),ehtCellTypeSchema=object({N_init:number().int().nonnegative(),location:string(),R_hard:number().positive(),R_hard_div:number().positive(),R_soft:number().positive(),color:rgbColorSchema,dur_G2:number().nonnegative(),dur_mitosis:number().nonnegative(),k_apical_junction:number().nonnegative(),k_cytos:number().nonnegative(),max_cytoskeleton_length:number().nonnegative(),run:number().min(0).max(1),running_speed:number().nonnegative(),running_mode:number().int().min(0).max(3),stiffness_apical_apical:number().nonnegative(),stiffness_apical_apical_div:number().nonnegative(),stiffness_nuclei_apical:number().nonnegative(),stiffness_nuclei_basal:number().nonnegative(),stiffness_repulsion:number().nonnegative(),stiffness_straightness:number().nonnegative(),lifespan_start:number(),lifespan_end:number(),INM:number().min(0).max(1),hetero:boolean(),events:emtEventTimesSchema,diffusion:number().nonnegative(),basal_damping_ratio:number().nonnegative(),max_basal_junction_dist:number().positive(),cytos_init:number().nonnegative(),basal_membrane_repulsion:number().nonnegative(),apical_junction_init:number().nonnegative()}),ehtGeneralParamsSchema=object({t_end:number().positive(),dt:number().positive(),random_seed:number().int(),full_circle:boolean(),w_init:number().positive(),h_init:number().positive(),mu:number().positive(),n_substeps:number().int().positive(),alg_dt:number().positive(),w_screen:number().positive(),h_screen:number().positive(),p_div_out:number().min(0).max(1),perimeter:number().positive(),aspect_ratio:number(),hard_sphere_nuclei:boolean()}),ehtCellPropertyParamsSchema=object({}),ehtCellTypesMapSchema=record(string(),ehtCellTypeSchema),ehtParamsSchema=object({metadata:metadataSchema$1,general:ehtGeneralParamsSchema,cell_prop:ehtCellPropertyParamsSchema,cell_types:ehtCellTypesMapSchema}),partialMetadataSchema=metadataSchema$1.partial(),partialEhtGeneralParamsSchema=ehtGeneralParamsSchema.partial(),partialEhtCellPropertyParamsSchema=ehtCellPropertyParamsSchema.partial(),partialEhtCellTypeSchema=ehtCellTypeSchema.partial();object({metadata:partialMetadataSchema.optional(),general:partialEhtGeneralParamsSchema.optional(),cell_prop:partialEhtCellPropertyParamsSchema.optional(),cell_types:record(string(),partialEhtCellTypeSchema).optional()});function setNestedValue(e,t,r){const n=t.split(".");let s=e;for(let i=0;i<n.length-1;i++){const o=n[i];(!(o in s)||typeof s[o]!="object"||s[o]===null)&&(s[o]={}),s=s[o]}s[n[n.length-1]]=r}function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var r=function n(){var s=!1;try{s=this instanceof n}catch{}return s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}),r}var toml={},parse={exports:{}},tomlParser={exports:{}},parser,hasRequiredParser;function requireParser(){if(hasRequiredParser)return parser;hasRequiredParser=1;const e=1114112;class t extends Error{constructor(i,o,c){super("[ParserError] "+i,o,c),this.name="ParserError",this.code="ParserError",Error.captureStackTrace&&Error.captureStackTrace(this,t)}}class r{constructor(i){this.parser=i,this.buf="",this.returned=null,this.result=null,this.resultTable=null,this.resultArr=null}}class n{constructor(){this.pos=0,this.col=0,this.line=0,this.obj={},this.ctx=this.obj,this.stack=[],this._buf="",this.char=null,this.ii=0,this.state=new r(this.parseStart)}parse(i){if(i.length===0||i.length==null)return;this._buf=String(i),this.ii=-1,this.char=-1;let o;for(;o===!1||this.nextChar();)o=this.runOne();this._buf=null}nextChar(){return this.char===10&&(++this.line,this.col=-1),++this.ii,this.char=this._buf.codePointAt(this.ii),++this.pos,++this.col,this.haveBuffer()}haveBuffer(){return this.ii<this._buf.length}runOne(){return this.state.parser.call(this,this.state.returned)}finish(){this.char=e;let i;do i=this.state.parser,this.runOne();while(this.state.parser!==i);return this.ctx=null,this.state=null,this._buf=null,this.obj}next(i){if(typeof i!="function")throw new t("Tried to set state to non-existent state: "+JSON.stringify(i));this.state.parser=i}goto(i){return this.next(i),this.runOne()}call(i,o){o&&this.next(o),this.stack.push(this.state),this.state=new r(i)}callNow(i,o){return this.call(i,o),this.runOne()}return(i){if(this.stack.length===0)throw this.error(new t("Stack underflow"));i===void 0&&(i=this.state.buf),this.state=this.stack.pop(),this.state.returned=i}returnNow(i){return this.return(i),this.runOne()}consume(){if(this.char===e)throw this.error(new t("Unexpected end-of-buffer"));this.state.buf+=this._buf[this.ii]}error(i){return i.line=this.line,i.col=this.col,i.pos=this.pos,i}parseStart(){throw new t("Must declare a parseStart method")}}return n.END=e,n.Error=t,parser=n,parser}var createDatetime,hasRequiredCreateDatetime;function requireCreateDatetime(){return hasRequiredCreateDatetime||(hasRequiredCreateDatetime=1,createDatetime=e=>{const t=new Date(e);if(isNaN(t))throw new TypeError("Invalid Datetime");return t}),createDatetime}var formatNum,hasRequiredFormatNum;function requireFormatNum(){return hasRequiredFormatNum||(hasRequiredFormatNum=1,formatNum=(e,t)=>{for(t=String(t);t.length<e;)t="0"+t;return t}),formatNum}var createDatetimeFloat,hasRequiredCreateDatetimeFloat;function requireCreateDatetimeFloat(){if(hasRequiredCreateDatetimeFloat)return createDatetimeFloat;hasRequiredCreateDatetimeFloat=1;const e=requireFormatNum();class t extends Date{constructor(n){super(n+"Z"),this.isFloating=!0}toISOString(){const n=`${this.getUTCFullYear()}-${e(2,this.getUTCMonth()+1)}-${e(2,this.getUTCDate())}`,s=`${e(2,this.getUTCHours())}:${e(2,this.getUTCMinutes())}:${e(2,this.getUTCSeconds())}.${e(3,this.getUTCMilliseconds())}`;return`${n}T${s}`}}return createDatetimeFloat=r=>{const n=new t(r);if(isNaN(n))throw new TypeError("Invalid Datetime");return n},createDatetimeFloat}var createDate,hasRequiredCreateDate;function requireCreateDate(){if(hasRequiredCreateDate)return createDate;hasRequiredCreateDate=1;const e=requireFormatNum(),t=globalThis.Date;class r extends t{constructor(s){super(s),this.isDate=!0}toISOString(){return`${this.getUTCFullYear()}-${e(2,this.getUTCMonth()+1)}-${e(2,this.getUTCDate())}`}}return createDate=n=>{const s=new r(n);if(isNaN(s))throw new TypeError("Invalid Datetime");return s},createDate}var createTime,hasRequiredCreateTime;function requireCreateTime(){if(hasRequiredCreateTime)return createTime;hasRequiredCreateTime=1;const e=requireFormatNum();class t extends Date{constructor(n){super(`0000-01-01T${n}Z`),this.isTime=!0}toISOString(){return`${e(2,this.getUTCHours())}:${e(2,this.getUTCMinutes())}:${e(2,this.getUTCSeconds())}.${e(3,this.getUTCMilliseconds())}`}}return createTime=r=>{const n=new t(r);if(isNaN(n))throw new TypeError("Invalid Datetime");return n},createTime}var hasRequiredTomlParser;function requireTomlParser(){if(hasRequiredTomlParser)return tomlParser.exports;hasRequiredTomlParser=1,tomlParser.exports=makeParserClass(requireParser()),tomlParser.exports.makeParserClass=makeParserClass;class TomlError extends Error{constructor(t){super(t),this.name="TomlError",Error.captureStackTrace&&Error.captureStackTrace(this,TomlError),this.fromTOML=!0,this.wrapped=null}}TomlError.wrap=e=>{const t=new TomlError(e.message);return t.code=e.code,t.wrapped=e,t},tomlParser.exports.TomlError=TomlError;const createDateTime=requireCreateDatetime(),createDateTimeFloat=requireCreateDatetimeFloat(),createDate=requireCreateDate(),createTime=requireCreateTime(),CTRL_I=9,CTRL_J=10,CTRL_M=13,CTRL_CHAR_BOUNDARY=31,CHAR_SP=32,CHAR_QUOT=34,CHAR_NUM=35,CHAR_APOS=39,CHAR_PLUS=43,CHAR_COMMA=44,CHAR_HYPHEN=45,CHAR_PERIOD=46,CHAR_0=48,CHAR_1=49,CHAR_7=55,CHAR_9=57,CHAR_COLON=58,CHAR_EQUALS=61,CHAR_A=65,CHAR_E=69,CHAR_F=70,CHAR_T=84,CHAR_U=85,CHAR_Z=90,CHAR_LOWBAR=95,CHAR_a=97,CHAR_b=98,CHAR_e=101,CHAR_f=102,CHAR_i=105,CHAR_l=108,CHAR_n=110,CHAR_o=111,CHAR_r=114,CHAR_s=115,CHAR_t=116,CHAR_u=117,CHAR_x=120,CHAR_z=122,CHAR_LCUB=123,CHAR_RCUB=125,CHAR_LSQB=91,CHAR_BSOL=92,CHAR_RSQB=93,CHAR_DEL=127,SURROGATE_FIRST=55296,SURROGATE_LAST=57343,escapes={[CHAR_b]:"\b",[CHAR_t]:"	",[CHAR_n]:`
`,[CHAR_f]:"\f",[CHAR_r]:"\r",[CHAR_QUOT]:'"',[CHAR_BSOL]:"\\"};function isDigit(e){return e>=CHAR_0&&e<=CHAR_9}function isHexit(e){return e>=CHAR_A&&e<=CHAR_F||e>=CHAR_a&&e<=CHAR_f||e>=CHAR_0&&e<=CHAR_9}function isBit(e){return e===CHAR_1||e===CHAR_0}function isOctit(e){return e>=CHAR_0&&e<=CHAR_7}function isAlphaNumQuoteHyphen(e){return e>=CHAR_A&&e<=CHAR_Z||e>=CHAR_a&&e<=CHAR_z||e>=CHAR_0&&e<=CHAR_9||e===CHAR_APOS||e===CHAR_QUOT||e===CHAR_LOWBAR||e===CHAR_HYPHEN}function isAlphaNumHyphen(e){return e>=CHAR_A&&e<=CHAR_Z||e>=CHAR_a&&e<=CHAR_z||e>=CHAR_0&&e<=CHAR_9||e===CHAR_LOWBAR||e===CHAR_HYPHEN}const _type=Symbol("type"),_declared=Symbol("declared"),hasOwnProperty=Object.prototype.hasOwnProperty,defineProperty=Object.defineProperty,descriptor={configurable:!0,enumerable:!0,writable:!0,value:void 0};function hasKey(e,t){return hasOwnProperty.call(e,t)?!0:(t==="__proto__"&&defineProperty(e,"__proto__",descriptor),!1)}const INLINE_TABLE=Symbol("inline-table");function InlineTable(){return Object.defineProperties({},{[_type]:{value:INLINE_TABLE}})}function isInlineTable(e){return e===null||typeof e!="object"?!1:e[_type]===INLINE_TABLE}const TABLE=Symbol("table");function Table(){return Object.defineProperties({},{[_type]:{value:TABLE},[_declared]:{value:!1,writable:!0}})}function isTable(e){return e===null||typeof e!="object"?!1:e[_type]===TABLE}const _contentType=Symbol("content-type"),INLINE_LIST=Symbol("inline-list");function InlineList(e){return Object.defineProperties([],{[_type]:{value:INLINE_LIST},[_contentType]:{value:e}})}function isInlineList(e){return e===null||typeof e!="object"?!1:e[_type]===INLINE_LIST}const LIST=Symbol("list");function List(){return Object.defineProperties([],{[_type]:{value:LIST}})}function isList(e){return e===null||typeof e!="object"?!1:e[_type]===LIST}let _custom;try{const utilInspect=eval("require('util').inspect");_custom=utilInspect.custom}catch(e){}const _inspect=_custom||"inspect";class BoxedBigInt{constructor(t){try{this.value=globalThis.BigInt.asIntN(64,t)}catch{this.value=null}Object.defineProperty(this,_type,{value:INTEGER})}isNaN(){return this.value===null}toString(){return String(this.value)}[_inspect](){return`[BigInt: ${this.toString()}]}`}valueOf(){return this.value}}const INTEGER=Symbol("integer");function Integer(e){let t=Number(e);return Object.is(t,-0)&&(t=0),globalThis.BigInt&&!Number.isSafeInteger(t)?new BoxedBigInt(e):Object.defineProperties(new Number(t),{isNaN:{value:function(){return isNaN(this)}},[_type]:{value:INTEGER},[_inspect]:{value:()=>`[Integer: ${e}]`}})}function isInteger(e){return e===null||typeof e!="object"?!1:e[_type]===INTEGER}const FLOAT=Symbol("float");function Float(e){return Object.defineProperties(new Number(e),{[_type]:{value:FLOAT},[_inspect]:{value:()=>`[Float: ${e}]`}})}function isFloat(e){return e===null||typeof e!="object"?!1:e[_type]===FLOAT}function tomlType(e){const t=typeof e;if(t==="object"){if(e===null)return"null";if(e instanceof Date)return"datetime";if(_type in e)switch(e[_type]){case INLINE_TABLE:return"inline-table";case INLINE_LIST:return"inline-list";case TABLE:return"table";case LIST:return"list";case FLOAT:return"float";case INTEGER:return"integer"}}return t}function makeParserClass(e){class t extends e{constructor(){super(),this.ctx=this.obj=Table()}atEndOfWord(){return this.char===CHAR_NUM||this.char===CTRL_I||this.char===CHAR_SP||this.atEndOfLine()}atEndOfLine(){return this.char===e.END||this.char===CTRL_J||this.char===CTRL_M}parseStart(){if(this.char===e.END)return null;if(this.char===CHAR_LSQB)return this.call(this.parseTableOrList);if(this.char===CHAR_NUM)return this.call(this.parseComment);if(this.char===CTRL_J||this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M)return null;if(isAlphaNumQuoteHyphen(this.char))return this.callNow(this.parseAssignStatement);throw this.error(new TomlError(`Unknown character "${this.char}"`))}parseWhitespaceToEOL(){if(this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M)return null;if(this.char===CHAR_NUM)return this.goto(this.parseComment);if(this.char===e.END||this.char===CTRL_J)return this.return();throw this.error(new TomlError("Unexpected character, expected only whitespace or comments till end of line"))}parseAssignStatement(){return this.callNow(this.parseAssign,this.recordAssignStatement)}recordAssignStatement(n){let s=this.ctx,i=n.key.pop();for(let o of n.key){if(hasKey(s,o)&&(!isTable(s[o])||s[o][_declared]))throw this.error(new TomlError("Can't redefine existing key"));s=s[o]=s[o]||Table()}if(hasKey(s,i))throw this.error(new TomlError("Can't redefine existing key"));return isInteger(n.value)||isFloat(n.value)?s[i]=n.value.valueOf():s[i]=n.value,this.goto(this.parseWhitespaceToEOL)}parseAssign(){return this.callNow(this.parseKeyword,this.recordAssignKeyword)}recordAssignKeyword(n){return this.state.resultTable?this.state.resultTable.push(n):this.state.resultTable=[n],this.goto(this.parseAssignKeywordPreDot)}parseAssignKeywordPreDot(){if(this.char===CHAR_PERIOD)return this.next(this.parseAssignKeywordPostDot);if(this.char!==CHAR_SP&&this.char!==CTRL_I)return this.goto(this.parseAssignEqual)}parseAssignKeywordPostDot(){if(this.char!==CHAR_SP&&this.char!==CTRL_I)return this.callNow(this.parseKeyword,this.recordAssignKeyword)}parseAssignEqual(){if(this.char===CHAR_EQUALS)return this.next(this.parseAssignPreValue);throw this.error(new TomlError('Invalid character, expected "="'))}parseAssignPreValue(){return this.char===CHAR_SP||this.char===CTRL_I?null:this.callNow(this.parseValue,this.recordAssignValue)}recordAssignValue(n){return this.returnNow({key:this.state.resultTable,value:n})}parseComment(){do if(this.char===e.END||this.char===CTRL_J)return this.return();while(this.nextChar())}parseTableOrList(){if(this.char===CHAR_LSQB)this.next(this.parseList);else return this.goto(this.parseTable)}parseTable(){return this.ctx=this.obj,this.goto(this.parseTableNext)}parseTableNext(){return this.char===CHAR_SP||this.char===CTRL_I?null:this.callNow(this.parseKeyword,this.parseTableMore)}parseTableMore(n){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===CHAR_RSQB){if(hasKey(this.ctx,n)&&(!isTable(this.ctx[n])||this.ctx[n][_declared]))throw this.error(new TomlError("Can't redefine existing key"));return this.ctx=this.ctx[n]=this.ctx[n]||Table(),this.ctx[_declared]=!0,this.next(this.parseWhitespaceToEOL)}else if(this.char===CHAR_PERIOD){if(!hasKey(this.ctx,n))this.ctx=this.ctx[n]=Table();else if(isTable(this.ctx[n]))this.ctx=this.ctx[n];else if(isList(this.ctx[n]))this.ctx=this.ctx[n][this.ctx[n].length-1];else throw this.error(new TomlError("Can't redefine existing key"));return this.next(this.parseTableNext)}else throw this.error(new TomlError("Unexpected character, expected whitespace, . or ]"))}parseList(){return this.ctx=this.obj,this.goto(this.parseListNext)}parseListNext(){return this.char===CHAR_SP||this.char===CTRL_I?null:this.callNow(this.parseKeyword,this.parseListMore)}parseListMore(n){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===CHAR_RSQB){if(hasKey(this.ctx,n)||(this.ctx[n]=List()),isInlineList(this.ctx[n]))throw this.error(new TomlError("Can't extend an inline array"));if(isList(this.ctx[n])){const s=Table();this.ctx[n].push(s),this.ctx=s}else throw this.error(new TomlError("Can't redefine an existing key"));return this.next(this.parseListEnd)}else if(this.char===CHAR_PERIOD){if(!hasKey(this.ctx,n))this.ctx=this.ctx[n]=Table();else{if(isInlineList(this.ctx[n]))throw this.error(new TomlError("Can't extend an inline array"));if(isInlineTable(this.ctx[n]))throw this.error(new TomlError("Can't extend an inline table"));if(isList(this.ctx[n]))this.ctx=this.ctx[n][this.ctx[n].length-1];else if(isTable(this.ctx[n]))this.ctx=this.ctx[n];else throw this.error(new TomlError("Can't redefine an existing key"))}return this.next(this.parseListNext)}else throw this.error(new TomlError("Unexpected character, expected whitespace, . or ]"))}parseListEnd(n){if(this.char===CHAR_RSQB)return this.next(this.parseWhitespaceToEOL);throw this.error(new TomlError("Unexpected character, expected whitespace, . or ]"))}parseValue(){if(this.char===e.END)throw this.error(new TomlError("Key without value"));if(this.char===CHAR_QUOT)return this.next(this.parseDoubleString);if(this.char===CHAR_APOS)return this.next(this.parseSingleString);if(this.char===CHAR_HYPHEN||this.char===CHAR_PLUS)return this.goto(this.parseNumberSign);if(this.char===CHAR_i)return this.next(this.parseInf);if(this.char===CHAR_n)return this.next(this.parseNan);if(isDigit(this.char))return this.goto(this.parseNumberOrDateTime);if(this.char===CHAR_t||this.char===CHAR_f)return this.goto(this.parseBoolean);if(this.char===CHAR_LSQB)return this.call(this.parseInlineList,this.recordValue);if(this.char===CHAR_LCUB)return this.call(this.parseInlineTable,this.recordValue);throw this.error(new TomlError("Unexpected character, expecting string, number, datetime, boolean, inline array or inline table"))}recordValue(n){return this.returnNow(n)}parseInf(){if(this.char===CHAR_n)return this.next(this.parseInf2);throw this.error(new TomlError('Unexpected character, expected "inf", "+inf" or "-inf"'))}parseInf2(){if(this.char===CHAR_f)return this.state.buf==="-"?this.return(-1/0):this.return(1/0);throw this.error(new TomlError('Unexpected character, expected "inf", "+inf" or "-inf"'))}parseNan(){if(this.char===CHAR_a)return this.next(this.parseNan2);throw this.error(new TomlError('Unexpected character, expected "nan"'))}parseNan2(){if(this.char===CHAR_n)return this.return(NaN);throw this.error(new TomlError('Unexpected character, expected "nan"'))}parseKeyword(){return this.char===CHAR_QUOT?this.next(this.parseBasicString):this.char===CHAR_APOS?this.next(this.parseLiteralString):this.goto(this.parseBareKey)}parseBareKey(){do{if(this.char===e.END)throw this.error(new TomlError("Key ended without value"));if(isAlphaNumHyphen(this.char))this.consume();else{if(this.state.buf.length===0)throw this.error(new TomlError("Empty bare keys are not allowed"));return this.returnNow()}}while(this.nextChar())}parseSingleString(){return this.char===CHAR_APOS?this.next(this.parseLiteralMultiStringMaybe):this.goto(this.parseLiteralString)}parseLiteralString(){do{if(this.char===CHAR_APOS)return this.return();if(this.atEndOfLine())throw this.error(new TomlError("Unterminated string"));if(this.char===CHAR_DEL||this.char<=CTRL_CHAR_BOUNDARY&&this.char!==CTRL_I)throw this.errorControlCharInString();this.consume()}while(this.nextChar())}parseLiteralMultiStringMaybe(){return this.char===CHAR_APOS?this.next(this.parseLiteralMultiString):this.returnNow()}parseLiteralMultiString(){return this.char===CTRL_M?null:this.char===CTRL_J?this.next(this.parseLiteralMultiStringContent):this.goto(this.parseLiteralMultiStringContent)}parseLiteralMultiStringContent(){do{if(this.char===CHAR_APOS)return this.next(this.parseLiteralMultiEnd);if(this.char===e.END)throw this.error(new TomlError("Unterminated multi-line string"));if(this.char===CHAR_DEL||this.char<=CTRL_CHAR_BOUNDARY&&this.char!==CTRL_I&&this.char!==CTRL_J&&this.char!==CTRL_M)throw this.errorControlCharInString();this.consume()}while(this.nextChar())}parseLiteralMultiEnd(){return this.char===CHAR_APOS?this.next(this.parseLiteralMultiEnd2):(this.state.buf+="'",this.goto(this.parseLiteralMultiStringContent))}parseLiteralMultiEnd2(){return this.char===CHAR_APOS?this.return():(this.state.buf+="''",this.goto(this.parseLiteralMultiStringContent))}parseDoubleString(){return this.char===CHAR_QUOT?this.next(this.parseMultiStringMaybe):this.goto(this.parseBasicString)}parseBasicString(){do{if(this.char===CHAR_BSOL)return this.call(this.parseEscape,this.recordEscapeReplacement);if(this.char===CHAR_QUOT)return this.return();if(this.atEndOfLine())throw this.error(new TomlError("Unterminated string"));if(this.char===CHAR_DEL||this.char<=CTRL_CHAR_BOUNDARY&&this.char!==CTRL_I)throw this.errorControlCharInString();this.consume()}while(this.nextChar())}recordEscapeReplacement(n){return this.state.buf+=n,this.goto(this.parseBasicString)}parseMultiStringMaybe(){return this.char===CHAR_QUOT?this.next(this.parseMultiString):this.returnNow()}parseMultiString(){return this.char===CTRL_M?null:this.char===CTRL_J?this.next(this.parseMultiStringContent):this.goto(this.parseMultiStringContent)}parseMultiStringContent(){do{if(this.char===CHAR_BSOL)return this.call(this.parseMultiEscape,this.recordMultiEscapeReplacement);if(this.char===CHAR_QUOT)return this.next(this.parseMultiEnd);if(this.char===e.END)throw this.error(new TomlError("Unterminated multi-line string"));if(this.char===CHAR_DEL||this.char<=CTRL_CHAR_BOUNDARY&&this.char!==CTRL_I&&this.char!==CTRL_J&&this.char!==CTRL_M)throw this.errorControlCharInString();this.consume()}while(this.nextChar())}errorControlCharInString(){let n="\\u00";return this.char<16&&(n+="0"),n+=this.char.toString(16),this.error(new TomlError(`Control characters (codes < 0x1f and 0x7f) are not allowed in strings, use ${n} instead`))}recordMultiEscapeReplacement(n){return this.state.buf+=n,this.goto(this.parseMultiStringContent)}parseMultiEnd(){return this.char===CHAR_QUOT?this.next(this.parseMultiEnd2):(this.state.buf+='"',this.goto(this.parseMultiStringContent))}parseMultiEnd2(){return this.char===CHAR_QUOT?this.return():(this.state.buf+='""',this.goto(this.parseMultiStringContent))}parseMultiEscape(){return this.char===CTRL_M||this.char===CTRL_J?this.next(this.parseMultiTrim):this.char===CHAR_SP||this.char===CTRL_I?this.next(this.parsePreMultiTrim):this.goto(this.parseEscape)}parsePreMultiTrim(){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===CTRL_M||this.char===CTRL_J)return this.next(this.parseMultiTrim);throw this.error(new TomlError("Can't escape whitespace"))}parseMultiTrim(){return this.char===CTRL_J||this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M?null:this.returnNow()}parseEscape(){if(this.char in escapes)return this.return(escapes[this.char]);if(this.char===CHAR_u)return this.call(this.parseSmallUnicode,this.parseUnicodeReturn);if(this.char===CHAR_U)return this.call(this.parseLargeUnicode,this.parseUnicodeReturn);throw this.error(new TomlError("Unknown escape character: "+this.char))}parseUnicodeReturn(n){try{const s=parseInt(n,16);if(s>=SURROGATE_FIRST&&s<=SURROGATE_LAST)throw this.error(new TomlError("Invalid unicode, character in range 0xD800 - 0xDFFF is reserved"));return this.returnNow(String.fromCodePoint(s))}catch(s){throw this.error(TomlError.wrap(s))}}parseSmallUnicode(){if(isHexit(this.char)){if(this.consume(),this.state.buf.length>=4)return this.return()}else throw this.error(new TomlError("Invalid character in unicode sequence, expected hex"))}parseLargeUnicode(){if(isHexit(this.char)){if(this.consume(),this.state.buf.length>=8)return this.return()}else throw this.error(new TomlError("Invalid character in unicode sequence, expected hex"))}parseNumberSign(){return this.consume(),this.next(this.parseMaybeSignedInfOrNan)}parseMaybeSignedInfOrNan(){return this.char===CHAR_i?this.next(this.parseInf):this.char===CHAR_n?this.next(this.parseNan):this.callNow(this.parseNoUnder,this.parseNumberIntegerStart)}parseNumberIntegerStart(){return this.char===CHAR_0?(this.consume(),this.next(this.parseNumberIntegerExponentOrDecimal)):this.goto(this.parseNumberInteger)}parseNumberIntegerExponentOrDecimal(){return this.char===CHAR_PERIOD?(this.consume(),this.call(this.parseNoUnder,this.parseNumberFloat)):this.char===CHAR_E||this.char===CHAR_e?(this.consume(),this.next(this.parseNumberExponentSign)):this.returnNow(Integer(this.state.buf))}parseNumberInteger(){if(isDigit(this.char))this.consume();else{if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnder);if(this.char===CHAR_E||this.char===CHAR_e)return this.consume(),this.next(this.parseNumberExponentSign);if(this.char===CHAR_PERIOD)return this.consume(),this.call(this.parseNoUnder,this.parseNumberFloat);{const n=Integer(this.state.buf);if(n.isNaN())throw this.error(new TomlError("Invalid number"));return this.returnNow(n)}}}parseNoUnder(){if(this.char===CHAR_LOWBAR||this.char===CHAR_PERIOD||this.char===CHAR_E||this.char===CHAR_e)throw this.error(new TomlError("Unexpected character, expected digit"));if(this.atEndOfWord())throw this.error(new TomlError("Incomplete number"));return this.returnNow()}parseNoUnderHexOctBinLiteral(){if(this.char===CHAR_LOWBAR||this.char===CHAR_PERIOD)throw this.error(new TomlError("Unexpected character, expected digit"));if(this.atEndOfWord())throw this.error(new TomlError("Incomplete number"));return this.returnNow()}parseNumberFloat(){if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnder,this.parseNumberFloat);if(isDigit(this.char))this.consume();else return this.char===CHAR_E||this.char===CHAR_e?(this.consume(),this.next(this.parseNumberExponentSign)):this.returnNow(Float(this.state.buf))}parseNumberExponentSign(){if(isDigit(this.char))return this.goto(this.parseNumberExponent);if(this.char===CHAR_HYPHEN||this.char===CHAR_PLUS)this.consume(),this.call(this.parseNoUnder,this.parseNumberExponent);else throw this.error(new TomlError("Unexpected character, expected -, + or digit"))}parseNumberExponent(){if(isDigit(this.char))this.consume();else return this.char===CHAR_LOWBAR?this.call(this.parseNoUnder):this.returnNow(Float(this.state.buf))}parseNumberOrDateTime(){return this.char===CHAR_0?(this.consume(),this.next(this.parseNumberBaseOrDateTime)):this.goto(this.parseNumberOrDateTimeOnly)}parseNumberOrDateTimeOnly(){if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnder,this.parseNumberInteger);if(isDigit(this.char))this.consume(),this.state.buf.length>4&&this.next(this.parseNumberInteger);else return this.char===CHAR_E||this.char===CHAR_e?(this.consume(),this.next(this.parseNumberExponentSign)):this.char===CHAR_PERIOD?(this.consume(),this.call(this.parseNoUnder,this.parseNumberFloat)):this.char===CHAR_HYPHEN?this.goto(this.parseDateTime):this.char===CHAR_COLON?this.goto(this.parseOnlyTimeHour):this.returnNow(Integer(this.state.buf))}parseDateTimeOnly(){if(this.state.buf.length<4){if(isDigit(this.char))return this.consume();if(this.char===CHAR_COLON)return this.goto(this.parseOnlyTimeHour);throw this.error(new TomlError("Expected digit while parsing year part of a date"))}else{if(this.char===CHAR_HYPHEN)return this.goto(this.parseDateTime);throw this.error(new TomlError("Expected hyphen (-) while parsing year part of date"))}}parseNumberBaseOrDateTime(){return this.char===CHAR_b?(this.consume(),this.call(this.parseNoUnderHexOctBinLiteral,this.parseIntegerBin)):this.char===CHAR_o?(this.consume(),this.call(this.parseNoUnderHexOctBinLiteral,this.parseIntegerOct)):this.char===CHAR_x?(this.consume(),this.call(this.parseNoUnderHexOctBinLiteral,this.parseIntegerHex)):this.char===CHAR_PERIOD?this.goto(this.parseNumberInteger):isDigit(this.char)?this.goto(this.parseDateTimeOnly):this.returnNow(Integer(this.state.buf))}parseIntegerHex(){if(isHexit(this.char))this.consume();else{if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnderHexOctBinLiteral);{const n=Integer(this.state.buf);if(n.isNaN())throw this.error(new TomlError("Invalid number"));return this.returnNow(n)}}}parseIntegerOct(){if(isOctit(this.char))this.consume();else{if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnderHexOctBinLiteral);{const n=Integer(this.state.buf);if(n.isNaN())throw this.error(new TomlError("Invalid number"));return this.returnNow(n)}}}parseIntegerBin(){if(isBit(this.char))this.consume();else{if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnderHexOctBinLiteral);{const n=Integer(this.state.buf);if(n.isNaN())throw this.error(new TomlError("Invalid number"));return this.returnNow(n)}}}parseDateTime(){if(this.state.buf.length<4)throw this.error(new TomlError("Years less than 1000 must be zero padded to four characters"));return this.state.result=this.state.buf,this.state.buf="",this.next(this.parseDateMonth)}parseDateMonth(){if(this.char===CHAR_HYPHEN){if(this.state.buf.length<2)throw this.error(new TomlError("Months less than 10 must be zero padded to two characters"));return this.state.result+="-"+this.state.buf,this.state.buf="",this.next(this.parseDateDay)}else if(isDigit(this.char))this.consume();else throw this.error(new TomlError("Incomplete datetime"))}parseDateDay(){if(this.char===CHAR_T||this.char===CHAR_SP){if(this.state.buf.length<2)throw this.error(new TomlError("Days less than 10 must be zero padded to two characters"));return this.state.result+="-"+this.state.buf,this.state.buf="",this.next(this.parseStartTimeHour)}else{if(this.atEndOfWord())return this.returnNow(createDate(this.state.result+"-"+this.state.buf));if(isDigit(this.char))this.consume();else throw this.error(new TomlError("Incomplete datetime"))}}parseStartTimeHour(){return this.atEndOfWord()?this.returnNow(createDate(this.state.result)):this.goto(this.parseTimeHour)}parseTimeHour(){if(this.char===CHAR_COLON){if(this.state.buf.length<2)throw this.error(new TomlError("Hours less than 10 must be zero padded to two characters"));return this.state.result+="T"+this.state.buf,this.state.buf="",this.next(this.parseTimeMin)}else if(isDigit(this.char))this.consume();else throw this.error(new TomlError("Incomplete datetime"))}parseTimeMin(){if(this.state.buf.length<2&&isDigit(this.char))this.consume();else{if(this.state.buf.length===2&&this.char===CHAR_COLON)return this.state.result+=":"+this.state.buf,this.state.buf="",this.next(this.parseTimeSec);throw this.error(new TomlError("Incomplete datetime"))}}parseTimeSec(){if(isDigit(this.char)){if(this.consume(),this.state.buf.length===2)return this.state.result+=":"+this.state.buf,this.state.buf="",this.next(this.parseTimeZoneOrFraction)}else throw this.error(new TomlError("Incomplete datetime"))}parseOnlyTimeHour(){if(this.char===CHAR_COLON){if(this.state.buf.length<2)throw this.error(new TomlError("Hours less than 10 must be zero padded to two characters"));return this.state.result=this.state.buf,this.state.buf="",this.next(this.parseOnlyTimeMin)}else throw this.error(new TomlError("Incomplete time"))}parseOnlyTimeMin(){if(this.state.buf.length<2&&isDigit(this.char))this.consume();else{if(this.state.buf.length===2&&this.char===CHAR_COLON)return this.state.result+=":"+this.state.buf,this.state.buf="",this.next(this.parseOnlyTimeSec);throw this.error(new TomlError("Incomplete time"))}}parseOnlyTimeSec(){if(isDigit(this.char)){if(this.consume(),this.state.buf.length===2)return this.next(this.parseOnlyTimeFractionMaybe)}else throw this.error(new TomlError("Incomplete time"))}parseOnlyTimeFractionMaybe(){if(this.state.result+=":"+this.state.buf,this.char===CHAR_PERIOD)this.state.buf="",this.next(this.parseOnlyTimeFraction);else return this.return(createTime(this.state.result))}parseOnlyTimeFraction(){if(isDigit(this.char))this.consume();else if(this.atEndOfWord()){if(this.state.buf.length===0)throw this.error(new TomlError("Expected digit in milliseconds"));return this.returnNow(createTime(this.state.result+"."+this.state.buf))}else throw this.error(new TomlError("Unexpected character in datetime, expected period (.), minus (-), plus (+) or Z"))}parseTimeZoneOrFraction(){if(this.char===CHAR_PERIOD)this.consume(),this.next(this.parseDateTimeFraction);else if(this.char===CHAR_HYPHEN||this.char===CHAR_PLUS)this.consume(),this.next(this.parseTimeZoneHour);else{if(this.char===CHAR_Z)return this.consume(),this.return(createDateTime(this.state.result+this.state.buf));if(this.atEndOfWord())return this.returnNow(createDateTimeFloat(this.state.result+this.state.buf));throw this.error(new TomlError("Unexpected character in datetime, expected period (.), minus (-), plus (+) or Z"))}}parseDateTimeFraction(){if(isDigit(this.char))this.consume();else{if(this.state.buf.length===1)throw this.error(new TomlError("Expected digit in milliseconds"));if(this.char===CHAR_HYPHEN||this.char===CHAR_PLUS)this.consume(),this.next(this.parseTimeZoneHour);else{if(this.char===CHAR_Z)return this.consume(),this.return(createDateTime(this.state.result+this.state.buf));if(this.atEndOfWord())return this.returnNow(createDateTimeFloat(this.state.result+this.state.buf));throw this.error(new TomlError("Unexpected character in datetime, expected period (.), minus (-), plus (+) or Z"))}}}parseTimeZoneHour(){if(isDigit(this.char)){if(this.consume(),/\d\d$/.test(this.state.buf))return this.next(this.parseTimeZoneSep)}else throw this.error(new TomlError("Unexpected character in datetime, expected digit"))}parseTimeZoneSep(){if(this.char===CHAR_COLON)this.consume(),this.next(this.parseTimeZoneMin);else throw this.error(new TomlError("Unexpected character in datetime, expected colon"))}parseTimeZoneMin(){if(isDigit(this.char)){if(this.consume(),/\d\d$/.test(this.state.buf))return this.return(createDateTime(this.state.result+this.state.buf))}else throw this.error(new TomlError("Unexpected character in datetime, expected digit"))}parseBoolean(){if(this.char===CHAR_t)return this.consume(),this.next(this.parseTrue_r);if(this.char===CHAR_f)return this.consume(),this.next(this.parseFalse_a)}parseTrue_r(){if(this.char===CHAR_r)return this.consume(),this.next(this.parseTrue_u);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseTrue_u(){if(this.char===CHAR_u)return this.consume(),this.next(this.parseTrue_e);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseTrue_e(){if(this.char===CHAR_e)return this.return(!0);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseFalse_a(){if(this.char===CHAR_a)return this.consume(),this.next(this.parseFalse_l);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseFalse_l(){if(this.char===CHAR_l)return this.consume(),this.next(this.parseFalse_s);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseFalse_s(){if(this.char===CHAR_s)return this.consume(),this.next(this.parseFalse_e);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseFalse_e(){if(this.char===CHAR_e)return this.return(!1);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseInlineList(){if(this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M||this.char===CTRL_J)return null;if(this.char===e.END)throw this.error(new TomlError("Unterminated inline array"));return this.char===CHAR_NUM?this.call(this.parseComment):this.char===CHAR_RSQB?this.return(this.state.resultArr||InlineList()):this.callNow(this.parseValue,this.recordInlineListValue)}recordInlineListValue(n){if(this.state.resultArr){const s=this.state.resultArr[_contentType],i=tomlType(n);if(s!==i)throw this.error(new TomlError(`Inline lists must be a single type, not a mix of ${s} and ${i}`))}else this.state.resultArr=InlineList(tomlType(n));return isFloat(n)||isInteger(n)?this.state.resultArr.push(n.valueOf()):this.state.resultArr.push(n),this.goto(this.parseInlineListNext)}parseInlineListNext(){if(this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M||this.char===CTRL_J)return null;if(this.char===CHAR_NUM)return this.call(this.parseComment);if(this.char===CHAR_COMMA)return this.next(this.parseInlineList);if(this.char===CHAR_RSQB)return this.goto(this.parseInlineList);throw this.error(new TomlError("Invalid character, expected whitespace, comma (,) or close bracket (])"))}parseInlineTable(){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===e.END||this.char===CHAR_NUM||this.char===CTRL_J||this.char===CTRL_M)throw this.error(new TomlError("Unterminated inline array"));return this.char===CHAR_RCUB?this.return(this.state.resultTable||InlineTable()):(this.state.resultTable||(this.state.resultTable=InlineTable()),this.callNow(this.parseAssign,this.recordInlineTableValue))}recordInlineTableValue(n){let s=this.state.resultTable,i=n.key.pop();for(let o of n.key){if(hasKey(s,o)&&(!isTable(s[o])||s[o][_declared]))throw this.error(new TomlError("Can't redefine existing key"));s=s[o]=s[o]||Table()}if(hasKey(s,i))throw this.error(new TomlError("Can't redefine existing key"));return isInteger(n.value)||isFloat(n.value)?s[i]=n.value.valueOf():s[i]=n.value,this.goto(this.parseInlineTableNext)}parseInlineTableNext(){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===e.END||this.char===CHAR_NUM||this.char===CTRL_J||this.char===CTRL_M)throw this.error(new TomlError("Unterminated inline array"));if(this.char===CHAR_COMMA)return this.next(this.parseInlineTable);if(this.char===CHAR_RCUB)return this.goto(this.parseInlineTable);throw this.error(new TomlError("Invalid character, expected whitespace, comma (,) or close bracket (])"))}}return t}return tomlParser.exports}var parsePrettyError,hasRequiredParsePrettyError;function requireParsePrettyError(){if(hasRequiredParsePrettyError)return parsePrettyError;hasRequiredParsePrettyError=1,parsePrettyError=e;function e(t,r){if(t.pos==null||t.line==null)return t;let n=t.message;if(n+=` at row ${t.line+1}, col ${t.col+1}, pos ${t.pos}:
`,r&&r.split){const s=r.split(/\n/),i=String(Math.min(s.length,t.line+3)).length;let o=" ";for(;o.length<i;)o+=" ";for(let c=Math.max(0,t.line-1);c<Math.min(s.length,t.line+2);++c){let a=String(c+1);if(a.length<i&&(a=" "+a),t.line===c){n+=a+"> "+s[c]+`
`,n+=o+"  ";for(let u=0;u<t.col;++u)n+=" ";n+=`^
`}else n+=a+": "+s[c]+`
`}}return t.message=n+`
`,t}return parsePrettyError}var parseString_1,hasRequiredParseString;function requireParseString(){if(hasRequiredParseString)return parseString_1;hasRequiredParseString=1,parseString_1=r;const e=requireTomlParser(),t=requireParsePrettyError();function r(n){globalThis.Buffer&&globalThis.Buffer.isBuffer(n)&&(n=n.toString("utf8"));const s=new e;try{return s.parse(n),s.finish()}catch(i){throw t(i,n)}}return parseString_1}var parseAsync_1,hasRequiredParseAsync;function requireParseAsync(){if(hasRequiredParseAsync)return parseAsync_1;hasRequiredParseAsync=1,parseAsync_1=r;const e=requireTomlParser(),t=requireParsePrettyError();function r(n,s){s||(s={});const i=0,o=s.blocksize||40960,c=new e;return new Promise((u,l)=>{setImmediate(a,i,o,u,l)});function a(u,l,h,f){if(u>=n.length)try{return h(c.finish())}catch(p){return f(t(p,n))}try{c.parse(n.slice(u,u+l)),setImmediate(a,u+l,l,h,f)}catch(p){f(t(p,n))}}}return parseAsync_1}var __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze({__proto__:null,default:__viteBrowserExternal}),require$$0=getAugmentedNamespace(__viteBrowserExternal$1),parseStream_1,hasRequiredParseStream;function requireParseStream(){if(hasRequiredParseStream)return parseStream_1;hasRequiredParseStream=1,parseStream_1=r;const e=require$$0,t=requireTomlParser();function r(i){return i?n(i):s()}function n(i){const o=new t;return i.setEncoding("utf8"),new Promise((c,a)=>{let u,l=!1,h=!1;function f(){if(l=!0,!u)try{c(o.finish())}catch(b){a(b)}}function p(b){h=!0,a(b)}i.once("end",f),i.once("error",p),m();function m(){u=!0;let b;for(;(b=i.read())!==null;)try{o.parse(b)}catch(T){return p(T)}if(u=!1,l)return f();h||i.once("readable",m)}})}function s(){const i=new t;return new e.Transform({objectMode:!0,transform(o,c,a){try{i.parse(o.toString(c))}catch(u){this.emit("error",u)}a()},flush(o){try{this.push(i.finish())}catch(c){this.emit("error",c)}o()}})}return parseStream_1}var hasRequiredParse;function requireParse(){return hasRequiredParse||(hasRequiredParse=1,parse.exports=requireParseString(),parse.exports.async=requireParseAsync(),parse.exports.stream=requireParseStream(),parse.exports.prettyError=requireParsePrettyError()),parse.exports}var stringify={exports:{}},hasRequiredStringify;function requireStringify(){if(hasRequiredStringify)return stringify.exports;hasRequiredStringify=1,stringify.exports=e,stringify.exports.value=T;function e(d){if(d===null)throw t("null");if(d===void 0)throw t("undefined");if(typeof d!="object")throw t(typeof d);if(typeof d.toJSON=="function"&&(d=d.toJSON()),d==null)return null;const v=a(d);if(v!=="table")throw t(v);return o("","",d)}function t(d){return new Error("Can only stringify objects, not "+d)}function r(){return new Error("Array values can't have mixed types")}function n(d){return Object.keys(d).filter(v=>c(d[v]))}function s(d){return Object.keys(d).filter(v=>!c(d[v]))}function i(d){let v=Array.isArray(d)?[]:Object.prototype.hasOwnProperty.call(d,"__proto__")?{["__proto__"]:void 0}:{};for(let $ of Object.keys(d))d[$]&&typeof d[$].toJSON=="function"&&!("toISOString"in d[$])?v[$]=d[$].toJSON():v[$]=d[$];return v}function o(d,v,$){$=i($);var R,I;R=n($),I=s($);var O=[],N=v||"";R.forEach(k=>{var D=a($[k]);D!=="undefined"&&D!=="null"&&O.push(N+u(k)+" = "+b($[k],!0))}),O.length>0&&O.push("");var L=d&&R.length>0?v+"  ":"";return I.forEach(k=>{O.push(P(d,L,k,$[k]))}),O.join(`
`)}function c(d){switch(a(d)){case"undefined":case"null":case"integer":case"nan":case"float":case"boolean":case"string":case"datetime":return!0;case"array":return d.length===0||a(d[0])!=="table";case"table":return Object.keys(d).length===0;default:return!1}}function a(d){return d===void 0?"undefined":d===null?"null":typeof d=="bigint"||Number.isInteger(d)&&!Object.is(d,-0)?"integer":typeof d=="number"?"float":typeof d=="boolean"?"boolean":typeof d=="string"?"string":"toISOString"in d?isNaN(d)?"undefined":"datetime":Array.isArray(d)?"array":"table"}function u(d){var v=String(d);return/^[-A-Za-z0-9_]+$/.test(v)?v:l(v)}function l(d){return'"'+p(d).replace(/"/g,'\\"')+'"'}function h(d){return"'"+d+"'"}function f(d,v){for(;v.length<d;)v="0"+v;return v}function p(d){return d.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/([\u0000-\u001f\u007f])/,v=>"\\u"+f(4,v.codePointAt(0).toString(16)))}function m(d){let v=d.split(/\n/).map($=>p($).replace(/"(?="")/g,'\\"')).join(`
`);return v.slice(-1)==='"'&&(v+=`\\
`),`"""
`+v+'"""'}function b(d,v){let $=a(d);return $==="string"&&(v&&/\n/.test(d)?$="string-multiline":!/[\b\t\n\f\r']/.test(d)&&/"/.test(d)&&($="string-literal")),T(d,$)}function T(d,v){switch(v||(v=a(d)),v){case"string-multiline":return m(d);case"string":return l(d);case"string-literal":return h(d);case"integer":return S(d);case"float":return _(d);case"boolean":return y(d);case"datetime":return g(d);case"array":return C(d.filter($=>a($)!=="null"&&a($)!=="undefined"&&a($)!=="nan"));case"table":return E(d);default:throw t(v)}}function S(d){return String(d).replace(/\B(?=(\d{3})+(?!\d))/g,"_")}function _(d){if(d===1/0)return"inf";if(d===-1/0)return"-inf";if(Object.is(d,NaN))return"nan";if(Object.is(d,-0))return"-0.0";var v=String(d).split("."),$=v[0],R=v[1]||0;return S($)+"."+R}function y(d){return String(d)}function g(d){return d.toISOString()}function w(d){return d==="float"||d==="integer"}function A(d){var v=a(d[0]);return d.every($=>a($)===v)?v:d.every($=>w(a($)))?"float":"mixed"}function x(d){const v=A(d);if(v==="mixed")throw r();return v}function C(d){d=i(d);const v=x(d);var $="[",R=d.map(I=>T(I,v));return R.join(", ").length>60||/\n/.test(R)?$+=`
  `+R.join(`,
  `)+`
`:$+=" "+R.join(", ")+(R.length>0?" ":""),$+"]"}function E(d){d=i(d);var v=[];return Object.keys(d).forEach($=>{v.push(u($)+" = "+b(d[$],!1))}),"{ "+v.join(", ")+(v.length>0?" ":"")+"}"}function P(d,v,$,R){var I=a(R);if(I==="array")return Z(d,v,$,R);if(I==="table")return z(d,v,$,R);throw t(I)}function Z(d,v,$,R){R=i(R),x(R);var I=a(R[0]);if(I!=="table")throw t(I);var O=d+u($),N="";return R.forEach(L=>{N.length>0&&(N+=`
`),N+=v+"[["+O+`]]
`,N+=o(O+".",v,L)}),N}function z(d,v,$,R){var I=d+u($),O="";return n(R).length>0&&(O+=v+"["+I+`]
`),O+o(I+".",v,R)}return stringify.exports}var hasRequiredToml;function requireToml(){return hasRequiredToml||(hasRequiredToml=1,toml.parse=requireParse(),toml.stringify=requireStringify()),toml}requireToml();function zero$1(e){let t=e.length;for(;--t>=0;)e[t]=0}const MIN_MATCH$1=3,MAX_MATCH$1=258,LENGTH_CODES$1=29,LITERALS$1=256,L_CODES$1=LITERALS$1+1+LENGTH_CODES$1,D_CODES$1=30,DIST_CODE_LEN=512,static_ltree=new Array((L_CODES$1+2)*2);zero$1(static_ltree);const static_dtree=new Array(D_CODES$1*2);zero$1(static_dtree);const _dist_code=new Array(DIST_CODE_LEN);zero$1(_dist_code);const _length_code=new Array(MAX_MATCH$1-MIN_MATCH$1+1);zero$1(_length_code);const base_length=new Array(LENGTH_CODES$1);zero$1(base_length);const base_dist=new Array(D_CODES$1);zero$1(base_dist);try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){}const _utf8len=new Uint8Array(256);for(let e=0;e<256;e++)_utf8len[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;_utf8len[254]=_utf8len[254]=1;class Vector2{constructor(t=0,r=0){this.x=t,this.y=r}static from(t){return new Vector2(t.x,t.y)}static zero(){return new Vector2(0,0)}static fromAngle(t){return new Vector2(Math.cos(t),Math.sin(t))}add(t){return new Vector2(this.x+t.x,this.y+t.y)}sub(t){return new Vector2(this.x-t.x,this.y-t.y)}scale(t){return new Vector2(this.x*t,this.y*t)}mult(t){return this.scale(t)}div(t){return t===0?(console.warn("Vector2.div: division by zero"),this):new Vector2(this.x/t,this.y/t)}negate(){return new Vector2(-this.x,-this.y)}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}magSq(){return this.x*this.x+this.y*this.y}normalize(){const t=this.mag();return t===0?this:new Vector2(this.x/t,this.y/t)}setMag(t){return this.normalize().scale(t)}limit(t){return this.magSq()>t*t?this.normalize().scale(t):this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}dist(t){const r=this.x-t.x,n=this.y-t.y;return Math.sqrt(r*r+n*n)}distSq(t){const r=this.x-t.x,n=this.y-t.y;return r*r+n*n}heading(){return Math.atan2(this.y,this.x)}rotate(t){const r=Math.cos(t),n=Math.sin(t);return new Vector2(this.x*r-this.y*n,this.x*n+this.y*r)}lerp(t,r){return new Vector2(this.x+(t.x-this.x)*r,this.y+(t.y-this.y)*r)}equals(t){return this.x===t.x&&this.y===t.y}approxEquals(t,r=1e-10){return Math.abs(this.x-t.x)<r&&Math.abs(this.y-t.y)<r}copy(){return new Vector2(this.x,this.y)}toObject(){return{x:this.x,y:this.y}}toString(){return`Vector2(${this.x}, ${this.y})`}toArray(){return[this.x,this.y]}}var alea$1={exports:{}},alea=alea$1.exports,hasRequiredAlea;function requireAlea(){return hasRequiredAlea||(hasRequiredAlea=1,(function(e){(function(t,r,n){function s(a){var u=this,l=c();u.next=function(){var h=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=h|0)},u.c=1,u.s0=l(" "),u.s1=l(" "),u.s2=l(" "),u.s0-=l(a),u.s0<0&&(u.s0+=1),u.s1-=l(a),u.s1<0&&(u.s1+=1),u.s2-=l(a),u.s2<0&&(u.s2+=1),l=null}function i(a,u){return u.c=a.c,u.s0=a.s0,u.s1=a.s1,u.s2=a.s2,u}function o(a,u){var l=new s(a),h=u&&u.state,f=l.next;return f.int32=function(){return l.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,h&&(typeof h=="object"&&i(h,l),f.state=function(){return i(l,{})}),f}function c(){var a=4022871197,u=function(l){l=String(l);for(var h=0;h<l.length;h++){a+=l.charCodeAt(h);var f=.02519603282416938*a;a=f>>>0,f-=a,f*=a,a=f>>>0,f-=a,a+=f*4294967296}return(a>>>0)*23283064365386963e-26};return u}r&&r.exports?r.exports=o:this.alea=o})(alea,e)})(alea$1)),alea$1.exports}var xor128$1={exports:{}},xor128=xor128$1.exports,hasRequiredXor128;function requireXor128(){return hasRequiredXor128||(hasRequiredXor128=1,(function(e){(function(t,r,n){function s(c){var a=this,u="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var h=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^h^h>>>8},c===(c|0)?a.x=c:u+=c;for(var l=0;l<u.length+64;l++)a.x^=u.charCodeAt(l)|0,a.next()}function i(c,a){return a.x=c.x,a.y=c.y,a.z=c.z,a.w=c.w,a}function o(c,a){var u=new s(c),l=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,p=(u.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=u.next,h.quick=h,l&&(typeof l=="object"&&i(l,u),h.state=function(){return i(u,{})}),h}r&&r.exports?r.exports=o:this.xor128=o})(xor128,e)})(xor128$1)),xor128$1.exports}var xorwow$1={exports:{}},xorwow=xorwow$1.exports,hasRequiredXorwow;function requireXorwow(){return hasRequiredXorwow||(hasRequiredXorwow=1,(function(e){(function(t,r,n){function s(c){var a=this,u="";a.next=function(){var h=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(h^h<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,c===(c|0)?a.x=c:u+=c;for(var l=0;l<u.length+64;l++)a.x^=u.charCodeAt(l)|0,l==u.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function i(c,a){return a.x=c.x,a.y=c.y,a.z=c.z,a.w=c.w,a.v=c.v,a.d=c.d,a}function o(c,a){var u=new s(c),l=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,p=(u.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=u.next,h.quick=h,l&&(typeof l=="object"&&i(l,u),h.state=function(){return i(u,{})}),h}r&&r.exports?r.exports=o:this.xorwow=o})(xorwow,e)})(xorwow$1)),xorwow$1.exports}var xorshift7$1={exports:{}},xorshift7=xorshift7$1.exports,hasRequiredXorshift7;function requireXorshift7(){return hasRequiredXorshift7||(hasRequiredXorshift7=1,(function(e){(function(t,r,n){function s(c){var a=this;a.next=function(){var l=a.x,h=a.i,f,p;return f=l[h],f^=f>>>7,p=f^f<<24,f=l[h+1&7],p^=f^f>>>10,f=l[h+3&7],p^=f^f>>>3,f=l[h+4&7],p^=f^f<<7,f=l[h+7&7],f=f^f<<13,p^=f^f<<9,l[h]=p,a.i=h+1&7,p};function u(l,h){var f,p=[];if(h===(h|0))p[0]=h;else for(h=""+h,f=0;f<h.length;++f)p[f&7]=p[f&7]<<15^h.charCodeAt(f)+p[f+1&7]<<13;for(;p.length<8;)p.push(0);for(f=0;f<8&&p[f]===0;++f);for(f==8?p[7]=-1:p[f],l.x=p,l.i=0,f=256;f>0;--f)l.next()}u(a,c)}function i(c,a){return a.x=c.x.slice(),a.i=c.i,a}function o(c,a){c==null&&(c=+new Date);var u=new s(c),l=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,p=(u.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=u.next,h.quick=h,l&&(l.x&&i(l,u),h.state=function(){return i(u,{})}),h}r&&r.exports?r.exports=o:this.xorshift7=o})(xorshift7,e)})(xorshift7$1)),xorshift7$1.exports}var xor4096$1={exports:{}},xor4096=xor4096$1.exports,hasRequiredXor4096;function requireXor4096(){return hasRequiredXor4096||(hasRequiredXor4096=1,(function(e){(function(t,r,n){function s(c){var a=this;a.next=function(){var l=a.w,h=a.X,f=a.i,p,m;return a.w=l=l+1640531527|0,m=h[f+34&127],p=h[f=f+1&127],m^=m<<13,p^=p<<17,m^=m>>>15,p^=p>>>12,m=h[f]=m^p,a.i=f,m+(l^l>>>16)|0};function u(l,h){var f,p,m,b,T,S=[],_=128;for(h===(h|0)?(p=h,h=null):(h=h+"\0",p=0,_=Math.max(_,h.length)),m=0,b=-32;b<_;++b)h&&(p^=h.charCodeAt((b+32)%h.length)),b===0&&(T=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,b>=0&&(T=T+1640531527|0,f=S[b&127]^=p+T,m=f==0?m+1:0);for(m>=128&&(S[(h&&h.length||0)&127]=-1),m=127,b=512;b>0;--b)p=S[m+34&127],f=S[m=m+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,S[m]=p^f;l.w=T,l.X=S,l.i=m}u(a,c)}function i(c,a){return a.i=c.i,a.w=c.w,a.X=c.X.slice(),a}function o(c,a){c==null&&(c=+new Date);var u=new s(c),l=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,p=(u.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=u.next,h.quick=h,l&&(l.X&&i(l,u),h.state=function(){return i(u,{})}),h}r&&r.exports?r.exports=o:this.xor4096=o})(xor4096,e)})(xor4096$1)),xor4096$1.exports}var tychei$1={exports:{}},tychei=tychei$1.exports,hasRequiredTychei;function requireTychei(){return hasRequiredTychei||(hasRequiredTychei=1,(function(e){(function(t,r,n){function s(c){var a=this,u="";a.next=function(){var h=a.b,f=a.c,p=a.d,m=a.a;return h=h<<25^h>>>7^f,f=f-p|0,p=p<<24^p>>>8^m,m=m-h|0,a.b=h=h<<20^h>>>12^f,a.c=f=f-p|0,a.d=p<<16^f>>>16^m,a.a=m-h|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,c===Math.floor(c)?(a.a=c/4294967296|0,a.b=c|0):u+=c;for(var l=0;l<u.length+20;l++)a.b^=u.charCodeAt(l)|0,a.next()}function i(c,a){return a.a=c.a,a.b=c.b,a.c=c.c,a.d=c.d,a}function o(c,a){var u=new s(c),l=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,p=(u.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=u.next,h.quick=h,l&&(typeof l=="object"&&i(l,u),h.state=function(){return i(u,{})}),h}r&&r.exports?r.exports=o:this.tychei=o})(tychei,e)})(tychei$1)),tychei$1.exports}var seedrandom$3={exports:{}},seedrandom$2=seedrandom$3.exports,hasRequiredSeedrandom$1;function requireSeedrandom$1(){return hasRequiredSeedrandom$1||(hasRequiredSeedrandom$1=1,(function(e){(function(t,r,n){var s=256,i=6,o=52,c="random",a=n.pow(s,i),u=n.pow(2,o),l=u*2,h=s-1,f;function p(g,w,A){var x=[];w=w==!0?{entropy:!0}:w||{};var C=S(T(w.entropy?[g,y(r)]:g??_(),3),x),E=new m(x),P=function(){for(var Z=E.g(i),z=a,d=0;Z<u;)Z=(Z+d)*s,z*=s,d=E.g(1);for(;Z>=l;)Z/=2,z/=2,d>>>=1;return(Z+d)/z};return P.int32=function(){return E.g(4)|0},P.quick=function(){return E.g(4)/4294967296},P.double=P,S(y(E.S),r),(w.pass||A||function(Z,z,d,v){return v&&(v.S&&b(v,E),Z.state=function(){return b(E,{})}),d?(n[c]=Z,z):Z})(P,C,"global"in w?w.global:this==n,w.state)}function m(g){var w,A=g.length,x=this,C=0,E=x.i=x.j=0,P=x.S=[];for(A||(g=[A++]);C<s;)P[C]=C++;for(C=0;C<s;C++)P[C]=P[E=h&E+g[C%A]+(w=P[C])],P[E]=w;(x.g=function(Z){for(var z,d=0,v=x.i,$=x.j,R=x.S;Z--;)z=R[v=h&v+1],d=d*s+R[h&(R[v]=R[$=h&$+z])+(R[$]=z)];return x.i=v,x.j=$,d})(s)}function b(g,w){return w.i=g.i,w.j=g.j,w.S=g.S.slice(),w}function T(g,w){var A=[],x=typeof g,C;if(w&&x=="object")for(C in g)try{A.push(T(g[C],w-1))}catch{}return A.length?A:x=="string"?g:g+"\0"}function S(g,w){for(var A=g+"",x,C=0;C<A.length;)w[h&C]=h&(x^=w[h&C]*19)+A.charCodeAt(C++);return y(w)}function _(){try{var g;return f&&(g=f.randomBytes)?g=g(s):(g=new Uint8Array(s),(t.crypto||t.msCrypto).getRandomValues(g)),y(g)}catch{var w=t.navigator,A=w&&w.plugins;return[+new Date,t,A,t.screen,y(r)]}}function y(g){return String.fromCharCode.apply(0,g)}if(S(n.random(),r),e.exports){e.exports=p;try{f=require$$0}catch{}}else n["seed"+c]=p})(typeof self<"u"?self:seedrandom$2,[],Math)})(seedrandom$3)),seedrandom$3.exports}var seedrandom$1,hasRequiredSeedrandom;function requireSeedrandom(){if(hasRequiredSeedrandom)return seedrandom$1;hasRequiredSeedrandom=1;var e=requireAlea(),t=requireXor128(),r=requireXorwow(),n=requireXorshift7(),s=requireXor4096(),i=requireTychei(),o=requireSeedrandom$1();return o.alea=e,o.xor128=t,o.xorwow=r,o.xorshift7=n,o.xor4096=s,o.tychei=i,seedrandom$1=o,seedrandom$1}var seedrandomExports=requireSeedrandom(),seedrandom=getDefaultExportFromCjs(seedrandomExports);class SeededRandom{rng;constructor(t=0){this.rng=seedrandom(String(t))}reset(t){this.rng=seedrandom(String(t))}random(t,r){const n=this.rng();return t===void 0?n:r===void 0?n*t:t+n*(r-t)}randomInt(t,r){return Math.floor(r===void 0?this.random(t):this.random(t,r))}randomBool(t=.5){return this.rng()<t}gaussian(){let t,r;do t=this.rng(),r=this.rng();while(t===0);return Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*r)}randomGaussian(t=0,r=1){return t+r*this.gaussian()}choice(t){if(t.length===0)throw new Error("Cannot pick from empty array");return t[Math.floor(this.rng()*t.length)]}shuffle(t){for(let r=t.length-1;r>0;r--){const n=Math.floor(this.rng()*(r+1));[t[r],t[n]]=[t[n],t[r]]}return t}}class BasalGeometry{curvedToCartesian(t,r){const n=this.getPointAtArcLength(t),s=this.getNormal(n);return n.add(s.scale(r))}}class StraightLineGeometry extends BasalGeometry{type="line";curvature_1=0;curvature_2=0;perimeter=1/0;projectPoint(t){return new Vector2(t.x,0)}getArcLength(t){return t.x}getPointAtArcLength(t){return new Vector2(t,0)}getNormal(t){return new Vector2(0,1)}}class CircularGeometry extends BasalGeometry{constructor(t,r){super(),this.curvature_1=t,this.curvature_2=r,this.radius=Math.abs(1/t),this.perimeter=2*Math.PI*this.radius,this.dir=-Math.sign(r),this.center=new Vector2(0,1/r)}type="circle";center;radius;perimeter;dir;projectPoint(t){const r=t.sub(this.center);return this.center.add(r.setMag(this.radius))}getArcLength(t){const r=t.sub(this.center);return Math.atan2(this.dir*r.x,this.dir*r.y)*this.radius}getPointAtArcLength(t){const r=t/this.radius;return new Vector2(this.center.x+this.dir*this.radius*Math.cos(r),this.center.y+this.dir*this.radius*Math.sin(r))}getNormal(t){return this.center.sub(t).setMag(Math.sign(this.curvature_2))}}class EllipticalGeometry extends BasalGeometry{constructor(t,r,n=360){super(),this.curvature_1=t,this.curvature_2=r,this.a=Math.abs(1/t),this.b=Math.abs(1/r),this.dir=-Math.sign(r),this.center=new Vector2(0,1/r),this.numPoints=n,this.points=this.discretizeCurve(),this.perimeter=this.points[this.points.length-1].arcLength}type="ellipse";center;a;b;dir;perimeter;points;numPoints;discretizeCurve(){const t=[];let r=0;for(let n=0;n<=this.numPoints;n++){const s=n/this.numPoints*2*Math.PI,i=this.center.x+this.dir*this.a*Math.cos(s),o=this.center.y+this.dir*this.b*Math.sin(s),c=new Vector2(i,o);if(n>0){const f=t[n-1].position,p=c.dist(f);r+=p}const a=c.sub(this.center).scale(this.dir),u=2*a.x/(this.a*this.a),l=2*a.y/(this.b*this.b),h=new Vector2(u,l).setMag(Math.sign(this.curvature_2));t.push({position:c,arcLength:r,theta:s,normal:h})}return t}findBracket(t,r){let n=0,s=this.points.length-1;for(;s-n>1;){const i=Math.floor((n+s)/2);r(this.points[i])<t?n=i:s=i}return[n,s]}interpolate(t,r,n,s){const i=s(t),o=s(r),c=(n-i)/(o-i);return{position:t.position.lerp(r.position,c),arcLength:t.arcLength+c*(r.arcLength-t.arcLength),theta:t.theta+c*(r.theta-t.theta),normal:t.normal.lerp(r.normal,c).normalize()}}projectPoint(t){let r=1/0,n=0;for(let p=0;p<this.points.length;p++){const m=t.distSq(this.points[p].position);m<r&&(r=m,n=p)}const s=n===0?this.points.length-1:n-1,i=n===this.points.length-1?0:n+1,o=this.points[n].position,c=this.points[s].position,a=this.points[i].position,u=this.projectOntoSegment(t,c,o),l=t.distSq(u),h=this.projectOntoSegment(t,o,a),f=t.distSq(h);return l<f?u:h}projectOntoSegment(t,r,n){const s=n.sub(r),i=t.sub(r),o=s.magSq();if(o<1e-10)return r;const c=Math.max(0,Math.min(1,i.dot(s)/o));return r.add(s.scale(c))}getArcLength(t){const r=this.projectPoint(t);let n=1/0,s=0;for(let i=0;i<this.points.length;i++){const o=r.distSq(this.points[i].position);o<n&&(n=o,s=i)}return this.points[s].arcLength}getPointAtArcLength(t){const r=(t%this.perimeter+this.perimeter)%this.perimeter,[n,s]=this.findBracket(r,o=>o.arcLength);return this.interpolate(this.points[n],this.points[s],r,o=>o.arcLength).position}getNormal(t){let r=1/0,n=0;for(let s=0;s<this.points.length;s++){const i=t.distSq(this.points[s].position);i<r&&(r=i,n=s)}return this.points[n].normal}}function createBasalGeometry(e,t,r=360){return e===0&&t===0?new StraightLineGeometry:Math.abs(e-t)<1e-10?new CircularGeometry(e,t):new EllipticalGeometry(e,t,r)}var CellPhase=(e=>(e[e.G1=0]="G1",e[e.G2=1]="G2",e[e.Mitosis=2]="Mitosis",e[e.Division=3]="Division",e))(CellPhase||{});function createInitialEHTState(e="default"){return{cells:[],ap_links:[],ba_links:[],t:0,step_count:0,basalGeometry:new StraightLineGeometry,rngSeed:e}}const boundaryTypeSchema=_enum(["periodic","box","none"]),toyGeneralSchema=object({N:number().int().positive(),soft_radius:number().positive(),repulsion_strength:number().nonnegative(),running_speed:number().nonnegative(),tumble_speed:number().nonnegative(),running_duration:number().positive(),tumbling_duration:number().positive(),tumbling_period:number().positive(),boundary_type:boundaryTypeSchema,domain_size:tuple([number().positive(),number().positive()]),t_end:number().positive(),dt:number().positive(),random_seed:number().int(),mu:number().positive(),n_substeps:number().int().positive(),N_max:number().int().positive(),w_screen:number().positive(),h_screen:number().positive()}),metadataSchema=object({model:literal("Toy"),version:string()}),toyParamsSchema=object({metadata:metadataSchema,general:toyGeneralSchema}),DEFAULT_TOY_GENERAL={N:20,soft_radius:5,repulsion_strength:10,running_speed:2,tumble_speed:.5,running_duration:5,tumbling_duration:2,tumbling_period:.5,boundary_type:"box",domain_size:[100,100],t_end:60,dt:.1,random_seed:42,mu:1,n_substeps:1,w_screen:100,h_screen:100},DEFAULT_TOY_PARAMS={metadata:{model:"Toy",version:"1.0.0"},general:DEFAULT_TOY_GENERAL};function projectOntoSegment(e,t,r){const n=r.sub(t),s=e.sub(t),i=n.magSq();if(i<1e-10)return t;const o=Math.max(0,Math.min(1,s.dot(n)/i));return t.add(n.scale(o))}function projectOntoApicalStrip(e,t){const r=t.cells;if(r.length===0)return e;if(r.length===1)return Vector2.from(r[0].A);let n=Vector2.from(r[0].A),s=e.distSq(n);for(let i=0;i<r.length-1;i++){const o=Vector2.from(r[i].A),c=Vector2.from(r[i+1].A),a=projectOntoSegment(e,o,c),u=e.distSq(a);u<s&&(s=u,n=a)}if(r.length>2){const i=Vector2.from(r[r.length-1].A),o=Vector2.from(r[0].A),c=projectOntoSegment(e,i,o);e.distSq(c)<s&&(n=c)}return n}function projectOntoBasalCurve(e,t){return t.basalGeometry.projectPoint(e)}function computeCellMetrics(e,t){const r=e.cells,n=[],i=10*Math.min(...Object.values(t.cell_types).map(o=>o.R_soft));for(const o of r){const c=Vector2.from(o.pos),a=Vector2.from(o.A),u=Vector2.from(o.B),l=projectOntoApicalStrip(c,e),h=projectOntoBasalCurve(c,e),f=a.dist(c),p=u.dist(c),m=c.dist(l),b=c.dist(h),T=l.sub(h),S=T.magSq();let _=.5;S>1e-10&&(_=c.sub(h).dot(T)/S);const y=_<0,g=_>1;n.push({cell:o,X:c,A:a,B:u,a:l,b:h,AX:f,BX:p,ax:m,bx:b,x:_,below_basal:y,above_apical:g,below_neighbours:!1})}for(let o=0;o<n.length;o++){const c=n[o];let a=!0;for(let u=0;u<n.length;u++){if(o===u)continue;const l=n[u];if(c.X.dist(l.X)<=i&&l.bx<=c.bx){a=!1;break}}c.below_neighbours=a&&n.length>1}return n}function generateCellGroups(e){const t=Object.keys(e.cell_types),r=[];r.push("all");for(const n of t)r.push(n);for(let n=0;n<t.length;n++)for(let s=n+1;s<t.length;s++)r.push(`${t[n]}+${t[s]}`);return r}function filterByGroup(e,t){if(t==="all")return e;if(t.includes("+")){const r=t.split("+");return e.filter(n=>r.includes(n.cell.typeIndex))}return e.filter(r=>r.cell.typeIndex===t)}function aggregateMetrics(e){if(e.length===0)return{ab_distance:0,AX:0,BX:0,ax:0,bx:0,x:0,below_basal:0,above_apical:0,below_neighbours:0};const t=n=>n.reduce((s,i)=>s+i,0)/n.length,r=n=>n.filter(s=>s).length/n.length;return{ab_distance:t(e.map(n=>n.A.dist(n.B))),AX:t(e.map(n=>n.AX)),BX:t(e.map(n=>n.BX)),ax:t(e.map(n=>n.ax)),bx:t(e.map(n=>n.bx)),x:t(e.map(n=>n.x)),below_basal:r(e.map(n=>n.below_basal)),above_apical:r(e.map(n=>n.above_apical)),below_neighbours:r(e.map(n=>n.below_neighbours))}}function computeEHTStatistics(e,t){const r={};if(!t){const n=e.cells.length>0?e.cells.reduce((s,i)=>s+Vector2.from(i.A).dist(Vector2.from(i.B)),0)/e.cells.length:0;return r.ab_distance_all=n,r}try{const n=computeCellMetrics(e,t),s=generateCellGroups(t);for(const i of s){const o=filterByGroup(n,i),c=aggregateMetrics(o);for(const[a,u]of Object.entries(c))r[`${a}_${i}`]=u}}catch(n){console.error("Failed to compute EHT statistics",n)}return r}function generateEHTStatistics(e){const t=[],r=generateCellGroups(e),n=[{id:"ab_distance",label:"AB Distance",description:"Apical-basal distance"},{id:"AX",label:"AX Distance",description:"Distance from A to X"},{id:"BX",label:"BX Distance",description:"Distance from B to X"},{id:"ax",label:"ax Distance",description:"Distance from X to apical projection"},{id:"bx",label:"bx Distance",description:"Distance from X to basal projection"},{id:"x",label:"x Position",description:"Position on basal-apical scale (0-1)"},{id:"below_basal",label:"Below Basal",description:"Fraction of cells below basal layer"},{id:"above_apical",label:"Above Apical",description:"Fraction of cells above apical layer"},{id:"below_neighbours",label:"Below Neighbours",description:"Fraction of cells below all neighbours"}];for(const s of r)for(const i of n)t.push({id:`${i.id}_${s}`,label:`${i.label} (${s})`,description:`${i.description} for ${s} cells`,compute:o=>computeEHTStatistics(o,e)[`${i.id}_${s}`]||0});return t}generateEHTStatistics({metadata:{},general:{},cell_prop:{},cell_types:{control:{}}});function mean(e){return e.length===0?0:e.reduce((t,r)=>t+r,0)/e.length}const TOY_STATISTICS=[{id:"n_cells",label:"Cell Count",description:"Total number of cells",compute:e=>e.cells.length},{id:"running_fraction",label:"Running Fraction",description:"Fraction of cells currently in running phase",compute:e=>e.cells.filter(t=>t.phase==="running").length/(e.cells.length||1)},{id:"avg_x",label:"Avg X Position",description:"Average X position of all cells",compute:e=>mean(e.cells.map(t=>t.position.x))},{id:"avg_y",label:"Avg Y Position",description:"Average Y position of all cells",compute:e=>mean(e.cells.map(t=>t.position.y))}];function computeToyStatistics(e,t){const r={};for(const n of TOY_STATISTICS)r[n.id]=n.compute(e);return r}function generateEHTBatchParameters(e){const t=[];t.push({path:"general.t_end",label:"t_end (End time)"},{path:"general.dt",label:"dt (Time step)"},{path:"general.random_seed",label:"Random seed",isInteger:!0},{path:"general.w_init",label:"w_init (Initial width)"},{path:"general.h_init",label:"h_init (Initial height)"},{path:"general.mu",label:"mu (Friction)"},{path:"general.n_substeps",label:"n_substeps",isInteger:!0},{path:"general.alg_dt",label:"alg_dt (Algorithm dt)"},{path:"general.p_div_out",label:"p_div_out (Division probability)"},{path:"general.perimeter",label:"Perimeter"},{path:"general.aspect_ratio",label:"Aspect ratio"});for(const[r,n]of Object.entries(e.cell_types)){const s=`cell_types.${r}`,i=r;t.push({path:`${s}.N_init`,label:`${i}: N_init`,isInteger:!0},{path:`${s}.location`,label:`${i}: location`},{path:`${s}.R_hard`,label:`${i}: R_hard`},{path:`${s}.R_hard_div`,label:`${i}: R_hard_div`},{path:`${s}.R_soft`,label:`${i}: R_soft`},{path:`${s}.dur_G2`,label:`${i}: dur_G2`},{path:`${s}.dur_mitosis`,label:`${i}: dur_mitosis`},{path:`${s}.k_apical_junction`,label:`${i}: k_apical_junction`},{path:`${s}.k_cytos`,label:`${i}: k_cytos`},{path:`${s}.max_cytoskeleton_length`,label:`${i}: max_cytos_length`},{path:`${s}.run`,label:`${i}: run probability`},{path:`${s}.running_speed`,label:`${i}: running_speed`},{path:`${s}.running_mode`,label:`${i}: running_mode`,isInteger:!0},{path:`${s}.stiffness_apical_apical`,label:`${i}: stiff_apical_apical`},{path:`${s}.stiffness_apical_apical_div`,label:`${i}: stiff_apical_apical_div`},{path:`${s}.stiffness_nuclei_apical`,label:`${i}: stiff_nuclei_apical`},{path:`${s}.stiffness_nuclei_basal`,label:`${i}: stiff_nuclei_basal`},{path:`${s}.stiffness_repulsion`,label:`${i}: stiff_repulsion`},{path:`${s}.stiffness_straightness`,label:`${i}: stiff_straightness`},{path:`${s}.lifespan_start`,label:`${i}: lifespan start`},{path:`${s}.lifespan_end`,label:`${i}: lifespan end`},{path:`${s}.INM`,label:`${i}: INM probability`},{path:`${s}.diffusion`,label:`${i}: diffusion`},{path:`${s}.basal_damping_ratio`,label:`${i}: basal_damping_ratio`},{path:`${s}.max_basal_junction_dist`,label:`${i}: max_basal_junction_dist`},{path:`${s}.cytos_init`,label:`${i}: cytos_init`},{path:`${s}.basal_membrane_repulsion`,label:`${i}: basal_membrane_repulsion`},{path:`${s}.apical_junction_init`,label:`${i}: apical_junction_init`},{path:`${s}.events.time_A_start`,label:`${i}: time_A start`},{path:`${s}.events.time_A_end`,label:`${i}: time_A end`},{path:`${s}.events.time_B_start`,label:`${i}: time_B start`},{path:`${s}.events.time_B_end`,label:`${i}: time_B end`},{path:`${s}.events.time_S_start`,label:`${i}: time_S start`},{path:`${s}.events.time_S_end`,label:`${i}: time_S end`},{path:`${s}.events.time_P_start`,label:`${i}: time_P start`},{path:`${s}.events.time_P_end`,label:`${i}: time_P end`})}return t}const EHT_BATCH_PARAMETERS=[{path:"general.perimeter",label:"Perimeter"},{path:"general.aspect_ratio",label:"Aspect ratio"},{path:"general.random_seed",label:"Random seed",isInteger:!0},{path:"general.t_end",label:"t_end (End time)"},{path:"cell_types.control.diffusion",label:"control: diffusion"},{path:"cell_types.control.max_basal_junction_dist",label:"control: max_basal_junction_dist"},{path:"cell_types.control.apical_junction_init",label:"control: apical_junction_init"}];function ramanujanPerimeter(e,t){if(e===0&&t===0)return 0;if(e===t)return 2*Math.PI*e;const r=e+t,n=e-t,s=n*n/(r*r);return Math.PI*r*(1+3*s/(10+Math.sqrt(4-3*s)))}function computeEllipseFromPerimeter(e,t){if(t===0)return{a:1/0,b:1/0,curvature_1:0,curvature_2:0};const r=Math.sign(t),n=Math.abs(t),s=1,i=n,o=ramanujanPerimeter(s,i),c=e/o,a=c*s,u=c*i,l=a>0?r/a:0,h=u>0?r/u:0;return{a,b:u,curvature_1:l,curvature_2:h}}function createCell(e,t,r,n,s,i,o){const{basalPoint:c,apicalPoint:a,nucleusPosition:u}=n,l=e.general.h_init,h=r.random(s.lifespan_start,s.lifespan_end),f=t.cells.length>0?Math.max(...t.cells.map(p=>p.id))+1:0;if(o===void 0){const p=t.t-r.random(0,h);let m=r.random(s.events.time_A_start,s.events.time_A_end),b=r.random(s.events.time_B_start,s.events.time_B_end),T=r.random(s.events.time_S_start,s.events.time_S_end);const S=r.random()<=s.run?b:1/0;return s.hetero&&(r.random()>.7&&(m=1/0),r.random()>.7&&(b=1/0),r.random()>.7&&(T=1/0)),{id:f,typeIndex:i,pos:u.toObject(),A:a.toObject(),B:c.toObject(),R_soft:s.R_soft,R_hard:s.R_hard,eta_A:l/2,eta_B:l/2,has_A:!0,has_B:!0,phase:CellPhase.G1,birth_time:p,division_time:p+h,is_running:!1,running_mode:s.running_mode,has_inm:r.random()<=s.INM,time_A:m,time_B:b,time_S:T,time_P:S,stiffness_apical_apical:s.stiffness_apical_apical,stiffness_straightness:s.stiffness_straightness,stiffness_nuclei_apical:s.stiffness_nuclei_apical,stiffness_nuclei_basal:s.stiffness_nuclei_basal}}else return{id:f,typeIndex:i,pos:u.toObject(),A:a.toObject(),B:c.toObject(),R_soft:s.R_soft,R_hard:s.R_hard,eta_A:o.eta_A,eta_B:o.eta_B,has_A:o.has_A,has_B:o.has_B,phase:CellPhase.G1,birth_time:t.t,division_time:t.t+h,is_running:o.is_running,running_mode:o.running_mode,has_inm:o.has_inm,time_A:o.time_A,time_B:o.time_B,time_S:o.time_S,time_P:o.time_P,stiffness_apical_apical:s.stiffness_apical_apical,stiffness_straightness:o.stiffness_straightness,stiffness_nuclei_apical:o.stiffness_nuclei_apical,stiffness_nuclei_basal:o.stiffness_nuclei_basal}}function getCellType(e,t){return e.cell_types[t.typeIndex]||e.cell_types.control}function updateCellPhase(e,t,r){const n=e.division_time,s=n-t.dur_G2-t.dur_mitosis,i=n-t.dur_mitosis;r<s?e.phase=CellPhase.G1:r<i?e.phase=CellPhase.G2:r<n?e.phase=CellPhase.Mitosis:e.phase=CellPhase.Division}function initializeEHTSimulation(e,t,r){const n=e.general,s=computeEllipseFromPerimeter(n.perimeter,n.aspect_ratio);t.geometry={curvature_1:s.curvature_1,curvature_2:s.curvature_2};const{curvature_1:i,curvature_2:o}=t.geometry;t.basalGeometry=createBasalGeometry(i,o,360);const c=Object.entries(e.cell_types),a=c.reduce((_,[,y])=>_+y.N_init,0),u=[];for(let _=0;_<a;_++)u.push([-1+2*_/a,""]);c.sort((_,y)=>{const g=_[1].location!==""?1:0;return(y[1].location!==""?1:0)-g});for(const[_,y]of c)if(y.location!==""){let g;y.location==="top"?g=1:y.location==="bottom"?g=0:(g=parseFloat(y.location),(isNaN(g)||g<-1||g>1)&&(g=0)),u.sort((A,x)=>Math.min(Math.abs(A[0]-g),Math.abs(A[0]+2-g))-Math.min(Math.abs(x[0]-g),Math.abs(x[0]+2-g)));let w=0;for(let A=0;A<u.length&&w<y.N_init;A++)u[A][1]===""&&(u[A]=[u[A][0],_],w++)}u.sort((_,y)=>_[0]-y[0]);let l=0;for(let _=0;_<u.length;_++)if(u[_][1]==="")for(;l<c.length;){const[y,g]=c[l];if(u.filter(A=>A[1]===y).length<g.N_init){u[_]=[u[_][0],y];break}else l++}u.sort((_,y)=>_[0]-y[0]);const h=i===0&&o===0,f=h?n.w_init*4:ramanujanPerimeter(Math.abs(1/i),Math.abs(1/o)),p=n.full_circle?f:n.w_init,m=n.h_init,b=n.aspect_ratio<0?-1:1,T=[],S=[];for(let _=0;_<a;_++){const y=h?u[_][0]*(p/2):u[_][0]*(p/2)+f/4,g=t.basalGeometry.getPointAtArcLength(y),w=t.basalGeometry.getNormal(g).scale(b),A=g.add(w.scale(m)),x=r.random(m/3,2*m/3),C=g.add(w.scale(x));T.push({basalPoint:g,apicalPoint:A,nucleusPosition:C}),S.push(u[_][1])}t.cells=[];for(let _=0;_<T.length;_++){const y=S[_],g=e.cell_types[y];if(!g){console.warn("No cell type found for key",y);continue}const w=createCell(e,t,r,T[_],g,y);t.cells.push(w)}for(let _=0;_<t.cells.length-1;_++){const y=e.cell_types[t.cells[_].typeIndex],g=e.cell_types[t.cells[_+1].typeIndex],w=(y.apical_junction_init+g.apical_junction_init)/2;t.ap_links.push({l:_,r:_+1,rl:w}),t.ba_links.push({l:_,r:_+1})}if(n.full_circle&&t.cells.length>2){const _=t.cells.length-1,y=e.cell_types[t.cells[_].typeIndex],g=e.cell_types[t.cells[0].typeIndex],w=(y.apical_junction_init+g.apical_junction_init)/2;t.ap_links.push({l:_,r:0,rl:w}),t.ba_links.push({l:_,r:0})}}function zeroForces(){return{f:Vector2.zero(),fA:Vector2.zero(),fB:Vector2.zero()}}function calcRepulsionForces(e,t,r){const n=e.cells,s=n.length;for(let i=0;i<s;i++){const o=n[i],c=getCellType(t,o),a=Vector2.from(o.pos);for(let u=0;u<i;u++){const l=n[u];if(Math.abs(o.pos.x-l.pos.x)>=2)continue;const h=getCellType(t,l),p=Vector2.from(l.pos).sub(a),m=p.mag(),b=o.R_soft+l.R_soft,T=c.stiffness_repulsion+h.stiffness_repulsion;if(m<b&&m>b/20){const S=-T*(b-m)/(m*b*b),_=p.scale(S);r[i].f=r[i].f.add(_),r[u].f=r[u].f.sub(_)}}}}function calcApicalNucleiForces(e,t,r){const n=e.cells,s=t.general.hard_sphere_nuclei;for(let i=0;i<n.length;i++){const o=n[i],c=Vector2.from(o.pos),a=Vector2.from(o.A),u=c.sub(a),l=u.mag();if(l>0){const h=s?o.R_hard:o.R_soft,f=o.eta_A+h,m=2*o.stiffness_nuclei_apical*(l-f)/(l*f*f),b=u.scale(m);r[i].f=r[i].f.sub(b),r[i].fA=r[i].fA.add(b)}}}function calcBasalNucleiForces(e,t,r){const n=e.cells,s=t.general.hard_sphere_nuclei;for(let i=0;i<n.length;i++){const o=n[i],c=Vector2.from(o.pos),a=Vector2.from(o.B),u=c.sub(a),l=u.mag();if(l>0){const h=s?o.R_hard:o.R_soft,f=o.eta_B+h,m=2*o.stiffness_nuclei_basal*(l-f)/(l*f*f),b=u.scale(m);r[i].f=r[i].f.sub(b),r[i].fB=r[i].fB.add(b)}}}function calcStraightnessForces(e,t,r){const n=e.cells;for(let s=0;s<n.length;s++){const i=n[s],o=Vector2.from(i.pos),c=Vector2.from(i.A),a=Vector2.from(i.B),u=o.sub(c),l=o.sub(a),h=u.mag(),f=l.mag(),p=u.dot(l);if(p!==0&&h>0&&f>0){const m=i.stiffness_straightness/(h*f),b=l.scale(-1).add(u.scale(p/(h*h))).scale(m),T=u.scale(-1).add(l.scale(p/(f*f))).scale(m);r[s].fA=r[s].fA.sub(b),r[s].f=r[s].f.add(b),r[s].f=r[s].f.add(T),r[s].fB=r[s].fB.sub(T)}}}function calcApicalJunctionForces(e,t,r){const n=e.cells,s=e.ap_links;for(const i of s){const o=n[i.l],c=n[i.r],a=Vector2.from(o.A),u=Vector2.from(c.A),l=a.sub(u),h=l.mag();if(h>1e-6){const f=.5*(o.stiffness_apical_apical+c.stiffness_apical_apical),p=l.scale(.25*f*(h-i.rl)/h);r[i.l].fA=r[i.l].fA.sub(p),r[i.r].fA=r[i.r].fA.add(p)}}}function calcAllForces(e,t){const r=e.cells.map(()=>zeroForces());return calcRepulsionForces(e,t,r),calcApicalNucleiForces(e,t,r),calcBasalNucleiForces(e,t,r),calcStraightnessForces(e,t,r),calcApicalJunctionForces(e,t,r),r}function projectHardSphereConstraints(e,t){const r=e.cells,n=r.length;for(let s=0;s<n;s++){const i=r[s];for(let o=0;o<s;o++){const c=r[o],a=i.R_hard+c.R_hard,u=Vector2.from(i.pos),l=Vector2.from(c.pos),h=u.dist(l)-a;if(h<0&&h!==-a){const p=u.sub(l).scale(.5*h/(h+a));i.pos.x-=p.x,i.pos.y-=p.y,c.pos.x+=p.x,c.pos.y+=p.y}}}}function projectBasalOrderingConstraints(e,t){const r=e.cells,n=e.ba_links,s=e.geometry?.curvature_1??0,i=e.geometry?.curvature_2??0;for(const o of n){const c=r[o.l],a=r[o.r],u=Vector2.from(c.B),l=Vector2.from(a.B);e.basalGeometry.getArcLength(u),e.basalGeometry.getArcLength(l),t.general.full_circle}}function projectMaxBasalDistanceConstraints(e,t){const r=e.cells,n=e.ba_links;for(const s of n){const i=r[s.l],o=r[s.r],c=getCellType(t,i),a=getCellType(t,o),u=(c.max_basal_junction_dist+a.max_basal_junction_dist)/2,l=Vector2.from(i.B),h=Vector2.from(o.B),f=l.dist(h);if(f>u){const p=f-u,b=h.sub(l).normalize().scale(p/2);i.B.x+=b.x,i.B.y+=b.y,o.B.x-=b.x,o.B.y-=b.y}}}function projectBasalCurveConstraints(e,t){const r=e.cells;for(const n of r){if(!n.has_B)continue;const s=Vector2.from(n.B),i=e.basalGeometry.projectPoint(s);n.B.x=i.x,n.B.y=i.y}}function applyAllConstraints(e,t){projectHardSphereConstraints(e),projectBasalOrderingConstraints(e,t),projectMaxBasalDistanceConstraints(e,t),projectBasalCurveConstraints(e)}function processLoseApicalAdhesion(e,t){const r=e.cells[t];r.has_A=!1,r.stiffness_nuclei_apical*=.1;const n=[];let s={l:0,r:0,rl:0};for(let i=0;i<e.ap_links.length;i++){const o=e.ap_links[i];o.l===t&&(n.push(i),s.r=o.r),o.r===t&&(n.push(i),s.l=o.l)}if(n.length===1)e.ap_links.splice(n[0],1);else if(n.length===2){n.sort((c,a)=>a-c),e.ap_links.splice(n[0],1),e.ap_links.splice(n[1],1);const i=e.cells[s.l],o=e.cells[s.r];s.rl=Vector2.from(i.A).dist(Vector2.from(o.A)),e.ap_links.push(s)}}function processLoseBasalAdhesion(e,t){const r=e.cells[t];r.has_B=!1,r.stiffness_nuclei_basal*=.1;const n=[];let s={l:0,r:0};for(let i=0;i<e.ba_links.length;i++){const o=e.ba_links[i];o.l===t&&(n.push(i),s.r=o.r),o.r===t&&(n.push(i),s.l=o.l)}n.length===1?e.ba_links.splice(n[0],1):n.length===2&&(n.sort((i,o)=>o-i),e.ba_links.splice(n[0],1),e.ba_links.splice(n[1],1),e.ba_links.push(s))}function processLoseStraightness(e,t){const r=e.cells[t];r.stiffness_straightness=1}function processStartRunning(e,t){const r=e.cells[t];r.running_mode=3}function updateRunningState(e){e.is_running=!e.has_B&&e.B.y>-2&&(e.running_mode>=3||e.B.y<0&&e.running_mode>=1)}function processEMTEvents(e,t,r){const n=e.t;for(let s=0;s<e.cells.length;s++){const i=e.cells[s];n<=i.time_A&&n+r>i.time_A&&processLoseApicalAdhesion(e,s),n<=i.time_B&&n+r>i.time_B&&(console.log("Event B"),processLoseBasalAdhesion(e,s)),n<=i.time_S&&n+r>i.time_S&&processLoseStraightness(e,s),(i.time_P>i.time_B&&n<=i.time_P&&n+r>i.time_P||i.time_P<=i.time_B&&n<=i.time_B&&n+r>i.time_B)&&processStartRunning(e,s),updateRunningState(i)}}function processCellDivisions(e,t,r){let n=0;for(let s=0;s<e.cells.length;s++){const i=e.cells[s];if(i.phase!==CellPhase.Division)continue;const o=getCellType(t,i),c={basalPoint:Vector2.from(i.B),apicalPoint:Vector2.from(i.A),nucleusPosition:Vector2.from(i.pos)};if(i.typeIndex==="emt"){const a=createCell(t,e,r,c,o,i.typeIndex,i);a.id=i.id,e.cells[s]=a}else if(r.random()<t.general.p_div_out){const u=createCell(t,e,r,c,o,i.typeIndex,i);u.id=i.id,e.cells[s]=u}else{n++;const u=createCell(t,e,r,c,o,i.typeIndex,i);u.id=i.id,e.cells[s]=u;const l=createCell(t,e,r,c,o,i.typeIndex,u),h=.05*u.R_soft;u.pos.x-=h,l.pos.x+=h,u.A.x-=h,l.A.x+=h,u.B.x-=h,l.B.x+=h;const f=e.cells.length;e.cells.push(l),updateApicalLinksAfterDivision(e,t,s,f),updateBasalLinksAfterDivision(e,t,s,f)}}return n}function updateApicalLinksAfterDivision(e,t,r,n){for(const i of e.ap_links)i.l===r&&(i.l=n);const s=getCellType(t,e.cells[r]);e.ap_links.push({l:r,r:n,rl:s.apical_junction_init})}function updateBasalLinksAfterDivision(e,t,r,n){for(const s of e.ba_links)s.l===r&&(s.l=n);e.ba_links.push({l:r,r:n})}function updateCytoskeleton(e,t,r){for(const n of e.cells){const s=getCellType(t,n),i=Vector2.from(n.pos),o=Vector2.from(n.A),c=Vector2.from(n.B),a=i.dist(o),u=i.dist(c);let l=0,h=0;switch(n.phase+(n.has_inm?0:10)){case CellPhase.G2:case CellPhase.Mitosis:const m=o.dist(c);l=0,h=Math.max(0,m-2*n.R_soft);break;default:l=Math.max(0,a-n.R_soft),h=Math.max(0,u-n.R_soft)}n.phase===CellPhase.G2&&(n.stiffness_apical_apical=s.stiffness_apical_apical_div),n.phase===CellPhase.Mitosis&&(n.R_hard=s.R_hard_div),n.has_A||(l=0),n.has_B||(h=0);const p=Math.exp(-r*s.k_cytos);if(n.eta_A=p*(n.eta_A-l)+l,n.has_B?n.eta_B=p*(n.eta_B-h)+h:n.running_mode>=2&&n.B.y>0?n.eta_B=Vector2.from(n.B).dist(i)-n.R_soft:n.eta_B=p*(n.eta_B-h)+h,!n.is_running||n.has_B){const m=s.max_cytoskeleton_length,b=n.eta_A+n.eta_B-m;if(m>0&&b>1){const T=n.eta_A+n.eta_B,S=n.eta_A*m/T,_=n.eta_B*m/T;n.eta_A=p*(n.eta_A-S)+S,n.eta_B=p*(n.eta_B-_)+_}}}}function updateApicalJunctions(e,t,r){for(const n of e.ap_links){const s=e.cells[n.l],i=e.cells[n.r],o=getCellType(t,s),c=getCellType(t,i),a=.5*o.k_apical_junction+.5*c.k_apical_junction;n.rl=n.rl*Math.exp(-r*a)}}function integrateForces(e,t,r,n,s){const i=t.general.mu,o=Math.sqrt(s);for(let c=0;c<e.cells.length;c++){const a=e.cells[c],u=getCellType(t,a),l=r[c],h=u.diffusion;if(a.pos.x+=o*h*n.gaussian(),a.pos.y+=o*h*n.gaussian(),a.pos.x+=s*l.f.x/i,a.pos.y+=s*l.f.y/i,a.A.x+=s*l.fA.x/i,a.A.y+=s*l.fA.y/i,a.is_running){const f=Vector2.from(a.B),p=Vector2.from(a.pos);if(f.dist(p)<5){const m=f.sub(p).normalize();a.B.x+=s*m.x*u.running_speed,a.B.y+=s*m.y*u.running_speed}}else a.B.x+=s*l.fB.x/i,a.B.y+=s*l.fB.y/i,a.has_B||(a.B.y+=s*l.fB.y/i)}}function performTimestep(e,t,r){const n=t.general,s=n.dt;for(const c of e.cells){const a=getCellType(t,c);updateCellPhase(c,a,e.t)}const i=processCellDivisions(e,t,r);processEMTEvents(e,t,s),updateCytoskeleton(e,t,s),updateApicalJunctions(e,t,s);const o=s/n.n_substeps;for(let c=0;c<n.n_substeps;c++){e.t+=o;const a=calcAllForces(e,t);integrateForces(e,t,a,r,o),applyAllConstraints(e,t)}return e.step_count++,i}function getNeighborIds(e,t,r){const n=[];for(const s of t)s.l===e?n.push(s.r):s.r===e&&n.push(s.l);return n.map(s=>r[s]?.id??s).join(";")}function getSnapshot(e){const t=[];for(let r=0;r<e.cells.length;r++){const n=e.cells[r];t.push({id:n.id,typeIndex:n.typeIndex,t:e.t,step_count:e.step_count,pos_x:n.pos.x,pos_y:n.pos.y,A_x:n.A.x,A_y:n.A.y,B_x:n.B.x,B_y:n.B.y,has_A:n.has_A,has_B:n.has_B,phase:n.phase,age:e.t-n.birth_time,is_running:n.is_running,running_mode:n.running_mode,has_inm:n.has_inm,eta_A:n.eta_A,eta_B:n.eta_B,R_soft:n.R_soft,R_hard:n.R_hard,time_A:n.time_A,time_B:n.time_B,time_S:n.time_S,time_P:n.time_P,apical_neighbors:getNeighborIds(r,e.ap_links,e.cells),basal_neighbors:getNeighborIds(r,e.ba_links,e.cells),curvature_1:e.geometry?.curvature_1??0,curvature_2:e.geometry?.curvature_2??0})}return t}function loadSnapshot(e,t){if(e.length===0)return{cells:[],ap_links:[],ba_links:[],t:0,step_count:0,basalGeometry:createBasalGeometry(0,0,360),rngSeed:String(t.general.random_seed)};const r=e[0],n=Number(r.t),s=Number(r.step_count),i=Number(r.curvature_1),o=Number(r.curvature_2),c={cells:[],ap_links:[],ba_links:[],t:n,step_count:s,geometry:{curvature_1:i,curvature_2:o},basalGeometry:createBasalGeometry(i,o,360),rngSeed:String(t.general.random_seed)},a=new Map;for(let u=0;u<e.length;u++){const l=e[u],h=Number(l.id);a.set(h,u);const f={id:h,typeIndex:String(l.typeIndex),pos:{x:Number(l.pos_x),y:Number(l.pos_y)},A:{x:Number(l.A_x),y:Number(l.A_y)},B:{x:Number(l.B_x),y:Number(l.B_y)},has_A:!!l.has_A,has_B:!!l.has_B,phase:Number(l.phase),birth_time:n-Number(l.age),division_time:0,is_running:!!l.is_running,running_mode:Number(l.running_mode),has_inm:!!l.has_inm,eta_A:Number(l.eta_A),eta_B:Number(l.eta_B),R_soft:Number(l.R_soft),R_hard:Number(l.R_hard),time_A:Number(l.time_A),time_B:Number(l.time_B),time_S:Number(l.time_S),time_P:Number(l.time_P),stiffness_apical_apical:1,stiffness_straightness:Number(l.time_S)<n?1:100,stiffness_nuclei_apical:l.has_A?1:.1,stiffness_nuclei_basal:l.has_B?1:.1},p=t.cell_types[f.typeIndex]||t.cell_types.control;f.stiffness_apical_apical=p.stiffness_apical_apical,l.has_A?f.stiffness_nuclei_apical=p.stiffness_nuclei_apical:f.stiffness_nuclei_apical=p.stiffness_nuclei_apical*.1,l.has_B?f.stiffness_nuclei_basal=p.stiffness_nuclei_basal:f.stiffness_nuclei_basal=p.stiffness_nuclei_basal*.1,f.time_S&&n>f.time_S?f.stiffness_straightness=1:f.stiffness_straightness=p.stiffness_straightness,f.division_time=f.birth_time+(p.lifespan_end+p.lifespan_start)/2,c.cells.push(f)}for(let u=0;u<e.length;u++){const l=e[u],h=u,f=String(l.apical_neighbors||"").split(";").filter(m=>m!=="");for(const m of f){const b=Number(m),T=a.get(b);if(T!==void 0&&T>h){const S=c.cells[h],_=c.cells[T],y=Math.sqrt(Math.pow(S.A.x-_.A.x,2)+Math.pow(S.A.y-_.A.y,2));c.ap_links.push({l:h,r:T,rl:y})}}const p=String(l.basal_neighbors||"").split(";").filter(m=>m!=="");for(const m of p){const b=Number(m),T=a.get(b);T!==void 0&&T>h&&c.ba_links.push({l:h,r:T})}}return c}console.log("[Models Worker] Loading worker-safe index");const TOY_BATCH_PARAMETERS=[{path:"general.N",label:"Number of cells",isInteger:!0},{path:"general.soft_radius",label:"Soft radius"},{path:"general.repulsion_strength",label:"Repulsion strength"},{path:"general.running_speed",label:"Running speed"},{path:"general.tumble_speed",label:"Tumble speed"},{path:"general.running_duration",label:"Running duration"},{path:"general.tumbling_duration",label:"Tumbling duration"},{path:"general.tumbling_period",label:"Tumbling period"},{path:"general.random_seed",label:"Random seed",isInteger:!0},{path:"general.t_end",label:"End time"}],EHTModelWorker={id:"EHT",name:"Epithelial-to-Hematopoietic Transition",version:"1.0.0",description:"Simulates cell mechanics, division, and EMT events in curved epithelial tissue.",defaultParams:DEFAULT_EHT_PARAMS,validateParams(e){return ehtParamsSchema.parse(e)},init:(e,t)=>{const r=t??String(e.general.random_seed),n=new SeededRandom(r),s=createInitialEHTState(r);return initializeEHTSimulation(e,s,n),s},step:(e,t,r)=>{const n=new SeededRandom(`${e.rngSeed}_step_${e.step_count}`);return performTimestep(e,r,n),e},getSnapshot:e=>getSnapshot(e),loadSnapshot:(e,t)=>loadSnapshot(e,t),computeStats:(e,t)=>computeEHTStatistics(e,t),statistics:generateEHTStatistics(DEFAULT_EHT_PARAMS),generateStatistics:e=>generateEHTStatistics(e),generateBatchParameters:e=>generateEHTBatchParameters(e),batchParameters:EHT_BATCH_PARAMETERS,renderer:null,ui:void 0},ToyModelWorker={id:"Toy",name:"Run & Tumble (Toy)",version:"1.0.0",description:"Simple run-and-tumble model for demonstration purposes.",defaultParams:DEFAULT_TOY_PARAMS,validateParams(e){return toyParamsSchema.parse(e)},init:(e,t)=>{const r=t??String(e.general.random_seed),n=new SeededRandom(r),{N:s,domain_size:i}=e.general,[o,c]=i,a=[];for(let u=0;u<s;u++){const l=n.random(o),h=n.random(c),f=n.random(2*Math.PI),p=n.random()>.5?"running":"tumbling";a.push({id:u,position:new Vector2(l,h),prevPosition:new Vector2(l,h),polarity:new Vector2(Math.cos(f),Math.sin(f)),phase:p,phaseTime:0,timeSinceLastTumble:0})}return{time:0,cells:a,stepCount:0,rngSeed:r}},step:(e,t,r)=>{const n=new SeededRandom(`${e.rngSeed}_step_${e.stepCount}`),{soft_radius:s,repulsion_strength:i,running_speed:o,tumble_speed:c,mu:a,boundary_type:u,domain_size:l,running_duration:h,tumbling_duration:f,tumbling_period:p}=r.general,[m,b]=l,T=e.cells;for(const _ of T)if(_.phaseTime+=t,_.phase==="running"){if(_.phaseTime>=h){_.phase="tumbling",_.phaseTime=0,_.timeSinceLastTumble=0;const y=n.random(2*Math.PI);_.polarity=new Vector2(Math.cos(y),Math.sin(y))}}else{if(_.timeSinceLastTumble+=t,_.timeSinceLastTumble>=p){const y=n.random(2*Math.PI);_.polarity=new Vector2(Math.cos(y),Math.sin(y)),_.timeSinceLastTumble=0}_.phaseTime>=f&&(_.phase="running",_.phaseTime=0)}const S=T.map(()=>Vector2.zero());for(let _=0;_<T.length;_++)for(let y=_+1;y<T.length;y++){const g=T[_],w=T[y],A=g.position.x-w.position.x,x=g.position.y-w.position.y,C=A*A+x*x,E=s;if(C<E*E&&C>0){const P=Math.sqrt(C),Z=E-P,z=i*Z*A/P,d=i*Z*x/P,v=new Vector2(z,d);S[_]=S[_].add(v),S[y]=S[y].sub(v)}}for(let _=0;_<T.length;_++){const y=T[_],g=y.phase==="running"?o:c,w=y.polarity.mult(g*a);S[_]=S[_].add(w)}for(let _=0;_<T.length;_++){const y=T[_],g=S[_];y.prevPosition=y.position;const w=g.x*t/a,A=g.y*t/a;y.position=new Vector2(y.position.x+w,y.position.y+A),u==="periodic"?y.position=new Vector2((y.position.x%m+m)%m,(y.position.y%b+b)%b):u==="box"&&(y.position=new Vector2(Math.max(0,Math.min(m,y.position.x)),Math.max(0,Math.min(b,y.position.y))))}return e.time+=t,e.stepCount+=1,e},getSnapshot:e=>e.cells.map(t=>({id:t.id,t:e.time,pos_x:t.position.x,pos_y:t.position.y,phase:t.phase,pol_x:t.polarity.x,pol_y:t.polarity.y})),loadSnapshot:(e,t)=>{if(e.length===0)return{time:0,cells:[],stepCount:0,rngSeed:String(t.general.random_seed)};const r=Number(e[0].t),n=e.map(i=>({id:Number(i.id),position:new Vector2(Number(i.pos_x),Number(i.pos_y)),prevPosition:new Vector2(Number(i.pos_x),Number(i.pos_y)),polarity:new Vector2(Number(i.pol_x),Number(i.pol_y)),phase:i.phase,phaseTime:0,timeSinceLastTumble:0})),s=Math.round(r/t.general.dt);return{time:r,cells:n,stepCount:s,rngSeed:String(t.general.random_seed)}},computeStats:(e,t)=>computeToyStatistics(e),statistics:TOY_STATISTICS,generateStatistics:e=>TOY_STATISTICS,generateBatchParameters:e=>TOY_BATCH_PARAMETERS,batchParameters:TOY_BATCH_PARAMETERS,renderer:null,ui:void 0};modelRegistry.register(EHTModelWorker),modelRegistry.register(ToyModelWorker),modelRegistry.setDefault(EHTModelWorker.id);function runSimulation(e){const{modelName:t,baseParams:r,overrides:n,seed:s,timeSamples:i,runIndex:o}=e,c=modelRegistry.get(t);if(!c)throw new Error(`Model "${t}" not found in worker registry.`);const a=structuredClone(r);for(const[f,p]of Object.entries(n))setNestedValue(a,f,p);a.general.random_seed=s;const u=new SimulationEngine({model:c,params:a});u.init();const l=[];let h=0;if(i.length>0&&i[0]<=0){const f=c.getSnapshot(u.getState());l.push({run_index:o,seed:s,time_h:0,sampled_params:n,data:f}),h=1}for(;!u.isComplete()&&h<i.length;){u.step();const f=u.getState(),p=f.t??0;for(;h<i.length&&p>=i[h];){const m=c.getSnapshot(f);l.push({run_index:o,seed:s,time_h:i[h],sampled_params:n,data:m}),h++}}return l}self.onmessage=e=>{const t=e.data;if(t.type==="run")try{const r=runSimulation(t),n={type:"complete",runIndex:t.runIndex,snapshots:r};self.postMessage(n)}catch(r){const n={type:"error",runIndex:t.runIndex,error:r instanceof Error?r.message:String(r)};self.postMessage(n)}}})();
//# sourceMappingURL=simulation.worker-B6IuH6Fh.js.map
