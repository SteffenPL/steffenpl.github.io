(function(){"use strict";var freeGlobal=typeof globalThis=="object"&&globalThis&&globalThis.Object===Object&&globalThis,freeSelf=typeof self=="object"&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),Symbol$1=root.Symbol,objectProto$b=Object.prototype,hasOwnProperty$8=objectProto$b.hasOwnProperty,nativeObjectToString$1=objectProto$b.toString,symToStringTag$1=Symbol$1?Symbol$1.toStringTag:void 0;function getRawTag(e){var t=hasOwnProperty$8.call(e,symToStringTag$1),r=e[symToStringTag$1];try{e[symToStringTag$1]=void 0;var n=!0}catch{}var s=nativeObjectToString$1.call(e);return n&&(t?e[symToStringTag$1]=r:delete e[symToStringTag$1]),s}var objectProto$a=Object.prototype,nativeObjectToString=objectProto$a.toString;function objectToString(e){return nativeObjectToString.call(e)}var nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$1?Symbol$1.toStringTag:void 0;function baseGetTag(e){return e==null?e===void 0?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(e)?getRawTag(e):objectToString(e)}function isObjectLike(e){return e!=null&&typeof e=="object"}var isArray=Array.isArray;function isObject$1(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var asyncTag="[object AsyncFunction]",funcTag$2="[object Function]",genTag$1="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction(e){if(!isObject$1(e))return!1;var t=baseGetTag(e);return t==funcTag$2||t==genTag$1||t==asyncTag||t==proxyTag}var coreJsData=root["__core-js_shared__"],maskSrcKey=(function(){var e=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""})();function isMasked(e){return!!maskSrcKey&&maskSrcKey in e}var funcProto$1=Function.prototype,funcToString$1=funcProto$1.toString;function toSource(e){if(e!=null){try{return funcToString$1.call(e)}catch{}try{return e+""}catch{}}return""}var reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto=Function.prototype,objectProto$9=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$7=objectProto$9.hasOwnProperty,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty$7).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative(e){if(!isObject$1(e)||isMasked(e))return!1;var t=isFunction(e)?reIsNative:reIsHostCtor;return t.test(toSource(e))}function getValue(e,t){return e?.[t]}function getNative(e,t){var r=getValue(e,t);return baseIsNative(r)?r:void 0}var WeakMap$1=getNative(root,"WeakMap"),objectCreate=Object.create,baseCreate=(function(){function e(){}return function(t){if(!isObject$1(t))return{};if(objectCreate)return objectCreate(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}})(),defineProperty=(function(){try{var e=getNative(Object,"defineProperty");return e({},"",{}),e}catch{}})();function arrayEach(e,t){for(var r=-1,n=e==null?0:e.length;++r<n&&t(e[r],r,e)!==!1;);return e}var MAX_SAFE_INTEGER$1=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex(e,t){var r=typeof e;return t=t??MAX_SAFE_INTEGER$1,!!t&&(r=="number"||r!="symbol"&&reIsUint.test(e))&&e>-1&&e%1==0&&e<t}function baseAssignValue(e,t,r){t=="__proto__"&&defineProperty?defineProperty(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function eq(e,t){return e===t||e!==e&&t!==t}var objectProto$8=Object.prototype,hasOwnProperty$6=objectProto$8.hasOwnProperty;function assignValue(e,t,r){var n=e[t];(!(hasOwnProperty$6.call(e,t)&&eq(n,r))||r===void 0&&!(t in e))&&baseAssignValue(e,t,r)}var MAX_SAFE_INTEGER=9007199254740991;function isLength(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER}function isArrayLike(e){return e!=null&&isLength(e.length)&&!isFunction(e)}var objectProto$7=Object.prototype;function isPrototype(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||objectProto$7;return e===r}function baseTimes(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var argsTag$2="[object Arguments]";function baseIsArguments(e){return isObjectLike(e)&&baseGetTag(e)==argsTag$2}var objectProto$6=Object.prototype,hasOwnProperty$5=objectProto$6.hasOwnProperty,propertyIsEnumerable$1=objectProto$6.propertyIsEnumerable,isArguments=baseIsArguments((function(){return arguments})())?baseIsArguments:function(e){return isObjectLike(e)&&hasOwnProperty$5.call(e,"callee")&&!propertyIsEnumerable$1.call(e,"callee")};function stubFalse(){return!1}var freeExports$2=typeof exports=="object"&&exports&&!exports.nodeType&&exports,freeModule$2=freeExports$2&&typeof module=="object"&&module&&!module.nodeType&&module,moduleExports$2=freeModule$2&&freeModule$2.exports===freeExports$2,Buffer$1=moduleExports$2?root.Buffer:void 0,nativeIsBuffer=Buffer$1?Buffer$1.isBuffer:void 0,isBuffer=nativeIsBuffer||stubFalse,argsTag$1="[object Arguments]",arrayTag$1="[object Array]",boolTag$2="[object Boolean]",dateTag$2="[object Date]",errorTag$1="[object Error]",funcTag$1="[object Function]",mapTag$4="[object Map]",numberTag$2="[object Number]",objectTag$2="[object Object]",regexpTag$2="[object RegExp]",setTag$4="[object Set]",stringTag$2="[object String]",weakMapTag$2="[object WeakMap]",arrayBufferTag$2="[object ArrayBuffer]",dataViewTag$3="[object DataView]",float32Tag$2="[object Float32Array]",float64Tag$2="[object Float64Array]",int8Tag$2="[object Int8Array]",int16Tag$2="[object Int16Array]",int32Tag$2="[object Int32Array]",uint8Tag$2="[object Uint8Array]",uint8ClampedTag$2="[object Uint8ClampedArray]",uint16Tag$2="[object Uint16Array]",uint32Tag$2="[object Uint32Array]",typedArrayTags={};typedArrayTags[float32Tag$2]=typedArrayTags[float64Tag$2]=typedArrayTags[int8Tag$2]=typedArrayTags[int16Tag$2]=typedArrayTags[int32Tag$2]=typedArrayTags[uint8Tag$2]=typedArrayTags[uint8ClampedTag$2]=typedArrayTags[uint16Tag$2]=typedArrayTags[uint32Tag$2]=!0,typedArrayTags[argsTag$1]=typedArrayTags[arrayTag$1]=typedArrayTags[arrayBufferTag$2]=typedArrayTags[boolTag$2]=typedArrayTags[dataViewTag$3]=typedArrayTags[dateTag$2]=typedArrayTags[errorTag$1]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag$4]=typedArrayTags[numberTag$2]=typedArrayTags[objectTag$2]=typedArrayTags[regexpTag$2]=typedArrayTags[setTag$4]=typedArrayTags[stringTag$2]=typedArrayTags[weakMapTag$2]=!1;function baseIsTypedArray(e){return isObjectLike(e)&&isLength(e.length)&&!!typedArrayTags[baseGetTag(e)]}function baseUnary(e){return function(t){return e(t)}}var freeExports$1=typeof exports=="object"&&exports&&!exports.nodeType&&exports,freeModule$1=freeExports$1&&typeof module=="object"&&module&&!module.nodeType&&module,moduleExports$1=freeModule$1&&freeModule$1.exports===freeExports$1,freeProcess=moduleExports$1&&freeGlobal.process,nodeUtil=(function(){try{var e=freeModule$1&&freeModule$1.require&&freeModule$1.require("util").types;return e||freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch{}})(),nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray,objectProto$5=Object.prototype,hasOwnProperty$4=objectProto$5.hasOwnProperty;function arrayLikeKeys(e,t){var r=isArray(e),n=!r&&isArguments(e),s=!r&&!n&&isBuffer(e),o=!r&&!n&&!s&&isTypedArray(e),i=r||n||s||o,c=i?baseTimes(e.length,String):[],a=c.length;for(var u in e)hasOwnProperty$4.call(e,u)&&!(i&&(u=="length"||s&&(u=="offset"||u=="parent")||o&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||isIndex(u,a)))&&c.push(u);return c}function overArg(e,t){return function(r){return e(t(r))}}var nativeKeys=overArg(Object.keys,Object),objectProto$4=Object.prototype,hasOwnProperty$3=objectProto$4.hasOwnProperty;function baseKeys(e){if(!isPrototype(e))return nativeKeys(e);var t=[];for(var r in Object(e))hasOwnProperty$3.call(e,r)&&r!="constructor"&&t.push(r);return t}function keys(e){return isArrayLike(e)?arrayLikeKeys(e):baseKeys(e)}var nativeCreate=getNative(Object,"create");function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{},this.size=0}function hashDelete(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var HASH_UNDEFINED$1="__lodash_hash_undefined__",objectProto$3=Object.prototype,hasOwnProperty$2=objectProto$3.hasOwnProperty;function hashGet(e){var t=this.__data__;if(nativeCreate){var r=t[e];return r===HASH_UNDEFINED$1?void 0:r}return hasOwnProperty$2.call(t,e)?t[e]:void 0}var objectProto$2=Object.prototype,hasOwnProperty$1=objectProto$2.hasOwnProperty;function hashHas(e){var t=this.__data__;return nativeCreate?t[e]!==void 0:hasOwnProperty$1.call(t,e)}var HASH_UNDEFINED="__lodash_hash_undefined__";function hashSet(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=nativeCreate&&t===void 0?HASH_UNDEFINED:t,this}function Hash(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet;function listCacheClear(){this.__data__=[],this.size=0}function assocIndexOf(e,t){for(var r=e.length;r--;)if(eq(e[r][0],t))return r;return-1}var arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete(e){var t=this.__data__,r=assocIndexOf(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():splice.call(t,r,1),--this.size,!0}function listCacheGet(e){var t=this.__data__,r=assocIndexOf(t,e);return r<0?void 0:t[r][1]}function listCacheHas(e){return assocIndexOf(this.__data__,e)>-1}function listCacheSet(e,t){var r=this.__data__,n=assocIndexOf(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}function ListCache(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet;var Map$1=getNative(root,"Map");function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(Map$1||ListCache),string:new Hash}}function isKeyable(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function getMapData(e,t){var r=e.__data__;return isKeyable(t)?r[typeof t=="string"?"string":"hash"]:r.map}function mapCacheDelete(e){var t=getMapData(this,e).delete(e);return this.size-=t?1:0,t}function mapCacheGet(e){return getMapData(this,e).get(e)}function mapCacheHas(e){return getMapData(this,e).has(e)}function mapCacheSet(e,t){var r=getMapData(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}function MapCache(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet;function arrayPush(e,t){for(var r=-1,n=t.length,s=e.length;++r<n;)e[s+r]=t[r];return e}var getPrototype=overArg(Object.getPrototypeOf,Object);function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}function stackGet(e){return this.__data__.get(e)}function stackHas(e){return this.__data__.has(e)}var LARGE_ARRAY_SIZE=200;function stackSet(e,t){var r=this.__data__;if(r instanceof ListCache){var n=r.__data__;if(!Map$1||n.length<LARGE_ARRAY_SIZE-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new MapCache(n)}return r.set(e,t),this.size=r.size,this}function Stack(e){var t=this.__data__=new ListCache(e);this.size=t.size}Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet;var freeExports=typeof exports=="object"&&exports&&!exports.nodeType&&exports,freeModule=freeExports&&typeof module=="object"&&module&&!module.nodeType&&module,moduleExports=freeModule&&freeModule.exports===freeExports,Buffer=moduleExports?root.Buffer:void 0;Buffer&&Buffer.allocUnsafe;function cloneBuffer(e,t){return e.slice()}function arrayFilter(e,t){for(var r=-1,n=e==null?0:e.length,s=0,o=[];++r<n;){var i=e[r];t(i,r,e)&&(o[s++]=i)}return o}function stubArray(){return[]}var objectProto$1=Object.prototype,propertyIsEnumerable=objectProto$1.propertyIsEnumerable,nativeGetSymbols=Object.getOwnPropertySymbols,getSymbols=nativeGetSymbols?function(e){return e==null?[]:(e=Object(e),arrayFilter(nativeGetSymbols(e),function(t){return propertyIsEnumerable.call(e,t)}))}:stubArray;function baseGetAllKeys(e,t,r){var n=t(e);return isArray(e)?n:arrayPush(n,r(e))}function getAllKeys(e){return baseGetAllKeys(e,keys,getSymbols)}var DataView=getNative(root,"DataView"),Promise$1=getNative(root,"Promise"),Set$1=getNative(root,"Set"),mapTag$3="[object Map]",objectTag$1="[object Object]",promiseTag="[object Promise]",setTag$3="[object Set]",weakMapTag$1="[object WeakMap]",dataViewTag$2="[object DataView]",dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map$1),promiseCtorString=toSource(Promise$1),setCtorString=toSource(Set$1),weakMapCtorString=toSource(WeakMap$1),getTag=baseGetTag;(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag$2||Map$1&&getTag(new Map$1)!=mapTag$3||Promise$1&&getTag(Promise$1.resolve())!=promiseTag||Set$1&&getTag(new Set$1)!=setTag$3||WeakMap$1&&getTag(new WeakMap$1)!=weakMapTag$1)&&(getTag=function(e){var t=baseGetTag(e),r=t==objectTag$1?e.constructor:void 0,n=r?toSource(r):"";if(n)switch(n){case dataViewCtorString:return dataViewTag$2;case mapCtorString:return mapTag$3;case promiseCtorString:return promiseTag;case setCtorString:return setTag$3;case weakMapCtorString:return weakMapTag$1}return t});var objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;function initCloneArray(e){var t=e.length,r=new e.constructor(t);return t&&typeof e[0]=="string"&&hasOwnProperty.call(e,"index")&&(r.index=e.index,r.input=e.input),r}var Uint8Array$1=root.Uint8Array;function cloneArrayBuffer(e){var t=new e.constructor(e.byteLength);return new Uint8Array$1(t).set(new Uint8Array$1(e)),t}function cloneDataView(e,t){var r=cloneArrayBuffer(e.buffer);return new e.constructor(r,e.byteOffset,e.byteLength)}var reFlags=/\w*$/;function cloneRegExp(e){var t=new e.constructor(e.source,reFlags.exec(e));return t.lastIndex=e.lastIndex,t}var symbolProto=Symbol$1?Symbol$1.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;function cloneSymbol(e){return symbolValueOf?Object(symbolValueOf.call(e)):{}}function cloneTypedArray(e,t){var r=cloneArrayBuffer(e.buffer);return new e.constructor(r,e.byteOffset,e.length)}var boolTag$1="[object Boolean]",dateTag$1="[object Date]",mapTag$2="[object Map]",numberTag$1="[object Number]",regexpTag$1="[object RegExp]",setTag$2="[object Set]",stringTag$1="[object String]",symbolTag$1="[object Symbol]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$1="[object DataView]",float32Tag$1="[object Float32Array]",float64Tag$1="[object Float64Array]",int8Tag$1="[object Int8Array]",int16Tag$1="[object Int16Array]",int32Tag$1="[object Int32Array]",uint8Tag$1="[object Uint8Array]",uint8ClampedTag$1="[object Uint8ClampedArray]",uint16Tag$1="[object Uint16Array]",uint32Tag$1="[object Uint32Array]";function initCloneByTag(e,t,r){var n=e.constructor;switch(t){case arrayBufferTag$1:return cloneArrayBuffer(e);case boolTag$1:case dateTag$1:return new n(+e);case dataViewTag$1:return cloneDataView(e);case float32Tag$1:case float64Tag$1:case int8Tag$1:case int16Tag$1:case int32Tag$1:case uint8Tag$1:case uint8ClampedTag$1:case uint16Tag$1:case uint32Tag$1:return cloneTypedArray(e);case mapTag$2:return new n;case numberTag$1:case stringTag$1:return new n(e);case regexpTag$1:return cloneRegExp(e);case setTag$2:return new n;case symbolTag$1:return cloneSymbol(e)}}function initCloneObject(e){return typeof e.constructor=="function"&&!isPrototype(e)?baseCreate(getPrototype(e)):{}}var mapTag$1="[object Map]";function baseIsMap(e){return isObjectLike(e)&&getTag(e)==mapTag$1}var nodeIsMap=nodeUtil&&nodeUtil.isMap,isMap=nodeIsMap?baseUnary(nodeIsMap):baseIsMap,setTag$1="[object Set]";function baseIsSet(e){return isObjectLike(e)&&getTag(e)==setTag$1}var nodeIsSet=nodeUtil&&nodeUtil.isSet,isSet=nodeIsSet?baseUnary(nodeIsSet):baseIsSet,argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=!0,cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=!1;function baseClone(e,t,r,n,s,o){var i;if(i!==void 0)return i;if(!isObject$1(e))return e;var c=isArray(e);if(c)i=initCloneArray(e);else{var a=getTag(e),u=a==funcTag||a==genTag;if(isBuffer(e))return cloneBuffer(e);if(a==objectTag||a==argsTag||u&&!s)i=u?{}:initCloneObject(e);else{if(!cloneableTags[a])return s?e:{};i=initCloneByTag(e,a)}}o||(o=new Stack);var l=o.get(e);if(l)return l;o.set(e,i),isSet(e)?e.forEach(function(p){i.add(baseClone(p,t,r,p,e,o))}):isMap(e)&&e.forEach(function(p,m){i.set(m,baseClone(p,t,r,m,e,o))});var h=getAllKeys,f=c?void 0:h(e);return arrayEach(f||e,function(p,m){f&&(m=p,p=e[m]),assignValue(i,m,baseClone(p,t,r,m,e,o))}),i}var CLONE_DEEP_FLAG=1,CLONE_SYMBOLS_FLAG=4;function cloneDeep(e){return baseClone(e,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG)}class SimulationEngine{model;state;params;snapshots=[];onSnapshot;snapshotInterval;constructor(t){this.model=t.model,this.params=t.params,this.onSnapshot=t.onSnapshot,this.snapshotInterval=t.snapshotInterval??1,this.init()}init(){this.state=this.model.init(this.params),this.snapshots=[],this.recordSnapshot()}step(){let t=1;const r=this.params;r.general&&typeof r.general.dt=="number"&&(t=r.general.dt),this.state=this.model.step(this.state,t,this.params);const n=this.state;(typeof n.step_count=="number"?n.step_count:this.snapshots.length)%this.snapshotInterval===0&&this.recordSnapshot()}isComplete(){const t=this.params,r=this.state;return t.general&&typeof t.general.t_end=="number"&&typeof r.t=="number"?r.t>=t.general.t_end:!1}getState(){return this.state}getParams(){return this.params}resetWithParams(t){this.params=t,this.init()}recordSnapshot(){const t=this.model.getSnapshot(this.state);this.snapshots.push(t),this.onSnapshot&&this.onSnapshot(t)}getStats(){return this.model.computeStats(this.state,this.params)}}function parseVersion(e){const t=e.split(".").map(Number);return{major:t[0]||0,minor:t[1]||0,patch:t[2]||0}}function compareVersions(e,t){return e.major!==t.major?e.major-t.major:e.minor!==t.minor?e.minor-t.minor:e.patch-t.patch}function isCompatible(e,t){return e.major===t.major&&compareVersions(e,t)>=0}function formatVersion(e){return`${e.major}.${e.minor}.${e.patch}`}class ModelRegistry{models=new Map;defaultModelName=null;constructor(){console.log("[Registry] Initializing")}register(t){const r=parseVersion(t.version),n=formatVersion(r),s=t;if(!this.models.has(t.id))this.models.set(t.id,{latestModel:s,versions:new Map([[n,s]])}),console.log(`[Registry] Registered new model: ${t.id} (v${n})`);else{const o=this.models.get(t.id);o.versions.set(n,s);const i=parseVersion(o.latestModel.version);(r.major>i.major||r.major===i.major&&r.minor>i.minor||r.major===i.major&&r.minor===i.minor&&r.patch>i.patch)&&(o.latestModel=s,console.log(`[Registry] Updated model ${t.id} to version ${n}`))}}setDefault(t){if(!this.models.has(t))throw new Error(`Cannot set default: model "${t}" is not registered`);this.defaultModelName=t}get(t){return this.models.get(t)?.latestModel}getVersion(t,r){return this.models.get(t)?.versions.get(r)}getModelNames(){return Array.from(this.models.keys())}getVersions(t){const r=this.models.get(t);return r?Array.from(r.versions.keys()):[]}getDefault(){return this.defaultModelName?this.get(this.defaultModelName):void 0}getDefaultName(){return this.defaultModelName}findCompatibleModel(t){const r=this.models.get(t.model);if(!r)return;const n=parseVersion(t.version);let s,o;for(const[i,c]of r.versions){const a=parseVersion(i);isCompatible(a,n)&&(!o||a.minor>o.minor||a.minor===o.minor&&a.patch>o.patch)&&(s=c,o=a)}return s}has(t){return this.models.has(t)}getAll(){return Array.from(this.models.values()).map(t=>t.latestModel)}}const modelRegistry=new ModelRegistry,DEFAULT_CONTROL_CELL={N_init:25,location:"",R_hard:.4,R_hard_div:.7,R_soft:1.2,color:{r:30,g:100,b:20},dur_G2:.5,dur_mitosis:.5,k_apical_junction:5,k_cytos:5,max_cytoskeleton_length:.5,run:0,running_speed:1,running_mode:0,stiffness_apical_apical:2,stiffness_apical_apical_div:4,stiffness_nuclei_apical:3,stiffness_nuclei_basal:2,stiffness_repulsion:2,stiffness_straightness:5,lifespan_start:5.5,lifespan_end:6.5,INM:0,hetero:!1,events:{time_A_start:1/0,time_A_end:1/0,time_B_start:1/0,time_B_end:1/0,time_S_start:1/0,time_S_end:1/0,time_P_start:1/0,time_P_end:1/0}},DEFAULT_EMT_CELL={N_init:5,location:"bottom",R_hard:.4,R_hard_div:.7,R_soft:1.2,color:{r:128,g:0,b:128},dur_G2:.5,dur_mitosis:.5,k_apical_junction:1,k_cytos:5,max_cytoskeleton_length:.5,run:0,running_speed:1,running_mode:0,stiffness_apical_apical:2,stiffness_apical_apical_div:4,stiffness_nuclei_apical:3,stiffness_nuclei_basal:2,stiffness_repulsion:4,stiffness_straightness:2,lifespan_start:5.5,lifespan_end:6.5,INM:0,hetero:!0,events:{time_A_start:3,time_A_end:12,time_B_start:3,time_B_end:12,time_S_start:1/0,time_S_end:1/0,time_P_start:1/0,time_P_end:1/0}},DEFAULT_EHT_PARAMS={metadata:{model:"EHT",version:"1.0.0"},general:{t_end:48,dt:.1,random_seed:0,full_circle:!0,w_init:80,h_init:5,mu:.2,n_substeps:30,alg_dt:.01,w_screen:70,h_screen:70,p_div_out:1,perimeter:105,aspect_ratio:1},cell_prop:{apical_junction_init:0,max_basal_junction_dist:4,basal_daming_ratio:1,basal_membrane_repulsion:0,cytos_init:0,diffusion:.2},cell_types:{control:DEFAULT_CONTROL_CELL,emt:DEFAULT_EMT_CELL}};function $constructor(e,t,r){function n(c,a){if(c._zod||Object.defineProperty(c,"_zod",{value:{def:a,constr:i,traits:new Set},enumerable:!1}),c._zod.traits.has(e))return;c._zod.traits.add(e),t(c,a);const u=i.prototype,l=Object.keys(u);for(let h=0;h<l.length;h++){const f=l[h];f in c||(c[f]=u[f].bind(c))}}const s=r?.Parent??Object;class o extends s{}Object.defineProperty(o,"name",{value:e});function i(c){var a;const u=r?.Parent?new o:this;n(u,c),(a=u._zod).deferred??(a.deferred=[]);for(const l of u._zod.deferred)l();return u}return Object.defineProperty(i,"init",{value:n}),Object.defineProperty(i,Symbol.hasInstance,{value:c=>r?.Parent&&c instanceof r.Parent?!0:c?._zod?.traits?.has(e)}),Object.defineProperty(i,"name",{value:e}),i}class $ZodAsyncError extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class $ZodEncodeError extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const globalConfig={};function config(e){return globalConfig}function getEnumValues(e){const t=Object.values(e).filter(n=>typeof n=="number");return Object.entries(e).filter(([n,s])=>t.indexOf(+n)===-1).map(([n,s])=>s)}function jsonStringifyReplacer(e,t){return typeof t=="bigint"?t.toString():t}function cached(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function nullish(e){return e==null}function cleanRegex(e){const t=e.startsWith("^")?1:0,r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}function floatSafeRemainder(e,t){const r=(e.toString().split(".")[1]||"").length,n=t.toString();let s=(n.split(".")[1]||"").length;if(s===0&&/\d?e-\d?/.test(n)){const a=n.match(/\d?e-(\d?)/);a?.[1]&&(s=Number.parseInt(a[1]))}const o=r>s?r:s,i=Number.parseInt(e.toFixed(o).replace(".","")),c=Number.parseInt(t.toFixed(o).replace(".",""));return i%c/10**o}const EVALUATING=Symbol("evaluating");function defineLazy(e,t,r){let n;Object.defineProperty(e,t,{get(){if(n!==EVALUATING)return n===void 0&&(n=EVALUATING,n=r()),n},set(s){Object.defineProperty(e,t,{value:s})},configurable:!0})}function assignProp(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function mergeDefs(...e){const t={};for(const r of e){const n=Object.getOwnPropertyDescriptors(r);Object.assign(t,n)}return Object.defineProperties({},t)}function esc(e){return JSON.stringify(e)}function slugify(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}const captureStackTrace="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function isObject(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const allowsEval=cached(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function isPlainObject(e){if(isObject(e)===!1)return!1;const t=e.constructor;if(t===void 0||typeof t!="function")return!0;const r=t.prototype;return!(isObject(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function shallowClone(e){return isPlainObject(e)?{...e}:Array.isArray(e)?[...e]:e}const propertyKeyTypes=new Set(["string","number","symbol"]);function escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function clone(e,t,r){const n=new e._zod.constr(t??e._zod.def);return(!t||r?.parent)&&(n._zod.parent=e),n}function normalizeParams(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function optionalKeys(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const NUMBER_FORMAT_RANGES={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function pick(e,t){const r=e._zod.def,n=r.checks;if(n&&n.length>0)throw new Error(".pick() cannot be used on object schemas containing refinements");const o=mergeDefs(e._zod.def,{get shape(){const i={};for(const c in t){if(!(c in r.shape))throw new Error(`Unrecognized key: "${c}"`);t[c]&&(i[c]=r.shape[c])}return assignProp(this,"shape",i),i},checks:[]});return clone(e,o)}function omit(e,t){const r=e._zod.def,n=r.checks;if(n&&n.length>0)throw new Error(".omit() cannot be used on object schemas containing refinements");const o=mergeDefs(e._zod.def,{get shape(){const i={...e._zod.def.shape};for(const c in t){if(!(c in r.shape))throw new Error(`Unrecognized key: "${c}"`);t[c]&&delete i[c]}return assignProp(this,"shape",i),i},checks:[]});return clone(e,o)}function extend(e,t){if(!isPlainObject(t))throw new Error("Invalid input to extend: expected a plain object");const r=e._zod.def.checks;if(r&&r.length>0){const o=e._zod.def.shape;for(const i in t)if(Object.getOwnPropertyDescriptor(o,i)!==void 0)throw new Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}const s=mergeDefs(e._zod.def,{get shape(){const o={...e._zod.def.shape,...t};return assignProp(this,"shape",o),o}});return clone(e,s)}function safeExtend(e,t){if(!isPlainObject(t))throw new Error("Invalid input to safeExtend: expected a plain object");const r=mergeDefs(e._zod.def,{get shape(){const n={...e._zod.def.shape,...t};return assignProp(this,"shape",n),n}});return clone(e,r)}function merge(e,t){const r=mergeDefs(e._zod.def,{get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return assignProp(this,"shape",n),n},get catchall(){return t._zod.def.catchall},checks:[]});return clone(e,r)}function partial(e,t,r){const s=t._zod.def.checks;if(s&&s.length>0)throw new Error(".partial() cannot be used on object schemas containing refinements");const i=mergeDefs(t._zod.def,{get shape(){const c=t._zod.def.shape,a={...c};if(r)for(const u in r){if(!(u in c))throw new Error(`Unrecognized key: "${u}"`);r[u]&&(a[u]=e?new e({type:"optional",innerType:c[u]}):c[u])}else for(const u in c)a[u]=e?new e({type:"optional",innerType:c[u]}):c[u];return assignProp(this,"shape",a),a},checks:[]});return clone(t,i)}function required(e,t,r){const n=mergeDefs(t._zod.def,{get shape(){const s=t._zod.def.shape,o={...s};if(r)for(const i in r){if(!(i in o))throw new Error(`Unrecognized key: "${i}"`);r[i]&&(o[i]=new e({type:"nonoptional",innerType:s[i]}))}else for(const i in s)o[i]=new e({type:"nonoptional",innerType:s[i]});return assignProp(this,"shape",o),o}});return clone(t,n)}function aborted(e,t=0){if(e.aborted===!0)return!0;for(let r=t;r<e.issues.length;r++)if(e.issues[r]?.continue!==!0)return!0;return!1}function prefixIssues(e,t){return t.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(e),r})}function unwrapMessage(e){return typeof e=="string"?e:e?.message}function finalizeIssue(e,t,r){const n={...e,path:e.path??[]};if(!e.message){const s=unwrapMessage(e.inst?._zod.def?.error?.(e))??unwrapMessage(t?.error?.(e))??unwrapMessage(r.customError?.(e))??unwrapMessage(r.localeError?.(e))??"Invalid input";n.message=s}return delete n.inst,delete n.continue,t?.reportInput||delete n.input,n}function getLengthableOrigin(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function issue(...e){const[t,r,n]=e;return typeof t=="string"?{message:t,code:"custom",input:r,inst:n}:{...t}}const initializer$1=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,jsonStringifyReplacer,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},$ZodError=$constructor("$ZodError",initializer$1),$ZodRealError=$constructor("$ZodError",initializer$1,{Parent:Error});function flattenError(e,t=r=>r.message){const r={},n=[];for(const s of e.issues)s.path.length>0?(r[s.path[0]]=r[s.path[0]]||[],r[s.path[0]].push(t(s))):n.push(t(s));return{formErrors:n,fieldErrors:r}}function formatError(e,t=r=>r.message){const r={_errors:[]},n=s=>{for(const o of s.issues)if(o.code==="invalid_union"&&o.errors.length)o.errors.map(i=>n({issues:i}));else if(o.code==="invalid_key")n({issues:o.issues});else if(o.code==="invalid_element")n({issues:o.issues});else if(o.path.length===0)r._errors.push(t(o));else{let i=r,c=0;for(;c<o.path.length;){const a=o.path[c];c===o.path.length-1?(i[a]=i[a]||{_errors:[]},i[a]._errors.push(t(o))):i[a]=i[a]||{_errors:[]},i=i[a],c++}}};return n(e),r}const _parse=e=>(t,r,n,s)=>{const o=n?Object.assign(n,{async:!1}):{async:!1},i=t._zod.run({value:r,issues:[]},o);if(i instanceof Promise)throw new $ZodAsyncError;if(i.issues.length){const c=new(s?.Err??e)(i.issues.map(a=>finalizeIssue(a,o,config())));throw captureStackTrace(c,s?.callee),c}return i.value},_parseAsync=e=>async(t,r,n,s)=>{const o=n?Object.assign(n,{async:!0}):{async:!0};let i=t._zod.run({value:r,issues:[]},o);if(i instanceof Promise&&(i=await i),i.issues.length){const c=new(s?.Err??e)(i.issues.map(a=>finalizeIssue(a,o,config())));throw captureStackTrace(c,s?.callee),c}return i.value},_safeParse=e=>(t,r,n)=>{const s=n?{...n,async:!1}:{async:!1},o=t._zod.run({value:r,issues:[]},s);if(o instanceof Promise)throw new $ZodAsyncError;return o.issues.length?{success:!1,error:new(e??$ZodError)(o.issues.map(i=>finalizeIssue(i,s,config())))}:{success:!0,data:o.value}},safeParse$1=_safeParse($ZodRealError),_safeParseAsync=e=>async(t,r,n)=>{const s=n?Object.assign(n,{async:!0}):{async:!0};let o=t._zod.run({value:r,issues:[]},s);return o instanceof Promise&&(o=await o),o.issues.length?{success:!1,error:new e(o.issues.map(i=>finalizeIssue(i,s,config())))}:{success:!0,data:o.value}},safeParseAsync$1=_safeParseAsync($ZodRealError),_encode=e=>(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return _parse(e)(t,r,s)},_decode=e=>(t,r,n)=>_parse(e)(t,r,n),_encodeAsync=e=>async(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return _parseAsync(e)(t,r,s)},_decodeAsync=e=>async(t,r,n)=>_parseAsync(e)(t,r,n),_safeEncode=e=>(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return _safeParse(e)(t,r,s)},_safeDecode=e=>(t,r,n)=>_safeParse(e)(t,r,n),_safeEncodeAsync=e=>async(t,r,n)=>{const s=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return _safeParseAsync(e)(t,r,s)},_safeDecodeAsync=e=>async(t,r,n)=>_safeParseAsync(e)(t,r,n),cuid=/^[cC][^\s-]{8,}$/,cuid2=/^[0-9a-z]+$/,ulid=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,xid=/^[0-9a-vA-V]{20}$/,ksuid=/^[A-Za-z0-9]{27}$/,nanoid=/^[a-zA-Z0-9_-]{21}$/,duration$1=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,guid=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,uuid=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,email=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,_emoji$1="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function emoji(){return new RegExp(_emoji$1,"u")}const ipv4=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv6=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,cidrv4=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,cidrv6=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,base64url=/^[A-Za-z0-9_-]*$/,e164=/^\+[1-9]\d{6,14}$/,dateSource="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",date$1=new RegExp(`^${dateSource}$`);function timeSource(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function time$1(e){return new RegExp(`^${timeSource(e)}$`)}function datetime$1(e){const t=timeSource({precision:e.precision}),r=["Z"];e.local&&r.push(""),e.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const n=`${t}(?:${r.join("|")})`;return new RegExp(`^${dateSource}T(?:${n})$`)}const string$1=e=>{const t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},integer=/^-?\d+$/,number$1=/^-?\d+(?:\.\d+)?$/,boolean$1=/^(?:true|false)$/i,lowercase=/^[^A-Z]*$/,uppercase=/^[^a-z]*$/,$ZodCheck=$constructor("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),numericOriginMap={number:"number",bigint:"bigint",object:"date"},$ZodCheckLessThan=$constructor("$ZodCheckLessThan",(e,t)=>{$ZodCheck.init(e,t);const r=numericOriginMap[typeof t.value];e._zod.onattach.push(n=>{const s=n._zod.bag,o=(t.inclusive?s.maximum:s.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<o&&(t.inclusive?s.maximum=t.value:s.exclusiveMaximum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value<=t.value:n.value<t.value)||n.issues.push({origin:r,code:"too_big",maximum:typeof t.value=="object"?t.value.getTime():t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),$ZodCheckGreaterThan=$constructor("$ZodCheckGreaterThan",(e,t)=>{$ZodCheck.init(e,t);const r=numericOriginMap[typeof t.value];e._zod.onattach.push(n=>{const s=n._zod.bag,o=(t.inclusive?s.minimum:s.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>o&&(t.inclusive?s.minimum=t.value:s.exclusiveMinimum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value>=t.value:n.value>t.value)||n.issues.push({origin:r,code:"too_small",minimum:typeof t.value=="object"?t.value.getTime():t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),$ZodCheckMultipleOf=$constructor("$ZodCheckMultipleOf",(e,t)=>{$ZodCheck.init(e,t),e._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=t.value)}),e._zod.check=r=>{if(typeof r.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%t.value===BigInt(0):floatSafeRemainder(r.value,t.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:t.value,input:r.value,inst:e,continue:!t.abort})}}),$ZodCheckNumberFormat=$constructor("$ZodCheckNumberFormat",(e,t)=>{$ZodCheck.init(e,t),t.format=t.format||"float64";const r=t.format?.includes("int"),n=r?"int":"number",[s,o]=NUMBER_FORMAT_RANGES[t.format];e._zod.onattach.push(i=>{const c=i._zod.bag;c.format=t.format,c.minimum=s,c.maximum=o,r&&(c.pattern=integer)}),e._zod.check=i=>{const c=i.value;if(r){if(!Number.isInteger(c)){i.issues.push({expected:n,format:t.format,code:"invalid_type",continue:!1,input:c,inst:e});return}if(!Number.isSafeInteger(c)){c>0?i.issues.push({input:c,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,inclusive:!0,continue:!t.abort}):i.issues.push({input:c,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,inclusive:!0,continue:!t.abort});return}}c<s&&i.issues.push({origin:"number",input:c,code:"too_small",minimum:s,inclusive:!0,inst:e,continue:!t.abort}),c>o&&i.issues.push({origin:"number",input:c,code:"too_big",maximum:o,inclusive:!0,inst:e,continue:!t.abort})}}),$ZodCheckMaxLength=$constructor("$ZodCheckMaxLength",(e,t)=>{var r;$ZodCheck.init(e,t),(r=e._zod.def).when??(r.when=n=>{const s=n.value;return!nullish(s)&&s.length!==void 0}),e._zod.onattach.push(n=>{const s=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<s&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const s=n.value;if(s.length<=t.maximum)return;const i=getLengthableOrigin(s);n.issues.push({origin:i,code:"too_big",maximum:t.maximum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),$ZodCheckMinLength=$constructor("$ZodCheckMinLength",(e,t)=>{var r;$ZodCheck.init(e,t),(r=e._zod.def).when??(r.when=n=>{const s=n.value;return!nullish(s)&&s.length!==void 0}),e._zod.onattach.push(n=>{const s=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>s&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const s=n.value;if(s.length>=t.minimum)return;const i=getLengthableOrigin(s);n.issues.push({origin:i,code:"too_small",minimum:t.minimum,inclusive:!0,input:s,inst:e,continue:!t.abort})}}),$ZodCheckLengthEquals=$constructor("$ZodCheckLengthEquals",(e,t)=>{var r;$ZodCheck.init(e,t),(r=e._zod.def).when??(r.when=n=>{const s=n.value;return!nullish(s)&&s.length!==void 0}),e._zod.onattach.push(n=>{const s=n._zod.bag;s.minimum=t.length,s.maximum=t.length,s.length=t.length}),e._zod.check=n=>{const s=n.value,o=s.length;if(o===t.length)return;const i=getLengthableOrigin(s),c=o>t.length;n.issues.push({origin:i,...c?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:n.value,inst:e,continue:!t.abort})}}),$ZodCheckStringFormat=$constructor("$ZodCheckStringFormat",(e,t)=>{var r,n;$ZodCheck.init(e,t),e._zod.onattach.push(s=>{const o=s._zod.bag;o.format=t.format,t.pattern&&(o.patterns??(o.patterns=new Set),o.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=s=>{t.pattern.lastIndex=0,!t.pattern.test(s.value)&&s.issues.push({origin:"string",code:"invalid_format",format:t.format,input:s.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(n=e._zod).check??(n.check=()=>{})}),$ZodCheckRegex=$constructor("$ZodCheckRegex",(e,t)=>{$ZodCheckStringFormat.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),$ZodCheckLowerCase=$constructor("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=lowercase),$ZodCheckStringFormat.init(e,t)}),$ZodCheckUpperCase=$constructor("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=uppercase),$ZodCheckStringFormat.init(e,t)}),$ZodCheckIncludes=$constructor("$ZodCheckIncludes",(e,t)=>{$ZodCheck.init(e,t);const r=escapeRegex(t.includes),n=new RegExp(typeof t.position=="number"?`^.{${t.position}}${r}`:r);t.pattern=n,e._zod.onattach.push(s=>{const o=s._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=s=>{s.value.includes(t.includes,t.position)||s.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:s.value,inst:e,continue:!t.abort})}}),$ZodCheckStartsWith=$constructor("$ZodCheckStartsWith",(e,t)=>{$ZodCheck.init(e,t);const r=new RegExp(`^${escapeRegex(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const s=n._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),e._zod.check=n=>{n.value.startsWith(t.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:n.value,inst:e,continue:!t.abort})}}),$ZodCheckEndsWith=$constructor("$ZodCheckEndsWith",(e,t)=>{$ZodCheck.init(e,t);const r=new RegExp(`.*${escapeRegex(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const s=n._zod.bag;s.patterns??(s.patterns=new Set),s.patterns.add(r)}),e._zod.check=n=>{n.value.endsWith(t.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:n.value,inst:e,continue:!t.abort})}}),$ZodCheckOverwrite=$constructor("$ZodCheckOverwrite",(e,t)=>{$ZodCheck.init(e,t),e._zod.check=r=>{r.value=t.tx(r.value)}});class Doc{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const n=t.split(`
`).filter(i=>i),s=Math.min(...n.map(i=>i.length-i.trimStart().length)),o=n.map(i=>i.slice(s)).map(i=>" ".repeat(this.indent*2)+i);for(const i of o)this.content.push(i)}compile(){const t=Function,r=this?.args,s=[...(this?.content??[""]).map(o=>`  ${o}`)];return new t(...r,s.join(`
`))}}const version={major:4,minor:3,patch:5},$ZodType=$constructor("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=version;const n=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&n.unshift(e);for(const s of n)for(const o of s._zod.onattach)o(e);if(n.length===0)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const s=(i,c,a)=>{let u=aborted(i),l;for(const h of c){if(h._zod.def.when){if(!h._zod.def.when(i))continue}else if(u)continue;const f=i.issues.length,p=h._zod.check(i);if(p instanceof Promise&&a?.async===!1)throw new $ZodAsyncError;if(l||p instanceof Promise)l=(l??Promise.resolve()).then(async()=>{await p,i.issues.length!==f&&(u||(u=aborted(i,f)))});else{if(i.issues.length===f)continue;u||(u=aborted(i,f))}}return l?l.then(()=>i):i},o=(i,c,a)=>{if(aborted(i))return i.aborted=!0,i;const u=s(c,n,a);if(u instanceof Promise){if(a.async===!1)throw new $ZodAsyncError;return u.then(l=>e._zod.parse(l,a))}return e._zod.parse(u,a)};e._zod.run=(i,c)=>{if(c.skipChecks)return e._zod.parse(i,c);if(c.direction==="backward"){const u=e._zod.parse({value:i.value,issues:[]},{...c,skipChecks:!0});return u instanceof Promise?u.then(l=>o(l,i,c)):o(u,i,c)}const a=e._zod.parse(i,c);if(a instanceof Promise){if(c.async===!1)throw new $ZodAsyncError;return a.then(u=>s(u,n,c))}return s(a,n,c)}}defineLazy(e,"~standard",()=>({validate:s=>{try{const o=safeParse$1(e,s);return o.success?{value:o.data}:{issues:o.error?.issues}}catch{return safeParseAsync$1(e,s).then(i=>i.success?{value:i.data}:{issues:i.error?.issues})}},vendor:"zod",version:1}))}),$ZodString=$constructor("$ZodString",(e,t)=>{$ZodType.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??string$1(e._zod.bag),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),$ZodStringFormat=$constructor("$ZodStringFormat",(e,t)=>{$ZodCheckStringFormat.init(e,t),$ZodString.init(e,t)}),$ZodGUID=$constructor("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=guid),$ZodStringFormat.init(e,t)}),$ZodUUID=$constructor("$ZodUUID",(e,t)=>{if(t.version){const n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(n===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=uuid(n))}else t.pattern??(t.pattern=uuid());$ZodStringFormat.init(e,t)}),$ZodEmail=$constructor("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=email),$ZodStringFormat.init(e,t)}),$ZodURL=$constructor("$ZodURL",(e,t)=>{$ZodStringFormat.init(e,t),e._zod.check=r=>{try{const n=r.value.trim(),s=new URL(n);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(s.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(s.protocol.endsWith(":")?s.protocol.slice(0,-1):s.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort})),t.normalize?r.value=s.href:r.value=n;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),$ZodEmoji=$constructor("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=emoji()),$ZodStringFormat.init(e,t)}),$ZodNanoID=$constructor("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=nanoid),$ZodStringFormat.init(e,t)}),$ZodCUID=$constructor("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=cuid),$ZodStringFormat.init(e,t)}),$ZodCUID2=$constructor("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=cuid2),$ZodStringFormat.init(e,t)}),$ZodULID=$constructor("$ZodULID",(e,t)=>{t.pattern??(t.pattern=ulid),$ZodStringFormat.init(e,t)}),$ZodXID=$constructor("$ZodXID",(e,t)=>{t.pattern??(t.pattern=xid),$ZodStringFormat.init(e,t)}),$ZodKSUID=$constructor("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=ksuid),$ZodStringFormat.init(e,t)}),$ZodISODateTime=$constructor("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=datetime$1(t)),$ZodStringFormat.init(e,t)}),$ZodISODate=$constructor("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=date$1),$ZodStringFormat.init(e,t)}),$ZodISOTime=$constructor("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=time$1(t)),$ZodStringFormat.init(e,t)}),$ZodISODuration=$constructor("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=duration$1),$ZodStringFormat.init(e,t)}),$ZodIPv4=$constructor("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=ipv4),$ZodStringFormat.init(e,t),e._zod.bag.format="ipv4"}),$ZodIPv6=$constructor("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=ipv6),$ZodStringFormat.init(e,t),e._zod.bag.format="ipv6",e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),$ZodCIDRv4=$constructor("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=cidrv4),$ZodStringFormat.init(e,t)}),$ZodCIDRv6=$constructor("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=cidrv6),$ZodStringFormat.init(e,t),e._zod.check=r=>{const n=r.value.split("/");try{if(n.length!==2)throw new Error;const[s,o]=n;if(!o)throw new Error;const i=Number(o);if(`${i}`!==o)throw new Error;if(i<0||i>128)throw new Error;new URL(`http://[${s}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function isValidBase64(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const $ZodBase64=$constructor("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=base64),$ZodStringFormat.init(e,t),e._zod.bag.contentEncoding="base64",e._zod.check=r=>{isValidBase64(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}});function isValidBase64URL(e){if(!base64url.test(e))return!1;const t=e.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=t.padEnd(Math.ceil(t.length/4)*4,"=");return isValidBase64(r)}const $ZodBase64URL=$constructor("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=base64url),$ZodStringFormat.init(e,t),e._zod.bag.contentEncoding="base64url",e._zod.check=r=>{isValidBase64URL(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),$ZodE164=$constructor("$ZodE164",(e,t)=>{t.pattern??(t.pattern=e164),$ZodStringFormat.init(e,t)});function isValidJWT(e,t=null){try{const r=e.split(".");if(r.length!==3)return!1;const[n]=r;if(!n)return!1;const s=JSON.parse(atob(n));return!("typ"in s&&s?.typ!=="JWT"||!s.alg||t&&(!("alg"in s)||s.alg!==t))}catch{return!1}}const $ZodJWT=$constructor("$ZodJWT",(e,t)=>{$ZodStringFormat.init(e,t),e._zod.check=r=>{isValidJWT(r.value,t.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),$ZodNumber=$constructor("$ZodNumber",(e,t)=>{$ZodType.init(e,t),e._zod.pattern=e._zod.bag.pattern??number$1,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=Number(r.value)}catch{}const s=r.value;if(typeof s=="number"&&!Number.isNaN(s)&&Number.isFinite(s))return r;const o=typeof s=="number"?Number.isNaN(s)?"NaN":Number.isFinite(s)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:s,inst:e,...o?{received:o}:{}}),r}}),$ZodNumberFormat=$constructor("$ZodNumberFormat",(e,t)=>{$ZodCheckNumberFormat.init(e,t),$ZodNumber.init(e,t)}),$ZodBoolean=$constructor("$ZodBoolean",(e,t)=>{$ZodType.init(e,t),e._zod.pattern=boolean$1,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=!!r.value}catch{}const s=r.value;return typeof s=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:s,inst:e}),r}}),$ZodUnknown=$constructor("$ZodUnknown",(e,t)=>{$ZodType.init(e,t),e._zod.parse=r=>r}),$ZodNever=$constructor("$ZodNever",(e,t)=>{$ZodType.init(e,t),e._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:e}),r)});function handleArrayResult(e,t,r){e.issues.length&&t.issues.push(...prefixIssues(r,e.issues)),t.value[r]=e.value}const $ZodArray=$constructor("$ZodArray",(e,t)=>{$ZodType.init(e,t),e._zod.parse=(r,n)=>{const s=r.value;if(!Array.isArray(s))return r.issues.push({expected:"array",code:"invalid_type",input:s,inst:e}),r;r.value=Array(s.length);const o=[];for(let i=0;i<s.length;i++){const c=s[i],a=t.element._zod.run({value:c,issues:[]},n);a instanceof Promise?o.push(a.then(u=>handleArrayResult(u,r,i))):handleArrayResult(a,r,i)}return o.length?Promise.all(o).then(()=>r):r}});function handlePropertyResult(e,t,r,n,s){if(e.issues.length){if(s&&!(r in n))return;t.issues.push(...prefixIssues(r,e.issues))}e.value===void 0?r in n&&(t.value[r]=void 0):t.value[r]=e.value}function normalizeDef(e){const t=Object.keys(e.shape);for(const n of t)if(!e.shape?.[n]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${n}": expected a Zod schema`);const r=optionalKeys(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(r)}}function handleCatchall(e,t,r,n,s,o){const i=[],c=s.keySet,a=s.catchall._zod,u=a.def.type,l=a.optout==="optional";for(const h in t){if(c.has(h))continue;if(u==="never"){i.push(h);continue}const f=a.run({value:t[h],issues:[]},n);f instanceof Promise?e.push(f.then(p=>handlePropertyResult(p,r,h,t,l))):handlePropertyResult(f,r,h,t,l)}return i.length&&r.issues.push({code:"unrecognized_keys",keys:i,input:t,inst:o}),e.length?Promise.all(e).then(()=>r):r}const $ZodObject=$constructor("$ZodObject",(e,t)=>{if($ZodType.init(e,t),!Object.getOwnPropertyDescriptor(t,"shape")?.get){const c=t.shape;Object.defineProperty(t,"shape",{get:()=>{const a={...c};return Object.defineProperty(t,"shape",{value:a}),a}})}const n=cached(()=>normalizeDef(t));defineLazy(e._zod,"propValues",()=>{const c=t.shape,a={};for(const u in c){const l=c[u]._zod;if(l.values){a[u]??(a[u]=new Set);for(const h of l.values)a[u].add(h)}}return a});const s=isObject,o=t.catchall;let i;e._zod.parse=(c,a)=>{i??(i=n.value);const u=c.value;if(!s(u))return c.issues.push({expected:"object",code:"invalid_type",input:u,inst:e}),c;c.value={};const l=[],h=i.shape;for(const f of i.keys){const p=h[f],m=p._zod.optout==="optional",_=p._zod.run({value:u[f],issues:[]},a);_ instanceof Promise?l.push(_.then(w=>handlePropertyResult(w,c,f,u,m))):handlePropertyResult(_,c,f,u,m)}return o?handleCatchall(l,u,c,a,n.value,e):l.length?Promise.all(l).then(()=>c):c}}),$ZodObjectJIT=$constructor("$ZodObjectJIT",(e,t)=>{$ZodObject.init(e,t);const r=e._zod.parse,n=cached(()=>normalizeDef(t)),s=f=>{const p=new Doc(["shape","payload","ctx"]),m=n.value,_=$=>{const T=esc($);return`shape[${T}]._zod.run({ value: input[${T}], issues: [] }, ctx)`};p.write("const input = payload.value;");const w=Object.create(null);let g=0;for(const $ of m.keys)w[$]=`key_${g++}`;p.write("const newResult = {};");for(const $ of m.keys){const T=w[$],v=esc($),x=f[$]?._zod?.optout==="optional";p.write(`const ${T} = ${_($)};`),x?p.write(`
        if (${T}.issues.length) {
          if (${v} in input) {
            payload.issues = payload.issues.concat(${T}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${v}, ...iss.path] : [${v}]
            })));
          }
        }
        
        if (${T}.value === undefined) {
          if (${v} in input) {
            newResult[${v}] = undefined;
          }
        } else {
          newResult[${v}] = ${T}.value;
        }
        
      `):p.write(`
        if (${T}.issues.length) {
          payload.issues = payload.issues.concat(${T}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${v}, ...iss.path] : [${v}]
          })));
        }
        
        if (${T}.value === undefined) {
          if (${v} in input) {
            newResult[${v}] = undefined;
          }
        } else {
          newResult[${v}] = ${T}.value;
        }
        
      `)}p.write("payload.value = newResult;"),p.write("return payload;");const b=p.compile();return($,T)=>b(f,$,T)};let o;const i=isObject,c=!globalConfig.jitless,u=c&&allowsEval.value,l=t.catchall;let h;e._zod.parse=(f,p)=>{h??(h=n.value);const m=f.value;return i(m)?c&&u&&p?.async===!1&&p.jitless!==!0?(o||(o=s(t.shape)),f=o(f,p),l?handleCatchall([],m,f,p,h,e):f):r(f,p):(f.issues.push({expected:"object",code:"invalid_type",input:m,inst:e}),f)}});function handleUnionResults(e,t,r,n){for(const o of e)if(o.issues.length===0)return t.value=o.value,t;const s=e.filter(o=>!aborted(o));return s.length===1?(t.value=s[0].value,s[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(o=>o.issues.map(i=>finalizeIssue(i,n,config())))}),t)}const $ZodUnion=$constructor("$ZodUnion",(e,t)=>{$ZodType.init(e,t),defineLazy(e._zod,"optin",()=>t.options.some(s=>s._zod.optin==="optional")?"optional":void 0),defineLazy(e._zod,"optout",()=>t.options.some(s=>s._zod.optout==="optional")?"optional":void 0),defineLazy(e._zod,"values",()=>{if(t.options.every(s=>s._zod.values))return new Set(t.options.flatMap(s=>Array.from(s._zod.values)))}),defineLazy(e._zod,"pattern",()=>{if(t.options.every(s=>s._zod.pattern)){const s=t.options.map(o=>o._zod.pattern);return new RegExp(`^(${s.map(o=>cleanRegex(o.source)).join("|")})$`)}});const r=t.options.length===1,n=t.options[0]._zod.run;e._zod.parse=(s,o)=>{if(r)return n(s,o);let i=!1;const c=[];for(const a of t.options){const u=a._zod.run({value:s.value,issues:[]},o);if(u instanceof Promise)c.push(u),i=!0;else{if(u.issues.length===0)return u;c.push(u)}}return i?Promise.all(c).then(a=>handleUnionResults(a,s,e,o)):handleUnionResults(c,s,e,o)}}),$ZodIntersection=$constructor("$ZodIntersection",(e,t)=>{$ZodType.init(e,t),e._zod.parse=(r,n)=>{const s=r.value,o=t.left._zod.run({value:s,issues:[]},n),i=t.right._zod.run({value:s,issues:[]},n);return o instanceof Promise||i instanceof Promise?Promise.all([o,i]).then(([a,u])=>handleIntersectionResults(r,a,u)):handleIntersectionResults(r,o,i)}});function mergeValues(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(isPlainObject(e)&&isPlainObject(t)){const r=Object.keys(t),n=Object.keys(e).filter(o=>r.indexOf(o)!==-1),s={...e,...t};for(const o of n){const i=mergeValues(e[o],t[o]);if(!i.valid)return{valid:!1,mergeErrorPath:[o,...i.mergeErrorPath]};s[o]=i.data}return{valid:!0,data:s}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const r=[];for(let n=0;n<e.length;n++){const s=e[n],o=t[n],i=mergeValues(s,o);if(!i.valid)return{valid:!1,mergeErrorPath:[n,...i.mergeErrorPath]};r.push(i.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function handleIntersectionResults(e,t,r){const n=new Map;let s;for(const c of t.issues)if(c.code==="unrecognized_keys"){s??(s=c);for(const a of c.keys)n.has(a)||n.set(a,{}),n.get(a).l=!0}else e.issues.push(c);for(const c of r.issues)if(c.code==="unrecognized_keys")for(const a of c.keys)n.has(a)||n.set(a,{}),n.get(a).r=!0;else e.issues.push(c);const o=[...n].filter(([,c])=>c.l&&c.r).map(([c])=>c);if(o.length&&s&&e.issues.push({...s,keys:o}),aborted(e))return e;const i=mergeValues(t.value,r.value);if(!i.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(i.mergeErrorPath)}`);return e.value=i.data,e}const $ZodTuple=$constructor("$ZodTuple",(e,t)=>{$ZodType.init(e,t);const r=t.items;e._zod.parse=(n,s)=>{const o=n.value;if(!Array.isArray(o))return n.issues.push({input:o,inst:e,expected:"tuple",code:"invalid_type"}),n;n.value=[];const i=[],c=[...r].reverse().findIndex(l=>l._zod.optin!=="optional"),a=c===-1?0:r.length-c;if(!t.rest){const l=o.length>r.length,h=o.length<a-1;if(l||h)return n.issues.push({...l?{code:"too_big",maximum:r.length,inclusive:!0}:{code:"too_small",minimum:r.length},input:o,inst:e,origin:"array"}),n}let u=-1;for(const l of r){if(u++,u>=o.length&&u>=a)continue;const h=l._zod.run({value:o[u],issues:[]},s);h instanceof Promise?i.push(h.then(f=>handleTupleResult(f,n,u))):handleTupleResult(h,n,u)}if(t.rest){const l=o.slice(r.length);for(const h of l){u++;const f=t.rest._zod.run({value:h,issues:[]},s);f instanceof Promise?i.push(f.then(p=>handleTupleResult(p,n,u))):handleTupleResult(f,n,u)}}return i.length?Promise.all(i).then(()=>n):n}});function handleTupleResult(e,t,r){e.issues.length&&t.issues.push(...prefixIssues(r,e.issues)),t.value[r]=e.value}const $ZodRecord=$constructor("$ZodRecord",(e,t)=>{$ZodType.init(e,t),e._zod.parse=(r,n)=>{const s=r.value;if(!isPlainObject(s))return r.issues.push({expected:"record",code:"invalid_type",input:s,inst:e}),r;const o=[],i=t.keyType._zod.values;if(i){r.value={};const c=new Set;for(const u of i)if(typeof u=="string"||typeof u=="number"||typeof u=="symbol"){c.add(typeof u=="number"?u.toString():u);const l=t.valueType._zod.run({value:s[u],issues:[]},n);l instanceof Promise?o.push(l.then(h=>{h.issues.length&&r.issues.push(...prefixIssues(u,h.issues)),r.value[u]=h.value})):(l.issues.length&&r.issues.push(...prefixIssues(u,l.issues)),r.value[u]=l.value)}let a;for(const u in s)c.has(u)||(a=a??[],a.push(u));a&&a.length>0&&r.issues.push({code:"unrecognized_keys",input:s,inst:e,keys:a})}else{r.value={};for(const c of Reflect.ownKeys(s)){if(c==="__proto__")continue;let a=t.keyType._zod.run({value:c,issues:[]},n);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(typeof c=="string"&&number$1.test(c)&&a.issues.length&&a.issues.some(h=>h.code==="invalid_type"&&h.expected==="number")){const h=t.keyType._zod.run({value:Number(c),issues:[]},n);if(h instanceof Promise)throw new Error("Async schemas not supported in object keys currently");h.issues.length===0&&(a=h)}if(a.issues.length){t.mode==="loose"?r.value[c]=s[c]:r.issues.push({code:"invalid_key",origin:"record",issues:a.issues.map(h=>finalizeIssue(h,n,config())),input:c,path:[c],inst:e});continue}const l=t.valueType._zod.run({value:s[c],issues:[]},n);l instanceof Promise?o.push(l.then(h=>{h.issues.length&&r.issues.push(...prefixIssues(c,h.issues)),r.value[a.value]=h.value})):(l.issues.length&&r.issues.push(...prefixIssues(c,l.issues)),r.value[a.value]=l.value)}}return o.length?Promise.all(o).then(()=>r):r}}),$ZodEnum=$constructor("$ZodEnum",(e,t)=>{$ZodType.init(e,t);const r=getEnumValues(t.entries),n=new Set(r);e._zod.values=n,e._zod.pattern=new RegExp(`^(${r.filter(s=>propertyKeyTypes.has(typeof s)).map(s=>typeof s=="string"?escapeRegex(s):s.toString()).join("|")})$`),e._zod.parse=(s,o)=>{const i=s.value;return n.has(i)||s.issues.push({code:"invalid_value",values:r,input:i,inst:e}),s}}),$ZodLiteral=$constructor("$ZodLiteral",(e,t)=>{if($ZodType.init(e,t),t.values.length===0)throw new Error("Cannot create literal schema with no valid values");const r=new Set(t.values);e._zod.values=r,e._zod.pattern=new RegExp(`^(${t.values.map(n=>typeof n=="string"?escapeRegex(n):n?escapeRegex(n.toString()):String(n)).join("|")})$`),e._zod.parse=(n,s)=>{const o=n.value;return r.has(o)||n.issues.push({code:"invalid_value",values:t.values,input:o,inst:e}),n}}),$ZodTransform=$constructor("$ZodTransform",(e,t)=>{$ZodType.init(e,t),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new $ZodEncodeError(e.constructor.name);const s=t.transform(r.value,r);if(n.async)return(s instanceof Promise?s:Promise.resolve(s)).then(i=>(r.value=i,r));if(s instanceof Promise)throw new $ZodAsyncError;return r.value=s,r}});function handleOptionalResult(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const $ZodOptional=$constructor("$ZodOptional",(e,t)=>{$ZodType.init(e,t),e._zod.optin="optional",e._zod.optout="optional",defineLazy(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),defineLazy(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${cleanRegex(r.source)})?$`):void 0}),e._zod.parse=(r,n)=>{if(t.innerType._zod.optin==="optional"){const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(o=>handleOptionalResult(o,r.value)):handleOptionalResult(s,r.value)}return r.value===void 0?r:t.innerType._zod.run(r,n)}}),$ZodExactOptional=$constructor("$ZodExactOptional",(e,t)=>{$ZodOptional.init(e,t),defineLazy(e._zod,"values",()=>t.innerType._zod.values),defineLazy(e._zod,"pattern",()=>t.innerType._zod.pattern),e._zod.parse=(r,n)=>t.innerType._zod.run(r,n)}),$ZodNullable=$constructor("$ZodNullable",(e,t)=>{$ZodType.init(e,t),defineLazy(e._zod,"optin",()=>t.innerType._zod.optin),defineLazy(e._zod,"optout",()=>t.innerType._zod.optout),defineLazy(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${cleanRegex(r.source)}|null)$`):void 0}),defineLazy(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(r,n)=>r.value===null?r:t.innerType._zod.run(r,n)}),$ZodDefault=$constructor("$ZodDefault",(e,t)=>{$ZodType.init(e,t),e._zod.optin="optional",defineLazy(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);if(r.value===void 0)return r.value=t.defaultValue,r;const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(o=>handleDefaultResult(o,t)):handleDefaultResult(s,t)}});function handleDefaultResult(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const $ZodPrefault=$constructor("$ZodPrefault",(e,t)=>{$ZodType.init(e,t),e._zod.optin="optional",defineLazy(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>(n.direction==="backward"||r.value===void 0&&(r.value=t.defaultValue),t.innerType._zod.run(r,n))}),$ZodNonOptional=$constructor("$ZodNonOptional",(e,t)=>{$ZodType.init(e,t),defineLazy(e._zod,"values",()=>{const r=t.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),e._zod.parse=(r,n)=>{const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(o=>handleNonOptionalResult(o,e)):handleNonOptionalResult(s,e)}});function handleNonOptionalResult(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const $ZodCatch=$constructor("$ZodCatch",(e,t)=>{$ZodType.init(e,t),defineLazy(e._zod,"optin",()=>t.innerType._zod.optin),defineLazy(e._zod,"optout",()=>t.innerType._zod.optout),defineLazy(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(o=>(r.value=o.value,o.issues.length&&(r.value=t.catchValue({...r,error:{issues:o.issues.map(i=>finalizeIssue(i,n,config()))},input:r.value}),r.issues=[]),r)):(r.value=s.value,s.issues.length&&(r.value=t.catchValue({...r,error:{issues:s.issues.map(o=>finalizeIssue(o,n,config()))},input:r.value}),r.issues=[]),r)}}),$ZodPipe=$constructor("$ZodPipe",(e,t)=>{$ZodType.init(e,t),defineLazy(e._zod,"values",()=>t.in._zod.values),defineLazy(e._zod,"optin",()=>t.in._zod.optin),defineLazy(e._zod,"optout",()=>t.out._zod.optout),defineLazy(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(r,n)=>{if(n.direction==="backward"){const o=t.out._zod.run(r,n);return o instanceof Promise?o.then(i=>handlePipeResult(i,t.in,n)):handlePipeResult(o,t.in,n)}const s=t.in._zod.run(r,n);return s instanceof Promise?s.then(o=>handlePipeResult(o,t.out,n)):handlePipeResult(s,t.out,n)}});function handlePipeResult(e,t,r){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},r)}const $ZodReadonly=$constructor("$ZodReadonly",(e,t)=>{$ZodType.init(e,t),defineLazy(e._zod,"propValues",()=>t.innerType._zod.propValues),defineLazy(e._zod,"values",()=>t.innerType._zod.values),defineLazy(e._zod,"optin",()=>t.innerType?._zod?.optin),defineLazy(e._zod,"optout",()=>t.innerType?._zod?.optout),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const s=t.innerType._zod.run(r,n);return s instanceof Promise?s.then(handleReadonlyResult):handleReadonlyResult(s)}});function handleReadonlyResult(e){return e.value=Object.freeze(e.value),e}const $ZodCustom=$constructor("$ZodCustom",(e,t)=>{$ZodCheck.init(e,t),$ZodType.init(e,t),e._zod.parse=(r,n)=>r,e._zod.check=r=>{const n=r.value,s=t.fn(n);if(s instanceof Promise)return s.then(o=>handleRefineResult(o,r,n,e));handleRefineResult(s,r,n,e)}});function handleRefineResult(e,t,r,n){if(!e){const s={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(s.params=n._zod.def.params),t.issues.push(issue(s))}}var _a;class $ZodRegistry{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...r){const n=r[0];return this._map.set(t,n),n&&typeof n=="object"&&"id"in n&&this._idmap.set(n.id,t),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const r=this._map.get(t);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(t),this}get(t){const r=t._zod.parent;if(r){const n={...this.get(r)??{}};delete n.id;const s={...n,...this._map.get(t)};return Object.keys(s).length?s:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function registry(){return new $ZodRegistry}(_a=globalThis).__zod_globalRegistry??(_a.__zod_globalRegistry=registry());const globalRegistry=globalThis.__zod_globalRegistry;function _string(e,t){return new e({type:"string",...normalizeParams(t)})}function _email(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...normalizeParams(t)})}function _guid(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...normalizeParams(t)})}function _uuid(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...normalizeParams(t)})}function _uuidv4(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...normalizeParams(t)})}function _uuidv6(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...normalizeParams(t)})}function _uuidv7(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...normalizeParams(t)})}function _url(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...normalizeParams(t)})}function _emoji(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...normalizeParams(t)})}function _nanoid(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...normalizeParams(t)})}function _cuid(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...normalizeParams(t)})}function _cuid2(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...normalizeParams(t)})}function _ulid(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...normalizeParams(t)})}function _xid(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...normalizeParams(t)})}function _ksuid(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...normalizeParams(t)})}function _ipv4(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...normalizeParams(t)})}function _ipv6(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...normalizeParams(t)})}function _cidrv4(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...normalizeParams(t)})}function _cidrv6(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...normalizeParams(t)})}function _base64(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...normalizeParams(t)})}function _base64url(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...normalizeParams(t)})}function _e164(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...normalizeParams(t)})}function _jwt(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...normalizeParams(t)})}function _isoDateTime(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...normalizeParams(t)})}function _isoDate(e,t){return new e({type:"string",format:"date",check:"string_format",...normalizeParams(t)})}function _isoTime(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...normalizeParams(t)})}function _isoDuration(e,t){return new e({type:"string",format:"duration",check:"string_format",...normalizeParams(t)})}function _number(e,t){return new e({type:"number",checks:[],...normalizeParams(t)})}function _int(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...normalizeParams(t)})}function _boolean(e,t){return new e({type:"boolean",...normalizeParams(t)})}function _unknown(e){return new e({type:"unknown"})}function _never(e,t){return new e({type:"never",...normalizeParams(t)})}function _lt(e,t){return new $ZodCheckLessThan({check:"less_than",...normalizeParams(t),value:e,inclusive:!1})}function _lte(e,t){return new $ZodCheckLessThan({check:"less_than",...normalizeParams(t),value:e,inclusive:!0})}function _gt(e,t){return new $ZodCheckGreaterThan({check:"greater_than",...normalizeParams(t),value:e,inclusive:!1})}function _gte(e,t){return new $ZodCheckGreaterThan({check:"greater_than",...normalizeParams(t),value:e,inclusive:!0})}function _multipleOf(e,t){return new $ZodCheckMultipleOf({check:"multiple_of",...normalizeParams(t),value:e})}function _maxLength(e,t){return new $ZodCheckMaxLength({check:"max_length",...normalizeParams(t),maximum:e})}function _minLength(e,t){return new $ZodCheckMinLength({check:"min_length",...normalizeParams(t),minimum:e})}function _length(e,t){return new $ZodCheckLengthEquals({check:"length_equals",...normalizeParams(t),length:e})}function _regex(e,t){return new $ZodCheckRegex({check:"string_format",format:"regex",...normalizeParams(t),pattern:e})}function _lowercase(e){return new $ZodCheckLowerCase({check:"string_format",format:"lowercase",...normalizeParams(e)})}function _uppercase(e){return new $ZodCheckUpperCase({check:"string_format",format:"uppercase",...normalizeParams(e)})}function _includes(e,t){return new $ZodCheckIncludes({check:"string_format",format:"includes",...normalizeParams(t),includes:e})}function _startsWith(e,t){return new $ZodCheckStartsWith({check:"string_format",format:"starts_with",...normalizeParams(t),prefix:e})}function _endsWith(e,t){return new $ZodCheckEndsWith({check:"string_format",format:"ends_with",...normalizeParams(t),suffix:e})}function _overwrite(e){return new $ZodCheckOverwrite({check:"overwrite",tx:e})}function _normalize(e){return _overwrite(t=>t.normalize(e))}function _trim(){return _overwrite(e=>e.trim())}function _toLowerCase(){return _overwrite(e=>e.toLowerCase())}function _toUpperCase(){return _overwrite(e=>e.toUpperCase())}function _slugify(){return _overwrite(e=>slugify(e))}function _array(e,t,r){return new e({type:"array",element:t,...normalizeParams(r)})}function _refine(e,t,r){return new e({type:"custom",check:"custom",fn:t,...normalizeParams(r)})}function _superRefine(e){const t=_check(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(issue(n,r.value,t._zod.def));else{const s=n;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=t),s.continue??(s.continue=!t._zod.def.abort),r.issues.push(issue(s))}},e(r.value,r)));return t}function _check(e,t){const r=new $ZodCheck({check:"custom",...normalizeParams(t)});return r._zod.check=e,r}function initializeContext(e){let t=e?.target??"draft-2020-12";return t==="draft-4"&&(t="draft-04"),t==="draft-7"&&(t="draft-07"),{processors:e.processors??{},metadataRegistry:e?.metadata??globalRegistry,target:t,unrepresentable:e?.unrepresentable??"throw",override:e?.override??(()=>{}),io:e?.io??"output",counter:0,seen:new Map,cycles:e?.cycles??"ref",reused:e?.reused??"inline",external:e?.external??void 0}}function process(e,t,r={path:[],schemaPath:[]}){var n;const s=e._zod.def,o=t.seen.get(e);if(o)return o.count++,r.schemaPath.includes(e)&&(o.cycle=r.path),o.schema;const i={schema:{},count:1,cycle:void 0,path:r.path};t.seen.set(e,i);const c=e._zod.toJSONSchema?.();if(c)i.schema=c;else{const l={...r,schemaPath:[...r.schemaPath,e],path:r.path};if(e._zod.processJSONSchema)e._zod.processJSONSchema(t,i.schema,l);else{const f=i.schema,p=t.processors[s.type];if(!p)throw new Error(`[toJSONSchema]: Non-representable type encountered: ${s.type}`);p(e,t,f,l)}const h=e._zod.parent;h&&(i.ref||(i.ref=h),process(h,t,l),t.seen.get(h).isParent=!0)}const a=t.metadataRegistry.get(e);return a&&Object.assign(i.schema,a),t.io==="input"&&isTransforming(e)&&(delete i.schema.examples,delete i.schema.default),t.io==="input"&&i.schema._prefault&&((n=i.schema).default??(n.default=i.schema._prefault)),delete i.schema._prefault,t.seen.get(e).schema}function extractDefs(e,t){const r=e.seen.get(t);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");const n=new Map;for(const i of e.seen.entries()){const c=e.metadataRegistry.get(i[0])?.id;if(c){const a=n.get(c);if(a&&a!==i[0])throw new Error(`Duplicate schema id "${c}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);n.set(c,i[0])}}const s=i=>{const c=e.target==="draft-2020-12"?"$defs":"definitions";if(e.external){const h=e.external.registry.get(i[0])?.id,f=e.external.uri??(m=>m);if(h)return{ref:f(h)};const p=i[1].defId??i[1].schema.id??`schema${e.counter++}`;return i[1].defId=p,{defId:p,ref:`${f("__shared")}#/${c}/${p}`}}if(i[1]===r)return{ref:"#"};const u=`#/${c}/`,l=i[1].schema.id??`__schema${e.counter++}`;return{defId:l,ref:u+l}},o=i=>{if(i[1].schema.$ref)return;const c=i[1],{ref:a,defId:u}=s(i);c.def={...c.schema},u&&(c.defId=u);const l=c.schema;for(const h in l)delete l[h];l.$ref=a};if(e.cycles==="throw")for(const i of e.seen.entries()){const c=i[1];if(c.cycle)throw new Error(`Cycle detected: #/${c.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const i of e.seen.entries()){const c=i[1];if(t===i[0]){o(i);continue}if(e.external){const u=e.external.registry.get(i[0])?.id;if(t!==i[0]&&u){o(i);continue}}if(e.metadataRegistry.get(i[0])?.id){o(i);continue}if(c.cycle){o(i);continue}if(c.count>1&&e.reused==="ref"){o(i);continue}}}function finalize(e,t){const r=e.seen.get(t);if(!r)throw new Error("Unprocessed schema. This is a bug in Zod.");const n=i=>{const c=e.seen.get(i);if(c.ref===null)return;const a=c.def??c.schema,u={...a},l=c.ref;if(c.ref=null,l){n(l);const f=e.seen.get(l),p=f.schema;if(p.$ref&&(e.target==="draft-07"||e.target==="draft-04"||e.target==="openapi-3.0")?(a.allOf=a.allOf??[],a.allOf.push(p)):Object.assign(a,p),Object.assign(a,u),i._zod.parent===l)for(const _ in a)_==="$ref"||_==="allOf"||_ in u||delete a[_];if(p.$ref)for(const _ in a)_==="$ref"||_==="allOf"||_ in f.def&&JSON.stringify(a[_])===JSON.stringify(f.def[_])&&delete a[_]}const h=i._zod.parent;if(h&&h!==l){n(h);const f=e.seen.get(h);if(f?.schema.$ref&&(a.$ref=f.schema.$ref,f.def))for(const p in a)p==="$ref"||p==="allOf"||p in f.def&&JSON.stringify(a[p])===JSON.stringify(f.def[p])&&delete a[p]}e.override({zodSchema:i,jsonSchema:a,path:c.path??[]})};for(const i of[...e.seen.entries()].reverse())n(i[0]);const s={};if(e.target==="draft-2020-12"?s.$schema="https://json-schema.org/draft/2020-12/schema":e.target==="draft-07"?s.$schema="http://json-schema.org/draft-07/schema#":e.target==="draft-04"?s.$schema="http://json-schema.org/draft-04/schema#":e.target,e.external?.uri){const i=e.external.registry.get(t)?.id;if(!i)throw new Error("Schema is missing an `id` property");s.$id=e.external.uri(i)}Object.assign(s,r.def??r.schema);const o=e.external?.defs??{};for(const i of e.seen.entries()){const c=i[1];c.def&&c.defId&&(o[c.defId]=c.def)}e.external||Object.keys(o).length>0&&(e.target==="draft-2020-12"?s.$defs=o:s.definitions=o);try{const i=JSON.parse(JSON.stringify(s));return Object.defineProperty(i,"~standard",{value:{...t["~standard"],jsonSchema:{input:createStandardJSONSchemaMethod(t,"input",e.processors),output:createStandardJSONSchemaMethod(t,"output",e.processors)}},enumerable:!1,writable:!1}),i}catch{throw new Error("Error converting schema to JSON.")}}function isTransforming(e,t){const r=t??{seen:new Set};if(r.seen.has(e))return!1;r.seen.add(e);const n=e._zod.def;if(n.type==="transform")return!0;if(n.type==="array")return isTransforming(n.element,r);if(n.type==="set")return isTransforming(n.valueType,r);if(n.type==="lazy")return isTransforming(n.getter(),r);if(n.type==="promise"||n.type==="optional"||n.type==="nonoptional"||n.type==="nullable"||n.type==="readonly"||n.type==="default"||n.type==="prefault")return isTransforming(n.innerType,r);if(n.type==="intersection")return isTransforming(n.left,r)||isTransforming(n.right,r);if(n.type==="record"||n.type==="map")return isTransforming(n.keyType,r)||isTransforming(n.valueType,r);if(n.type==="pipe")return isTransforming(n.in,r)||isTransforming(n.out,r);if(n.type==="object"){for(const s in n.shape)if(isTransforming(n.shape[s],r))return!0;return!1}if(n.type==="union"){for(const s of n.options)if(isTransforming(s,r))return!0;return!1}if(n.type==="tuple"){for(const s of n.items)if(isTransforming(s,r))return!0;return!!(n.rest&&isTransforming(n.rest,r))}return!1}const createToJSONSchemaMethod=(e,t={})=>r=>{const n=initializeContext({...r,processors:t});return process(e,n),extractDefs(n,e),finalize(n,e)},createStandardJSONSchemaMethod=(e,t,r={})=>n=>{const{libraryOptions:s,target:o}=n??{},i=initializeContext({...s??{},target:o,io:t,processors:r});return process(e,i),extractDefs(i,e),finalize(i,e)},formatMap={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},stringProcessor=(e,t,r,n)=>{const s=r;s.type="string";const{minimum:o,maximum:i,format:c,patterns:a,contentEncoding:u}=e._zod.bag;if(typeof o=="number"&&(s.minLength=o),typeof i=="number"&&(s.maxLength=i),c&&(s.format=formatMap[c]??c,s.format===""&&delete s.format,c==="time"&&delete s.format),u&&(s.contentEncoding=u),a&&a.size>0){const l=[...a];l.length===1?s.pattern=l[0].source:l.length>1&&(s.allOf=[...l.map(h=>({...t.target==="draft-07"||t.target==="draft-04"||t.target==="openapi-3.0"?{type:"string"}:{},pattern:h.source}))])}},numberProcessor=(e,t,r,n)=>{const s=r,{minimum:o,maximum:i,format:c,multipleOf:a,exclusiveMaximum:u,exclusiveMinimum:l}=e._zod.bag;typeof c=="string"&&c.includes("int")?s.type="integer":s.type="number",typeof l=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(s.minimum=l,s.exclusiveMinimum=!0):s.exclusiveMinimum=l),typeof o=="number"&&(s.minimum=o,typeof l=="number"&&t.target!=="draft-04"&&(l>=o?delete s.minimum:delete s.exclusiveMinimum)),typeof u=="number"&&(t.target==="draft-04"||t.target==="openapi-3.0"?(s.maximum=u,s.exclusiveMaximum=!0):s.exclusiveMaximum=u),typeof i=="number"&&(s.maximum=i,typeof u=="number"&&t.target!=="draft-04"&&(u<=i?delete s.maximum:delete s.exclusiveMaximum)),typeof a=="number"&&(s.multipleOf=a)},booleanProcessor=(e,t,r,n)=>{r.type="boolean"},neverProcessor=(e,t,r,n)=>{r.not={}},unknownProcessor=(e,t,r,n)=>{},enumProcessor=(e,t,r,n)=>{const s=e._zod.def,o=getEnumValues(s.entries);o.every(i=>typeof i=="number")&&(r.type="number"),o.every(i=>typeof i=="string")&&(r.type="string"),r.enum=o},literalProcessor=(e,t,r,n)=>{const s=e._zod.def,o=[];for(const i of s.values)if(i===void 0){if(t.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof i=="bigint"){if(t.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");o.push(Number(i))}else o.push(i);if(o.length!==0)if(o.length===1){const i=o[0];r.type=i===null?"null":typeof i,t.target==="draft-04"||t.target==="openapi-3.0"?r.enum=[i]:r.const=i}else o.every(i=>typeof i=="number")&&(r.type="number"),o.every(i=>typeof i=="string")&&(r.type="string"),o.every(i=>typeof i=="boolean")&&(r.type="boolean"),o.every(i=>i===null)&&(r.type="null"),r.enum=o},customProcessor=(e,t,r,n)=>{if(t.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema")},transformProcessor=(e,t,r,n)=>{if(t.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema")},arrayProcessor=(e,t,r,n)=>{const s=r,o=e._zod.def,{minimum:i,maximum:c}=e._zod.bag;typeof i=="number"&&(s.minItems=i),typeof c=="number"&&(s.maxItems=c),s.type="array",s.items=process(o.element,t,{...n,path:[...n.path,"items"]})},objectProcessor=(e,t,r,n)=>{const s=r,o=e._zod.def;s.type="object",s.properties={};const i=o.shape;for(const u in i)s.properties[u]=process(i[u],t,{...n,path:[...n.path,"properties",u]});const c=new Set(Object.keys(i)),a=new Set([...c].filter(u=>{const l=o.shape[u]._zod;return t.io==="input"?l.optin===void 0:l.optout===void 0}));a.size>0&&(s.required=Array.from(a)),o.catchall?._zod.def.type==="never"?s.additionalProperties=!1:o.catchall?o.catchall&&(s.additionalProperties=process(o.catchall,t,{...n,path:[...n.path,"additionalProperties"]})):t.io==="output"&&(s.additionalProperties=!1)},unionProcessor=(e,t,r,n)=>{const s=e._zod.def,o=s.inclusive===!1,i=s.options.map((c,a)=>process(c,t,{...n,path:[...n.path,o?"oneOf":"anyOf",a]}));o?r.oneOf=i:r.anyOf=i},intersectionProcessor=(e,t,r,n)=>{const s=e._zod.def,o=process(s.left,t,{...n,path:[...n.path,"allOf",0]}),i=process(s.right,t,{...n,path:[...n.path,"allOf",1]}),c=u=>"allOf"in u&&Object.keys(u).length===1,a=[...c(o)?o.allOf:[o],...c(i)?i.allOf:[i]];r.allOf=a},tupleProcessor=(e,t,r,n)=>{const s=r,o=e._zod.def;s.type="array";const i=t.target==="draft-2020-12"?"prefixItems":"items",c=t.target==="draft-2020-12"||t.target==="openapi-3.0"?"items":"additionalItems",a=o.items.map((f,p)=>process(f,t,{...n,path:[...n.path,i,p]})),u=o.rest?process(o.rest,t,{...n,path:[...n.path,c,...t.target==="openapi-3.0"?[o.items.length]:[]]}):null;t.target==="draft-2020-12"?(s.prefixItems=a,u&&(s.items=u)):t.target==="openapi-3.0"?(s.items={anyOf:a},u&&s.items.anyOf.push(u),s.minItems=a.length,u||(s.maxItems=a.length)):(s.items=a,u&&(s.additionalItems=u));const{minimum:l,maximum:h}=e._zod.bag;typeof l=="number"&&(s.minItems=l),typeof h=="number"&&(s.maxItems=h)},recordProcessor=(e,t,r,n)=>{const s=r,o=e._zod.def;s.type="object";const i=o.keyType,a=i._zod.bag?.patterns;if(o.mode==="loose"&&a&&a.size>0){const l=process(o.valueType,t,{...n,path:[...n.path,"patternProperties","*"]});s.patternProperties={};for(const h of a)s.patternProperties[h.source]=l}else(t.target==="draft-07"||t.target==="draft-2020-12")&&(s.propertyNames=process(o.keyType,t,{...n,path:[...n.path,"propertyNames"]})),s.additionalProperties=process(o.valueType,t,{...n,path:[...n.path,"additionalProperties"]});const u=i._zod.values;if(u){const l=[...u].filter(h=>typeof h=="string"||typeof h=="number");l.length>0&&(s.required=l)}},nullableProcessor=(e,t,r,n)=>{const s=e._zod.def,o=process(s.innerType,t,n),i=t.seen.get(e);t.target==="openapi-3.0"?(i.ref=s.innerType,r.nullable=!0):r.anyOf=[o,{type:"null"}]},nonoptionalProcessor=(e,t,r,n)=>{const s=e._zod.def;process(s.innerType,t,n);const o=t.seen.get(e);o.ref=s.innerType},defaultProcessor=(e,t,r,n)=>{const s=e._zod.def;process(s.innerType,t,n);const o=t.seen.get(e);o.ref=s.innerType,r.default=JSON.parse(JSON.stringify(s.defaultValue))},prefaultProcessor=(e,t,r,n)=>{const s=e._zod.def;process(s.innerType,t,n);const o=t.seen.get(e);o.ref=s.innerType,t.io==="input"&&(r._prefault=JSON.parse(JSON.stringify(s.defaultValue)))},catchProcessor=(e,t,r,n)=>{const s=e._zod.def;process(s.innerType,t,n);const o=t.seen.get(e);o.ref=s.innerType;let i;try{i=s.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}r.default=i},pipeProcessor=(e,t,r,n)=>{const s=e._zod.def,o=t.io==="input"?s.in._zod.def.type==="transform"?s.out:s.in:s.out;process(o,t,n);const i=t.seen.get(e);i.ref=o},readonlyProcessor=(e,t,r,n)=>{const s=e._zod.def;process(s.innerType,t,n);const o=t.seen.get(e);o.ref=s.innerType,r.readOnly=!0},optionalProcessor=(e,t,r,n)=>{const s=e._zod.def;process(s.innerType,t,n);const o=t.seen.get(e);o.ref=s.innerType},ZodISODateTime=$constructor("ZodISODateTime",(e,t)=>{$ZodISODateTime.init(e,t),ZodStringFormat.init(e,t)});function datetime(e){return _isoDateTime(ZodISODateTime,e)}const ZodISODate=$constructor("ZodISODate",(e,t)=>{$ZodISODate.init(e,t),ZodStringFormat.init(e,t)});function date(e){return _isoDate(ZodISODate,e)}const ZodISOTime=$constructor("ZodISOTime",(e,t)=>{$ZodISOTime.init(e,t),ZodStringFormat.init(e,t)});function time(e){return _isoTime(ZodISOTime,e)}const ZodISODuration=$constructor("ZodISODuration",(e,t)=>{$ZodISODuration.init(e,t),ZodStringFormat.init(e,t)});function duration(e){return _isoDuration(ZodISODuration,e)}const initializer=(e,t)=>{$ZodError.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:r=>formatError(e,r)},flatten:{value:r=>flattenError(e,r)},addIssue:{value:r=>{e.issues.push(r),e.message=JSON.stringify(e.issues,jsonStringifyReplacer,2)}},addIssues:{value:r=>{e.issues.push(...r),e.message=JSON.stringify(e.issues,jsonStringifyReplacer,2)}},isEmpty:{get(){return e.issues.length===0}}})},ZodRealError=$constructor("ZodError",initializer,{Parent:Error}),parse$1=_parse(ZodRealError),parseAsync=_parseAsync(ZodRealError),safeParse=_safeParse(ZodRealError),safeParseAsync=_safeParseAsync(ZodRealError),encode=_encode(ZodRealError),decode=_decode(ZodRealError),encodeAsync=_encodeAsync(ZodRealError),decodeAsync=_decodeAsync(ZodRealError),safeEncode=_safeEncode(ZodRealError),safeDecode=_safeDecode(ZodRealError),safeEncodeAsync=_safeEncodeAsync(ZodRealError),safeDecodeAsync=_safeDecodeAsync(ZodRealError),ZodType=$constructor("ZodType",(e,t)=>($ZodType.init(e,t),Object.assign(e["~standard"],{jsonSchema:{input:createStandardJSONSchemaMethod(e,"input"),output:createStandardJSONSchemaMethod(e,"output")}}),e.toJSONSchema=createToJSONSchemaMethod(e,{}),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone(mergeDefs(t,{checks:[...t.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]}),{parent:!0}),e.with=e.check,e.clone=(r,n)=>clone(e,r,n),e.brand=()=>e,e.register=((r,n)=>(r.add(e,n),e)),e.parse=(r,n)=>parse$1(e,r,n,{callee:e.parse}),e.safeParse=(r,n)=>safeParse(e,r,n),e.parseAsync=async(r,n)=>parseAsync(e,r,n,{callee:e.parseAsync}),e.safeParseAsync=async(r,n)=>safeParseAsync(e,r,n),e.spa=e.safeParseAsync,e.encode=(r,n)=>encode(e,r,n),e.decode=(r,n)=>decode(e,r,n),e.encodeAsync=async(r,n)=>encodeAsync(e,r,n),e.decodeAsync=async(r,n)=>decodeAsync(e,r,n),e.safeEncode=(r,n)=>safeEncode(e,r,n),e.safeDecode=(r,n)=>safeDecode(e,r,n),e.safeEncodeAsync=async(r,n)=>safeEncodeAsync(e,r,n),e.safeDecodeAsync=async(r,n)=>safeDecodeAsync(e,r,n),e.refine=(r,n)=>e.check(refine(r,n)),e.superRefine=r=>e.check(superRefine(r)),e.overwrite=r=>e.check(_overwrite(r)),e.optional=()=>optional(e),e.exactOptional=()=>exactOptional(e),e.nullable=()=>nullable(e),e.nullish=()=>optional(nullable(e)),e.nonoptional=r=>nonoptional(e,r),e.array=()=>array(e),e.or=r=>union([e,r]),e.and=r=>intersection(e,r),e.transform=r=>pipe(e,transform(r)),e.default=r=>_default(e,r),e.prefault=r=>prefault(e,r),e.catch=r=>_catch(e,r),e.pipe=r=>pipe(e,r),e.readonly=()=>readonly(e),e.describe=r=>{const n=e.clone();return globalRegistry.add(n,{description:r}),n},Object.defineProperty(e,"description",{get(){return globalRegistry.get(e)?.description},configurable:!0}),e.meta=(...r)=>{if(r.length===0)return globalRegistry.get(e);const n=e.clone();return globalRegistry.add(n,r[0]),n},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e.apply=r=>r(e),e)),_ZodString=$constructor("_ZodString",(e,t)=>{$ZodString.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(n,s,o)=>stringProcessor(e,n,s);const r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...n)=>e.check(_regex(...n)),e.includes=(...n)=>e.check(_includes(...n)),e.startsWith=(...n)=>e.check(_startsWith(...n)),e.endsWith=(...n)=>e.check(_endsWith(...n)),e.min=(...n)=>e.check(_minLength(...n)),e.max=(...n)=>e.check(_maxLength(...n)),e.length=(...n)=>e.check(_length(...n)),e.nonempty=(...n)=>e.check(_minLength(1,...n)),e.lowercase=n=>e.check(_lowercase(n)),e.uppercase=n=>e.check(_uppercase(n)),e.trim=()=>e.check(_trim()),e.normalize=(...n)=>e.check(_normalize(...n)),e.toLowerCase=()=>e.check(_toLowerCase()),e.toUpperCase=()=>e.check(_toUpperCase()),e.slugify=()=>e.check(_slugify())}),ZodString=$constructor("ZodString",(e,t)=>{$ZodString.init(e,t),_ZodString.init(e,t),e.email=r=>e.check(_email(ZodEmail,r)),e.url=r=>e.check(_url(ZodURL,r)),e.jwt=r=>e.check(_jwt(ZodJWT,r)),e.emoji=r=>e.check(_emoji(ZodEmoji,r)),e.guid=r=>e.check(_guid(ZodGUID,r)),e.uuid=r=>e.check(_uuid(ZodUUID,r)),e.uuidv4=r=>e.check(_uuidv4(ZodUUID,r)),e.uuidv6=r=>e.check(_uuidv6(ZodUUID,r)),e.uuidv7=r=>e.check(_uuidv7(ZodUUID,r)),e.nanoid=r=>e.check(_nanoid(ZodNanoID,r)),e.guid=r=>e.check(_guid(ZodGUID,r)),e.cuid=r=>e.check(_cuid(ZodCUID,r)),e.cuid2=r=>e.check(_cuid2(ZodCUID2,r)),e.ulid=r=>e.check(_ulid(ZodULID,r)),e.base64=r=>e.check(_base64(ZodBase64,r)),e.base64url=r=>e.check(_base64url(ZodBase64URL,r)),e.xid=r=>e.check(_xid(ZodXID,r)),e.ksuid=r=>e.check(_ksuid(ZodKSUID,r)),e.ipv4=r=>e.check(_ipv4(ZodIPv4,r)),e.ipv6=r=>e.check(_ipv6(ZodIPv6,r)),e.cidrv4=r=>e.check(_cidrv4(ZodCIDRv4,r)),e.cidrv6=r=>e.check(_cidrv6(ZodCIDRv6,r)),e.e164=r=>e.check(_e164(ZodE164,r)),e.datetime=r=>e.check(datetime(r)),e.date=r=>e.check(date(r)),e.time=r=>e.check(time(r)),e.duration=r=>e.check(duration(r))});function string(e){return _string(ZodString,e)}const ZodStringFormat=$constructor("ZodStringFormat",(e,t)=>{$ZodStringFormat.init(e,t),_ZodString.init(e,t)}),ZodEmail=$constructor("ZodEmail",(e,t)=>{$ZodEmail.init(e,t),ZodStringFormat.init(e,t)}),ZodGUID=$constructor("ZodGUID",(e,t)=>{$ZodGUID.init(e,t),ZodStringFormat.init(e,t)}),ZodUUID=$constructor("ZodUUID",(e,t)=>{$ZodUUID.init(e,t),ZodStringFormat.init(e,t)}),ZodURL=$constructor("ZodURL",(e,t)=>{$ZodURL.init(e,t),ZodStringFormat.init(e,t)}),ZodEmoji=$constructor("ZodEmoji",(e,t)=>{$ZodEmoji.init(e,t),ZodStringFormat.init(e,t)}),ZodNanoID=$constructor("ZodNanoID",(e,t)=>{$ZodNanoID.init(e,t),ZodStringFormat.init(e,t)}),ZodCUID=$constructor("ZodCUID",(e,t)=>{$ZodCUID.init(e,t),ZodStringFormat.init(e,t)}),ZodCUID2=$constructor("ZodCUID2",(e,t)=>{$ZodCUID2.init(e,t),ZodStringFormat.init(e,t)}),ZodULID=$constructor("ZodULID",(e,t)=>{$ZodULID.init(e,t),ZodStringFormat.init(e,t)}),ZodXID=$constructor("ZodXID",(e,t)=>{$ZodXID.init(e,t),ZodStringFormat.init(e,t)}),ZodKSUID=$constructor("ZodKSUID",(e,t)=>{$ZodKSUID.init(e,t),ZodStringFormat.init(e,t)}),ZodIPv4=$constructor("ZodIPv4",(e,t)=>{$ZodIPv4.init(e,t),ZodStringFormat.init(e,t)}),ZodIPv6=$constructor("ZodIPv6",(e,t)=>{$ZodIPv6.init(e,t),ZodStringFormat.init(e,t)}),ZodCIDRv4=$constructor("ZodCIDRv4",(e,t)=>{$ZodCIDRv4.init(e,t),ZodStringFormat.init(e,t)}),ZodCIDRv6=$constructor("ZodCIDRv6",(e,t)=>{$ZodCIDRv6.init(e,t),ZodStringFormat.init(e,t)}),ZodBase64=$constructor("ZodBase64",(e,t)=>{$ZodBase64.init(e,t),ZodStringFormat.init(e,t)}),ZodBase64URL=$constructor("ZodBase64URL",(e,t)=>{$ZodBase64URL.init(e,t),ZodStringFormat.init(e,t)}),ZodE164=$constructor("ZodE164",(e,t)=>{$ZodE164.init(e,t),ZodStringFormat.init(e,t)}),ZodJWT=$constructor("ZodJWT",(e,t)=>{$ZodJWT.init(e,t),ZodStringFormat.init(e,t)}),ZodNumber=$constructor("ZodNumber",(e,t)=>{$ZodNumber.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(n,s,o)=>numberProcessor(e,n,s),e.gt=(n,s)=>e.check(_gt(n,s)),e.gte=(n,s)=>e.check(_gte(n,s)),e.min=(n,s)=>e.check(_gte(n,s)),e.lt=(n,s)=>e.check(_lt(n,s)),e.lte=(n,s)=>e.check(_lte(n,s)),e.max=(n,s)=>e.check(_lte(n,s)),e.int=n=>e.check(int(n)),e.safe=n=>e.check(int(n)),e.positive=n=>e.check(_gt(0,n)),e.nonnegative=n=>e.check(_gte(0,n)),e.negative=n=>e.check(_lt(0,n)),e.nonpositive=n=>e.check(_lte(0,n)),e.multipleOf=(n,s)=>e.check(_multipleOf(n,s)),e.step=(n,s)=>e.check(_multipleOf(n,s)),e.finite=()=>e;const r=e._zod.bag;e.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),e.isFinite=!0,e.format=r.format??null});function number(e){return _number(ZodNumber,e)}const ZodNumberFormat=$constructor("ZodNumberFormat",(e,t)=>{$ZodNumberFormat.init(e,t),ZodNumber.init(e,t)});function int(e){return _int(ZodNumberFormat,e)}const ZodBoolean=$constructor("ZodBoolean",(e,t)=>{$ZodBoolean.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>booleanProcessor(e,r,n)});function boolean(e){return _boolean(ZodBoolean,e)}const ZodUnknown=$constructor("ZodUnknown",(e,t)=>{$ZodUnknown.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>unknownProcessor()});function unknown(){return _unknown(ZodUnknown)}const ZodNever=$constructor("ZodNever",(e,t)=>{$ZodNever.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>neverProcessor(e,r,n)});function never(e){return _never(ZodNever,e)}const ZodArray=$constructor("ZodArray",(e,t)=>{$ZodArray.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>arrayProcessor(e,r,n,s),e.element=t.element,e.min=(r,n)=>e.check(_minLength(r,n)),e.nonempty=r=>e.check(_minLength(1,r)),e.max=(r,n)=>e.check(_maxLength(r,n)),e.length=(r,n)=>e.check(_length(r,n)),e.unwrap=()=>e.element});function array(e,t){return _array(ZodArray,e,t)}const ZodObject=$constructor("ZodObject",(e,t)=>{$ZodObjectJIT.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>objectProcessor(e,r,n,s),defineLazy(e,"shape",()=>t.shape),e.keyof=()=>_enum(Object.keys(e._zod.def.shape)),e.catchall=r=>e.clone({...e._zod.def,catchall:r}),e.passthrough=()=>e.clone({...e._zod.def,catchall:unknown()}),e.loose=()=>e.clone({...e._zod.def,catchall:unknown()}),e.strict=()=>e.clone({...e._zod.def,catchall:never()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=r=>extend(e,r),e.safeExtend=r=>safeExtend(e,r),e.merge=r=>merge(e,r),e.pick=r=>pick(e,r),e.omit=r=>omit(e,r),e.partial=(...r)=>partial(ZodOptional,e,r[0]),e.required=(...r)=>required(ZodNonOptional,e,r[0])});function object(e,t){const r={type:"object",shape:e??{},...normalizeParams(t)};return new ZodObject(r)}const ZodUnion=$constructor("ZodUnion",(e,t)=>{$ZodUnion.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>unionProcessor(e,r,n,s),e.options=t.options});function union(e,t){return new ZodUnion({type:"union",options:e,...normalizeParams(t)})}const ZodIntersection=$constructor("ZodIntersection",(e,t)=>{$ZodIntersection.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>intersectionProcessor(e,r,n,s)});function intersection(e,t){return new ZodIntersection({type:"intersection",left:e,right:t})}const ZodTuple=$constructor("ZodTuple",(e,t)=>{$ZodTuple.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>tupleProcessor(e,r,n,s),e.rest=r=>e.clone({...e._zod.def,rest:r})});function tuple(e,t,r){const n=t instanceof $ZodType,s=n?r:t,o=n?t:null;return new ZodTuple({type:"tuple",items:e,rest:o,...normalizeParams(s)})}const ZodRecord=$constructor("ZodRecord",(e,t)=>{$ZodRecord.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>recordProcessor(e,r,n,s),e.keyType=t.keyType,e.valueType=t.valueType});function record(e,t,r){return new ZodRecord({type:"record",keyType:e,valueType:t,...normalizeParams(r)})}const ZodEnum=$constructor("ZodEnum",(e,t)=>{$ZodEnum.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(n,s,o)=>enumProcessor(e,n,s),e.enum=t.entries,e.options=Object.values(t.entries);const r=new Set(Object.keys(t.entries));e.extract=(n,s)=>{const o={};for(const i of n)if(r.has(i))o[i]=t.entries[i];else throw new Error(`Key ${i} not found in enum`);return new ZodEnum({...t,checks:[],...normalizeParams(s),entries:o})},e.exclude=(n,s)=>{const o={...t.entries};for(const i of n)if(r.has(i))delete o[i];else throw new Error(`Key ${i} not found in enum`);return new ZodEnum({...t,checks:[],...normalizeParams(s),entries:o})}});function _enum(e,t){const r=Array.isArray(e)?Object.fromEntries(e.map(n=>[n,n])):e;return new ZodEnum({type:"enum",entries:r,...normalizeParams(t)})}const ZodLiteral=$constructor("ZodLiteral",(e,t)=>{$ZodLiteral.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>literalProcessor(e,r,n),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function literal(e,t){return new ZodLiteral({type:"literal",values:Array.isArray(e)?e:[e],...normalizeParams(t)})}const ZodTransform=$constructor("ZodTransform",(e,t)=>{$ZodTransform.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>transformProcessor(e,r),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new $ZodEncodeError(e.constructor.name);r.addIssue=o=>{if(typeof o=="string")r.issues.push(issue(o,r.value,t));else{const i=o;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=r.value),i.inst??(i.inst=e),r.issues.push(issue(i))}};const s=t.transform(r.value,r);return s instanceof Promise?s.then(o=>(r.value=o,r)):(r.value=s,r)}});function transform(e){return new ZodTransform({type:"transform",transform:e})}const ZodOptional=$constructor("ZodOptional",(e,t)=>{$ZodOptional.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>optionalProcessor(e,r,n,s),e.unwrap=()=>e._zod.def.innerType});function optional(e){return new ZodOptional({type:"optional",innerType:e})}const ZodExactOptional=$constructor("ZodExactOptional",(e,t)=>{$ZodExactOptional.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>optionalProcessor(e,r,n,s),e.unwrap=()=>e._zod.def.innerType});function exactOptional(e){return new ZodExactOptional({type:"optional",innerType:e})}const ZodNullable=$constructor("ZodNullable",(e,t)=>{$ZodNullable.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>nullableProcessor(e,r,n,s),e.unwrap=()=>e._zod.def.innerType});function nullable(e){return new ZodNullable({type:"nullable",innerType:e})}const ZodDefault=$constructor("ZodDefault",(e,t)=>{$ZodDefault.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>defaultProcessor(e,r,n,s),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function _default(e,t){return new ZodDefault({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():shallowClone(t)}})}const ZodPrefault=$constructor("ZodPrefault",(e,t)=>{$ZodPrefault.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>prefaultProcessor(e,r,n,s),e.unwrap=()=>e._zod.def.innerType});function prefault(e,t){return new ZodPrefault({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():shallowClone(t)}})}const ZodNonOptional=$constructor("ZodNonOptional",(e,t)=>{$ZodNonOptional.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>nonoptionalProcessor(e,r,n,s),e.unwrap=()=>e._zod.def.innerType});function nonoptional(e,t){return new ZodNonOptional({type:"nonoptional",innerType:e,...normalizeParams(t)})}const ZodCatch=$constructor("ZodCatch",(e,t)=>{$ZodCatch.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>catchProcessor(e,r,n,s),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function _catch(e,t){return new ZodCatch({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const ZodPipe=$constructor("ZodPipe",(e,t)=>{$ZodPipe.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>pipeProcessor(e,r,n,s),e.in=t.in,e.out=t.out});function pipe(e,t){return new ZodPipe({type:"pipe",in:e,out:t})}const ZodReadonly=$constructor("ZodReadonly",(e,t)=>{$ZodReadonly.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>readonlyProcessor(e,r,n,s),e.unwrap=()=>e._zod.def.innerType});function readonly(e){return new ZodReadonly({type:"readonly",innerType:e})}const ZodCustom=$constructor("ZodCustom",(e,t)=>{$ZodCustom.init(e,t),ZodType.init(e,t),e._zod.processJSONSchema=(r,n,s)=>customProcessor(e,r)});function refine(e,t={}){return _refine(ZodCustom,e,t)}function superRefine(e){return _superRefine(e)}const metadataSchema$1=object({model:string(),version:string()}),rgbColorSchema=object({r:number().min(0).max(255),g:number().min(0).max(255),b:number().min(0).max(255)});object({min:number(),max:number()});const emtEventTimesSchema=object({time_A_start:number(),time_A_end:number(),time_B_start:number(),time_B_end:number(),time_S_start:number(),time_S_end:number(),time_P_start:number(),time_P_end:number()}),ehtCellTypeSchema=object({N_init:number().int().nonnegative(),location:string(),R_hard:number().positive(),R_hard_div:number().positive(),R_soft:number().positive(),color:rgbColorSchema,dur_G2:number().nonnegative(),dur_mitosis:number().nonnegative(),k_apical_junction:number().nonnegative(),k_cytos:number().nonnegative(),max_cytoskeleton_length:number().nonnegative(),run:number().min(0).max(1),running_speed:number().nonnegative(),running_mode:number().int().min(0).max(3),stiffness_apical_apical:number().nonnegative(),stiffness_apical_apical_div:number().nonnegative(),stiffness_nuclei_apical:number().nonnegative(),stiffness_nuclei_basal:number().nonnegative(),stiffness_repulsion:number().nonnegative(),stiffness_straightness:number().nonnegative(),lifespan_start:number(),lifespan_end:number(),INM:number().min(0).max(1),hetero:boolean(),events:emtEventTimesSchema}),ehtGeneralParamsSchema=object({t_end:number().positive(),dt:number().positive(),random_seed:number().int(),full_circle:boolean(),w_init:number().positive(),h_init:number().positive(),mu:number().positive(),n_substeps:number().int().positive(),alg_dt:number().positive(),w_screen:number().positive(),h_screen:number().positive(),p_div_out:number().min(0).max(1),perimeter:number().positive(),aspect_ratio:number()}),ehtCellPropertyParamsSchema=object({apical_junction_init:number().nonnegative(),max_basal_junction_dist:number().positive(),basal_daming_ratio:number().nonnegative(),basal_membrane_repulsion:number().nonnegative(),cytos_init:number().nonnegative(),diffusion:number().nonnegative()}),ehtCellTypesMapSchema=record(string(),ehtCellTypeSchema),ehtParamsSchema=object({metadata:metadataSchema$1,general:ehtGeneralParamsSchema,cell_prop:ehtCellPropertyParamsSchema,cell_types:ehtCellTypesMapSchema}),partialMetadataSchema=metadataSchema$1.partial(),partialEhtGeneralParamsSchema=ehtGeneralParamsSchema.partial(),partialEhtCellPropertyParamsSchema=ehtCellPropertyParamsSchema.partial(),partialEhtCellTypeSchema=ehtCellTypeSchema.partial();object({metadata:partialMetadataSchema.optional(),general:partialEhtGeneralParamsSchema.optional(),cell_prop:partialEhtCellPropertyParamsSchema.optional(),cell_types:record(string(),partialEhtCellTypeSchema).optional()});function setNestedValue(e,t,r){const n=t.split(".");let s=e;for(let o=0;o<n.length-1;o++){const i=n[o];(!(i in s)||typeof s[i]!="object"||s[i]===null)&&(s[i]={}),s=s[i]}s[n[n.length-1]]=r}function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if(typeof t=="function"){var r=function n(){var s=!1;try{s=this instanceof n}catch{}return s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(e).forEach(function(n){var s=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,s.get?s:{enumerable:!0,get:function(){return e[n]}})}),r}var toml={},parse={exports:{}},tomlParser={exports:{}},parser,hasRequiredParser;function requireParser(){if(hasRequiredParser)return parser;hasRequiredParser=1;const e=1114112;class t extends Error{constructor(o,i,c){super("[ParserError] "+o,i,c),this.name="ParserError",this.code="ParserError",Error.captureStackTrace&&Error.captureStackTrace(this,t)}}class r{constructor(o){this.parser=o,this.buf="",this.returned=null,this.result=null,this.resultTable=null,this.resultArr=null}}class n{constructor(){this.pos=0,this.col=0,this.line=0,this.obj={},this.ctx=this.obj,this.stack=[],this._buf="",this.char=null,this.ii=0,this.state=new r(this.parseStart)}parse(o){if(o.length===0||o.length==null)return;this._buf=String(o),this.ii=-1,this.char=-1;let i;for(;i===!1||this.nextChar();)i=this.runOne();this._buf=null}nextChar(){return this.char===10&&(++this.line,this.col=-1),++this.ii,this.char=this._buf.codePointAt(this.ii),++this.pos,++this.col,this.haveBuffer()}haveBuffer(){return this.ii<this._buf.length}runOne(){return this.state.parser.call(this,this.state.returned)}finish(){this.char=e;let o;do o=this.state.parser,this.runOne();while(this.state.parser!==o);return this.ctx=null,this.state=null,this._buf=null,this.obj}next(o){if(typeof o!="function")throw new t("Tried to set state to non-existent state: "+JSON.stringify(o));this.state.parser=o}goto(o){return this.next(o),this.runOne()}call(o,i){i&&this.next(i),this.stack.push(this.state),this.state=new r(o)}callNow(o,i){return this.call(o,i),this.runOne()}return(o){if(this.stack.length===0)throw this.error(new t("Stack underflow"));o===void 0&&(o=this.state.buf),this.state=this.stack.pop(),this.state.returned=o}returnNow(o){return this.return(o),this.runOne()}consume(){if(this.char===e)throw this.error(new t("Unexpected end-of-buffer"));this.state.buf+=this._buf[this.ii]}error(o){return o.line=this.line,o.col=this.col,o.pos=this.pos,o}parseStart(){throw new t("Must declare a parseStart method")}}return n.END=e,n.Error=t,parser=n,parser}var createDatetime,hasRequiredCreateDatetime;function requireCreateDatetime(){return hasRequiredCreateDatetime||(hasRequiredCreateDatetime=1,createDatetime=e=>{const t=new Date(e);if(isNaN(t))throw new TypeError("Invalid Datetime");return t}),createDatetime}var formatNum,hasRequiredFormatNum;function requireFormatNum(){return hasRequiredFormatNum||(hasRequiredFormatNum=1,formatNum=(e,t)=>{for(t=String(t);t.length<e;)t="0"+t;return t}),formatNum}var createDatetimeFloat,hasRequiredCreateDatetimeFloat;function requireCreateDatetimeFloat(){if(hasRequiredCreateDatetimeFloat)return createDatetimeFloat;hasRequiredCreateDatetimeFloat=1;const e=requireFormatNum();class t extends Date{constructor(n){super(n+"Z"),this.isFloating=!0}toISOString(){const n=`${this.getUTCFullYear()}-${e(2,this.getUTCMonth()+1)}-${e(2,this.getUTCDate())}`,s=`${e(2,this.getUTCHours())}:${e(2,this.getUTCMinutes())}:${e(2,this.getUTCSeconds())}.${e(3,this.getUTCMilliseconds())}`;return`${n}T${s}`}}return createDatetimeFloat=r=>{const n=new t(r);if(isNaN(n))throw new TypeError("Invalid Datetime");return n},createDatetimeFloat}var createDate,hasRequiredCreateDate;function requireCreateDate(){if(hasRequiredCreateDate)return createDate;hasRequiredCreateDate=1;const e=requireFormatNum(),t=globalThis.Date;class r extends t{constructor(s){super(s),this.isDate=!0}toISOString(){return`${this.getUTCFullYear()}-${e(2,this.getUTCMonth()+1)}-${e(2,this.getUTCDate())}`}}return createDate=n=>{const s=new r(n);if(isNaN(s))throw new TypeError("Invalid Datetime");return s},createDate}var createTime,hasRequiredCreateTime;function requireCreateTime(){if(hasRequiredCreateTime)return createTime;hasRequiredCreateTime=1;const e=requireFormatNum();class t extends Date{constructor(n){super(`0000-01-01T${n}Z`),this.isTime=!0}toISOString(){return`${e(2,this.getUTCHours())}:${e(2,this.getUTCMinutes())}:${e(2,this.getUTCSeconds())}.${e(3,this.getUTCMilliseconds())}`}}return createTime=r=>{const n=new t(r);if(isNaN(n))throw new TypeError("Invalid Datetime");return n},createTime}var hasRequiredTomlParser;function requireTomlParser(){if(hasRequiredTomlParser)return tomlParser.exports;hasRequiredTomlParser=1,tomlParser.exports=makeParserClass(requireParser()),tomlParser.exports.makeParserClass=makeParserClass;class TomlError extends Error{constructor(t){super(t),this.name="TomlError",Error.captureStackTrace&&Error.captureStackTrace(this,TomlError),this.fromTOML=!0,this.wrapped=null}}TomlError.wrap=e=>{const t=new TomlError(e.message);return t.code=e.code,t.wrapped=e,t},tomlParser.exports.TomlError=TomlError;const createDateTime=requireCreateDatetime(),createDateTimeFloat=requireCreateDatetimeFloat(),createDate=requireCreateDate(),createTime=requireCreateTime(),CTRL_I=9,CTRL_J=10,CTRL_M=13,CTRL_CHAR_BOUNDARY=31,CHAR_SP=32,CHAR_QUOT=34,CHAR_NUM=35,CHAR_APOS=39,CHAR_PLUS=43,CHAR_COMMA=44,CHAR_HYPHEN=45,CHAR_PERIOD=46,CHAR_0=48,CHAR_1=49,CHAR_7=55,CHAR_9=57,CHAR_COLON=58,CHAR_EQUALS=61,CHAR_A=65,CHAR_E=69,CHAR_F=70,CHAR_T=84,CHAR_U=85,CHAR_Z=90,CHAR_LOWBAR=95,CHAR_a=97,CHAR_b=98,CHAR_e=101,CHAR_f=102,CHAR_i=105,CHAR_l=108,CHAR_n=110,CHAR_o=111,CHAR_r=114,CHAR_s=115,CHAR_t=116,CHAR_u=117,CHAR_x=120,CHAR_z=122,CHAR_LCUB=123,CHAR_RCUB=125,CHAR_LSQB=91,CHAR_BSOL=92,CHAR_RSQB=93,CHAR_DEL=127,SURROGATE_FIRST=55296,SURROGATE_LAST=57343,escapes={[CHAR_b]:"\b",[CHAR_t]:"	",[CHAR_n]:`
`,[CHAR_f]:"\f",[CHAR_r]:"\r",[CHAR_QUOT]:'"',[CHAR_BSOL]:"\\"};function isDigit(e){return e>=CHAR_0&&e<=CHAR_9}function isHexit(e){return e>=CHAR_A&&e<=CHAR_F||e>=CHAR_a&&e<=CHAR_f||e>=CHAR_0&&e<=CHAR_9}function isBit(e){return e===CHAR_1||e===CHAR_0}function isOctit(e){return e>=CHAR_0&&e<=CHAR_7}function isAlphaNumQuoteHyphen(e){return e>=CHAR_A&&e<=CHAR_Z||e>=CHAR_a&&e<=CHAR_z||e>=CHAR_0&&e<=CHAR_9||e===CHAR_APOS||e===CHAR_QUOT||e===CHAR_LOWBAR||e===CHAR_HYPHEN}function isAlphaNumHyphen(e){return e>=CHAR_A&&e<=CHAR_Z||e>=CHAR_a&&e<=CHAR_z||e>=CHAR_0&&e<=CHAR_9||e===CHAR_LOWBAR||e===CHAR_HYPHEN}const _type=Symbol("type"),_declared=Symbol("declared"),hasOwnProperty=Object.prototype.hasOwnProperty,defineProperty=Object.defineProperty,descriptor={configurable:!0,enumerable:!0,writable:!0,value:void 0};function hasKey(e,t){return hasOwnProperty.call(e,t)?!0:(t==="__proto__"&&defineProperty(e,"__proto__",descriptor),!1)}const INLINE_TABLE=Symbol("inline-table");function InlineTable(){return Object.defineProperties({},{[_type]:{value:INLINE_TABLE}})}function isInlineTable(e){return e===null||typeof e!="object"?!1:e[_type]===INLINE_TABLE}const TABLE=Symbol("table");function Table(){return Object.defineProperties({},{[_type]:{value:TABLE},[_declared]:{value:!1,writable:!0}})}function isTable(e){return e===null||typeof e!="object"?!1:e[_type]===TABLE}const _contentType=Symbol("content-type"),INLINE_LIST=Symbol("inline-list");function InlineList(e){return Object.defineProperties([],{[_type]:{value:INLINE_LIST},[_contentType]:{value:e}})}function isInlineList(e){return e===null||typeof e!="object"?!1:e[_type]===INLINE_LIST}const LIST=Symbol("list");function List(){return Object.defineProperties([],{[_type]:{value:LIST}})}function isList(e){return e===null||typeof e!="object"?!1:e[_type]===LIST}let _custom;try{const utilInspect=eval("require('util').inspect");_custom=utilInspect.custom}catch(e){}const _inspect=_custom||"inspect";class BoxedBigInt{constructor(t){try{this.value=globalThis.BigInt.asIntN(64,t)}catch{this.value=null}Object.defineProperty(this,_type,{value:INTEGER})}isNaN(){return this.value===null}toString(){return String(this.value)}[_inspect](){return`[BigInt: ${this.toString()}]}`}valueOf(){return this.value}}const INTEGER=Symbol("integer");function Integer(e){let t=Number(e);return Object.is(t,-0)&&(t=0),globalThis.BigInt&&!Number.isSafeInteger(t)?new BoxedBigInt(e):Object.defineProperties(new Number(t),{isNaN:{value:function(){return isNaN(this)}},[_type]:{value:INTEGER},[_inspect]:{value:()=>`[Integer: ${e}]`}})}function isInteger(e){return e===null||typeof e!="object"?!1:e[_type]===INTEGER}const FLOAT=Symbol("float");function Float(e){return Object.defineProperties(new Number(e),{[_type]:{value:FLOAT},[_inspect]:{value:()=>`[Float: ${e}]`}})}function isFloat(e){return e===null||typeof e!="object"?!1:e[_type]===FLOAT}function tomlType(e){const t=typeof e;if(t==="object"){if(e===null)return"null";if(e instanceof Date)return"datetime";if(_type in e)switch(e[_type]){case INLINE_TABLE:return"inline-table";case INLINE_LIST:return"inline-list";case TABLE:return"table";case LIST:return"list";case FLOAT:return"float";case INTEGER:return"integer"}}return t}function makeParserClass(e){class t extends e{constructor(){super(),this.ctx=this.obj=Table()}atEndOfWord(){return this.char===CHAR_NUM||this.char===CTRL_I||this.char===CHAR_SP||this.atEndOfLine()}atEndOfLine(){return this.char===e.END||this.char===CTRL_J||this.char===CTRL_M}parseStart(){if(this.char===e.END)return null;if(this.char===CHAR_LSQB)return this.call(this.parseTableOrList);if(this.char===CHAR_NUM)return this.call(this.parseComment);if(this.char===CTRL_J||this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M)return null;if(isAlphaNumQuoteHyphen(this.char))return this.callNow(this.parseAssignStatement);throw this.error(new TomlError(`Unknown character "${this.char}"`))}parseWhitespaceToEOL(){if(this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M)return null;if(this.char===CHAR_NUM)return this.goto(this.parseComment);if(this.char===e.END||this.char===CTRL_J)return this.return();throw this.error(new TomlError("Unexpected character, expected only whitespace or comments till end of line"))}parseAssignStatement(){return this.callNow(this.parseAssign,this.recordAssignStatement)}recordAssignStatement(n){let s=this.ctx,o=n.key.pop();for(let i of n.key){if(hasKey(s,i)&&(!isTable(s[i])||s[i][_declared]))throw this.error(new TomlError("Can't redefine existing key"));s=s[i]=s[i]||Table()}if(hasKey(s,o))throw this.error(new TomlError("Can't redefine existing key"));return isInteger(n.value)||isFloat(n.value)?s[o]=n.value.valueOf():s[o]=n.value,this.goto(this.parseWhitespaceToEOL)}parseAssign(){return this.callNow(this.parseKeyword,this.recordAssignKeyword)}recordAssignKeyword(n){return this.state.resultTable?this.state.resultTable.push(n):this.state.resultTable=[n],this.goto(this.parseAssignKeywordPreDot)}parseAssignKeywordPreDot(){if(this.char===CHAR_PERIOD)return this.next(this.parseAssignKeywordPostDot);if(this.char!==CHAR_SP&&this.char!==CTRL_I)return this.goto(this.parseAssignEqual)}parseAssignKeywordPostDot(){if(this.char!==CHAR_SP&&this.char!==CTRL_I)return this.callNow(this.parseKeyword,this.recordAssignKeyword)}parseAssignEqual(){if(this.char===CHAR_EQUALS)return this.next(this.parseAssignPreValue);throw this.error(new TomlError('Invalid character, expected "="'))}parseAssignPreValue(){return this.char===CHAR_SP||this.char===CTRL_I?null:this.callNow(this.parseValue,this.recordAssignValue)}recordAssignValue(n){return this.returnNow({key:this.state.resultTable,value:n})}parseComment(){do if(this.char===e.END||this.char===CTRL_J)return this.return();while(this.nextChar())}parseTableOrList(){if(this.char===CHAR_LSQB)this.next(this.parseList);else return this.goto(this.parseTable)}parseTable(){return this.ctx=this.obj,this.goto(this.parseTableNext)}parseTableNext(){return this.char===CHAR_SP||this.char===CTRL_I?null:this.callNow(this.parseKeyword,this.parseTableMore)}parseTableMore(n){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===CHAR_RSQB){if(hasKey(this.ctx,n)&&(!isTable(this.ctx[n])||this.ctx[n][_declared]))throw this.error(new TomlError("Can't redefine existing key"));return this.ctx=this.ctx[n]=this.ctx[n]||Table(),this.ctx[_declared]=!0,this.next(this.parseWhitespaceToEOL)}else if(this.char===CHAR_PERIOD){if(!hasKey(this.ctx,n))this.ctx=this.ctx[n]=Table();else if(isTable(this.ctx[n]))this.ctx=this.ctx[n];else if(isList(this.ctx[n]))this.ctx=this.ctx[n][this.ctx[n].length-1];else throw this.error(new TomlError("Can't redefine existing key"));return this.next(this.parseTableNext)}else throw this.error(new TomlError("Unexpected character, expected whitespace, . or ]"))}parseList(){return this.ctx=this.obj,this.goto(this.parseListNext)}parseListNext(){return this.char===CHAR_SP||this.char===CTRL_I?null:this.callNow(this.parseKeyword,this.parseListMore)}parseListMore(n){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===CHAR_RSQB){if(hasKey(this.ctx,n)||(this.ctx[n]=List()),isInlineList(this.ctx[n]))throw this.error(new TomlError("Can't extend an inline array"));if(isList(this.ctx[n])){const s=Table();this.ctx[n].push(s),this.ctx=s}else throw this.error(new TomlError("Can't redefine an existing key"));return this.next(this.parseListEnd)}else if(this.char===CHAR_PERIOD){if(!hasKey(this.ctx,n))this.ctx=this.ctx[n]=Table();else{if(isInlineList(this.ctx[n]))throw this.error(new TomlError("Can't extend an inline array"));if(isInlineTable(this.ctx[n]))throw this.error(new TomlError("Can't extend an inline table"));if(isList(this.ctx[n]))this.ctx=this.ctx[n][this.ctx[n].length-1];else if(isTable(this.ctx[n]))this.ctx=this.ctx[n];else throw this.error(new TomlError("Can't redefine an existing key"))}return this.next(this.parseListNext)}else throw this.error(new TomlError("Unexpected character, expected whitespace, . or ]"))}parseListEnd(n){if(this.char===CHAR_RSQB)return this.next(this.parseWhitespaceToEOL);throw this.error(new TomlError("Unexpected character, expected whitespace, . or ]"))}parseValue(){if(this.char===e.END)throw this.error(new TomlError("Key without value"));if(this.char===CHAR_QUOT)return this.next(this.parseDoubleString);if(this.char===CHAR_APOS)return this.next(this.parseSingleString);if(this.char===CHAR_HYPHEN||this.char===CHAR_PLUS)return this.goto(this.parseNumberSign);if(this.char===CHAR_i)return this.next(this.parseInf);if(this.char===CHAR_n)return this.next(this.parseNan);if(isDigit(this.char))return this.goto(this.parseNumberOrDateTime);if(this.char===CHAR_t||this.char===CHAR_f)return this.goto(this.parseBoolean);if(this.char===CHAR_LSQB)return this.call(this.parseInlineList,this.recordValue);if(this.char===CHAR_LCUB)return this.call(this.parseInlineTable,this.recordValue);throw this.error(new TomlError("Unexpected character, expecting string, number, datetime, boolean, inline array or inline table"))}recordValue(n){return this.returnNow(n)}parseInf(){if(this.char===CHAR_n)return this.next(this.parseInf2);throw this.error(new TomlError('Unexpected character, expected "inf", "+inf" or "-inf"'))}parseInf2(){if(this.char===CHAR_f)return this.state.buf==="-"?this.return(-1/0):this.return(1/0);throw this.error(new TomlError('Unexpected character, expected "inf", "+inf" or "-inf"'))}parseNan(){if(this.char===CHAR_a)return this.next(this.parseNan2);throw this.error(new TomlError('Unexpected character, expected "nan"'))}parseNan2(){if(this.char===CHAR_n)return this.return(NaN);throw this.error(new TomlError('Unexpected character, expected "nan"'))}parseKeyword(){return this.char===CHAR_QUOT?this.next(this.parseBasicString):this.char===CHAR_APOS?this.next(this.parseLiteralString):this.goto(this.parseBareKey)}parseBareKey(){do{if(this.char===e.END)throw this.error(new TomlError("Key ended without value"));if(isAlphaNumHyphen(this.char))this.consume();else{if(this.state.buf.length===0)throw this.error(new TomlError("Empty bare keys are not allowed"));return this.returnNow()}}while(this.nextChar())}parseSingleString(){return this.char===CHAR_APOS?this.next(this.parseLiteralMultiStringMaybe):this.goto(this.parseLiteralString)}parseLiteralString(){do{if(this.char===CHAR_APOS)return this.return();if(this.atEndOfLine())throw this.error(new TomlError("Unterminated string"));if(this.char===CHAR_DEL||this.char<=CTRL_CHAR_BOUNDARY&&this.char!==CTRL_I)throw this.errorControlCharInString();this.consume()}while(this.nextChar())}parseLiteralMultiStringMaybe(){return this.char===CHAR_APOS?this.next(this.parseLiteralMultiString):this.returnNow()}parseLiteralMultiString(){return this.char===CTRL_M?null:this.char===CTRL_J?this.next(this.parseLiteralMultiStringContent):this.goto(this.parseLiteralMultiStringContent)}parseLiteralMultiStringContent(){do{if(this.char===CHAR_APOS)return this.next(this.parseLiteralMultiEnd);if(this.char===e.END)throw this.error(new TomlError("Unterminated multi-line string"));if(this.char===CHAR_DEL||this.char<=CTRL_CHAR_BOUNDARY&&this.char!==CTRL_I&&this.char!==CTRL_J&&this.char!==CTRL_M)throw this.errorControlCharInString();this.consume()}while(this.nextChar())}parseLiteralMultiEnd(){return this.char===CHAR_APOS?this.next(this.parseLiteralMultiEnd2):(this.state.buf+="'",this.goto(this.parseLiteralMultiStringContent))}parseLiteralMultiEnd2(){return this.char===CHAR_APOS?this.return():(this.state.buf+="''",this.goto(this.parseLiteralMultiStringContent))}parseDoubleString(){return this.char===CHAR_QUOT?this.next(this.parseMultiStringMaybe):this.goto(this.parseBasicString)}parseBasicString(){do{if(this.char===CHAR_BSOL)return this.call(this.parseEscape,this.recordEscapeReplacement);if(this.char===CHAR_QUOT)return this.return();if(this.atEndOfLine())throw this.error(new TomlError("Unterminated string"));if(this.char===CHAR_DEL||this.char<=CTRL_CHAR_BOUNDARY&&this.char!==CTRL_I)throw this.errorControlCharInString();this.consume()}while(this.nextChar())}recordEscapeReplacement(n){return this.state.buf+=n,this.goto(this.parseBasicString)}parseMultiStringMaybe(){return this.char===CHAR_QUOT?this.next(this.parseMultiString):this.returnNow()}parseMultiString(){return this.char===CTRL_M?null:this.char===CTRL_J?this.next(this.parseMultiStringContent):this.goto(this.parseMultiStringContent)}parseMultiStringContent(){do{if(this.char===CHAR_BSOL)return this.call(this.parseMultiEscape,this.recordMultiEscapeReplacement);if(this.char===CHAR_QUOT)return this.next(this.parseMultiEnd);if(this.char===e.END)throw this.error(new TomlError("Unterminated multi-line string"));if(this.char===CHAR_DEL||this.char<=CTRL_CHAR_BOUNDARY&&this.char!==CTRL_I&&this.char!==CTRL_J&&this.char!==CTRL_M)throw this.errorControlCharInString();this.consume()}while(this.nextChar())}errorControlCharInString(){let n="\\u00";return this.char<16&&(n+="0"),n+=this.char.toString(16),this.error(new TomlError(`Control characters (codes < 0x1f and 0x7f) are not allowed in strings, use ${n} instead`))}recordMultiEscapeReplacement(n){return this.state.buf+=n,this.goto(this.parseMultiStringContent)}parseMultiEnd(){return this.char===CHAR_QUOT?this.next(this.parseMultiEnd2):(this.state.buf+='"',this.goto(this.parseMultiStringContent))}parseMultiEnd2(){return this.char===CHAR_QUOT?this.return():(this.state.buf+='""',this.goto(this.parseMultiStringContent))}parseMultiEscape(){return this.char===CTRL_M||this.char===CTRL_J?this.next(this.parseMultiTrim):this.char===CHAR_SP||this.char===CTRL_I?this.next(this.parsePreMultiTrim):this.goto(this.parseEscape)}parsePreMultiTrim(){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===CTRL_M||this.char===CTRL_J)return this.next(this.parseMultiTrim);throw this.error(new TomlError("Can't escape whitespace"))}parseMultiTrim(){return this.char===CTRL_J||this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M?null:this.returnNow()}parseEscape(){if(this.char in escapes)return this.return(escapes[this.char]);if(this.char===CHAR_u)return this.call(this.parseSmallUnicode,this.parseUnicodeReturn);if(this.char===CHAR_U)return this.call(this.parseLargeUnicode,this.parseUnicodeReturn);throw this.error(new TomlError("Unknown escape character: "+this.char))}parseUnicodeReturn(n){try{const s=parseInt(n,16);if(s>=SURROGATE_FIRST&&s<=SURROGATE_LAST)throw this.error(new TomlError("Invalid unicode, character in range 0xD800 - 0xDFFF is reserved"));return this.returnNow(String.fromCodePoint(s))}catch(s){throw this.error(TomlError.wrap(s))}}parseSmallUnicode(){if(isHexit(this.char)){if(this.consume(),this.state.buf.length>=4)return this.return()}else throw this.error(new TomlError("Invalid character in unicode sequence, expected hex"))}parseLargeUnicode(){if(isHexit(this.char)){if(this.consume(),this.state.buf.length>=8)return this.return()}else throw this.error(new TomlError("Invalid character in unicode sequence, expected hex"))}parseNumberSign(){return this.consume(),this.next(this.parseMaybeSignedInfOrNan)}parseMaybeSignedInfOrNan(){return this.char===CHAR_i?this.next(this.parseInf):this.char===CHAR_n?this.next(this.parseNan):this.callNow(this.parseNoUnder,this.parseNumberIntegerStart)}parseNumberIntegerStart(){return this.char===CHAR_0?(this.consume(),this.next(this.parseNumberIntegerExponentOrDecimal)):this.goto(this.parseNumberInteger)}parseNumberIntegerExponentOrDecimal(){return this.char===CHAR_PERIOD?(this.consume(),this.call(this.parseNoUnder,this.parseNumberFloat)):this.char===CHAR_E||this.char===CHAR_e?(this.consume(),this.next(this.parseNumberExponentSign)):this.returnNow(Integer(this.state.buf))}parseNumberInteger(){if(isDigit(this.char))this.consume();else{if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnder);if(this.char===CHAR_E||this.char===CHAR_e)return this.consume(),this.next(this.parseNumberExponentSign);if(this.char===CHAR_PERIOD)return this.consume(),this.call(this.parseNoUnder,this.parseNumberFloat);{const n=Integer(this.state.buf);if(n.isNaN())throw this.error(new TomlError("Invalid number"));return this.returnNow(n)}}}parseNoUnder(){if(this.char===CHAR_LOWBAR||this.char===CHAR_PERIOD||this.char===CHAR_E||this.char===CHAR_e)throw this.error(new TomlError("Unexpected character, expected digit"));if(this.atEndOfWord())throw this.error(new TomlError("Incomplete number"));return this.returnNow()}parseNoUnderHexOctBinLiteral(){if(this.char===CHAR_LOWBAR||this.char===CHAR_PERIOD)throw this.error(new TomlError("Unexpected character, expected digit"));if(this.atEndOfWord())throw this.error(new TomlError("Incomplete number"));return this.returnNow()}parseNumberFloat(){if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnder,this.parseNumberFloat);if(isDigit(this.char))this.consume();else return this.char===CHAR_E||this.char===CHAR_e?(this.consume(),this.next(this.parseNumberExponentSign)):this.returnNow(Float(this.state.buf))}parseNumberExponentSign(){if(isDigit(this.char))return this.goto(this.parseNumberExponent);if(this.char===CHAR_HYPHEN||this.char===CHAR_PLUS)this.consume(),this.call(this.parseNoUnder,this.parseNumberExponent);else throw this.error(new TomlError("Unexpected character, expected -, + or digit"))}parseNumberExponent(){if(isDigit(this.char))this.consume();else return this.char===CHAR_LOWBAR?this.call(this.parseNoUnder):this.returnNow(Float(this.state.buf))}parseNumberOrDateTime(){return this.char===CHAR_0?(this.consume(),this.next(this.parseNumberBaseOrDateTime)):this.goto(this.parseNumberOrDateTimeOnly)}parseNumberOrDateTimeOnly(){if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnder,this.parseNumberInteger);if(isDigit(this.char))this.consume(),this.state.buf.length>4&&this.next(this.parseNumberInteger);else return this.char===CHAR_E||this.char===CHAR_e?(this.consume(),this.next(this.parseNumberExponentSign)):this.char===CHAR_PERIOD?(this.consume(),this.call(this.parseNoUnder,this.parseNumberFloat)):this.char===CHAR_HYPHEN?this.goto(this.parseDateTime):this.char===CHAR_COLON?this.goto(this.parseOnlyTimeHour):this.returnNow(Integer(this.state.buf))}parseDateTimeOnly(){if(this.state.buf.length<4){if(isDigit(this.char))return this.consume();if(this.char===CHAR_COLON)return this.goto(this.parseOnlyTimeHour);throw this.error(new TomlError("Expected digit while parsing year part of a date"))}else{if(this.char===CHAR_HYPHEN)return this.goto(this.parseDateTime);throw this.error(new TomlError("Expected hyphen (-) while parsing year part of date"))}}parseNumberBaseOrDateTime(){return this.char===CHAR_b?(this.consume(),this.call(this.parseNoUnderHexOctBinLiteral,this.parseIntegerBin)):this.char===CHAR_o?(this.consume(),this.call(this.parseNoUnderHexOctBinLiteral,this.parseIntegerOct)):this.char===CHAR_x?(this.consume(),this.call(this.parseNoUnderHexOctBinLiteral,this.parseIntegerHex)):this.char===CHAR_PERIOD?this.goto(this.parseNumberInteger):isDigit(this.char)?this.goto(this.parseDateTimeOnly):this.returnNow(Integer(this.state.buf))}parseIntegerHex(){if(isHexit(this.char))this.consume();else{if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnderHexOctBinLiteral);{const n=Integer(this.state.buf);if(n.isNaN())throw this.error(new TomlError("Invalid number"));return this.returnNow(n)}}}parseIntegerOct(){if(isOctit(this.char))this.consume();else{if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnderHexOctBinLiteral);{const n=Integer(this.state.buf);if(n.isNaN())throw this.error(new TomlError("Invalid number"));return this.returnNow(n)}}}parseIntegerBin(){if(isBit(this.char))this.consume();else{if(this.char===CHAR_LOWBAR)return this.call(this.parseNoUnderHexOctBinLiteral);{const n=Integer(this.state.buf);if(n.isNaN())throw this.error(new TomlError("Invalid number"));return this.returnNow(n)}}}parseDateTime(){if(this.state.buf.length<4)throw this.error(new TomlError("Years less than 1000 must be zero padded to four characters"));return this.state.result=this.state.buf,this.state.buf="",this.next(this.parseDateMonth)}parseDateMonth(){if(this.char===CHAR_HYPHEN){if(this.state.buf.length<2)throw this.error(new TomlError("Months less than 10 must be zero padded to two characters"));return this.state.result+="-"+this.state.buf,this.state.buf="",this.next(this.parseDateDay)}else if(isDigit(this.char))this.consume();else throw this.error(new TomlError("Incomplete datetime"))}parseDateDay(){if(this.char===CHAR_T||this.char===CHAR_SP){if(this.state.buf.length<2)throw this.error(new TomlError("Days less than 10 must be zero padded to two characters"));return this.state.result+="-"+this.state.buf,this.state.buf="",this.next(this.parseStartTimeHour)}else{if(this.atEndOfWord())return this.returnNow(createDate(this.state.result+"-"+this.state.buf));if(isDigit(this.char))this.consume();else throw this.error(new TomlError("Incomplete datetime"))}}parseStartTimeHour(){return this.atEndOfWord()?this.returnNow(createDate(this.state.result)):this.goto(this.parseTimeHour)}parseTimeHour(){if(this.char===CHAR_COLON){if(this.state.buf.length<2)throw this.error(new TomlError("Hours less than 10 must be zero padded to two characters"));return this.state.result+="T"+this.state.buf,this.state.buf="",this.next(this.parseTimeMin)}else if(isDigit(this.char))this.consume();else throw this.error(new TomlError("Incomplete datetime"))}parseTimeMin(){if(this.state.buf.length<2&&isDigit(this.char))this.consume();else{if(this.state.buf.length===2&&this.char===CHAR_COLON)return this.state.result+=":"+this.state.buf,this.state.buf="",this.next(this.parseTimeSec);throw this.error(new TomlError("Incomplete datetime"))}}parseTimeSec(){if(isDigit(this.char)){if(this.consume(),this.state.buf.length===2)return this.state.result+=":"+this.state.buf,this.state.buf="",this.next(this.parseTimeZoneOrFraction)}else throw this.error(new TomlError("Incomplete datetime"))}parseOnlyTimeHour(){if(this.char===CHAR_COLON){if(this.state.buf.length<2)throw this.error(new TomlError("Hours less than 10 must be zero padded to two characters"));return this.state.result=this.state.buf,this.state.buf="",this.next(this.parseOnlyTimeMin)}else throw this.error(new TomlError("Incomplete time"))}parseOnlyTimeMin(){if(this.state.buf.length<2&&isDigit(this.char))this.consume();else{if(this.state.buf.length===2&&this.char===CHAR_COLON)return this.state.result+=":"+this.state.buf,this.state.buf="",this.next(this.parseOnlyTimeSec);throw this.error(new TomlError("Incomplete time"))}}parseOnlyTimeSec(){if(isDigit(this.char)){if(this.consume(),this.state.buf.length===2)return this.next(this.parseOnlyTimeFractionMaybe)}else throw this.error(new TomlError("Incomplete time"))}parseOnlyTimeFractionMaybe(){if(this.state.result+=":"+this.state.buf,this.char===CHAR_PERIOD)this.state.buf="",this.next(this.parseOnlyTimeFraction);else return this.return(createTime(this.state.result))}parseOnlyTimeFraction(){if(isDigit(this.char))this.consume();else if(this.atEndOfWord()){if(this.state.buf.length===0)throw this.error(new TomlError("Expected digit in milliseconds"));return this.returnNow(createTime(this.state.result+"."+this.state.buf))}else throw this.error(new TomlError("Unexpected character in datetime, expected period (.), minus (-), plus (+) or Z"))}parseTimeZoneOrFraction(){if(this.char===CHAR_PERIOD)this.consume(),this.next(this.parseDateTimeFraction);else if(this.char===CHAR_HYPHEN||this.char===CHAR_PLUS)this.consume(),this.next(this.parseTimeZoneHour);else{if(this.char===CHAR_Z)return this.consume(),this.return(createDateTime(this.state.result+this.state.buf));if(this.atEndOfWord())return this.returnNow(createDateTimeFloat(this.state.result+this.state.buf));throw this.error(new TomlError("Unexpected character in datetime, expected period (.), minus (-), plus (+) or Z"))}}parseDateTimeFraction(){if(isDigit(this.char))this.consume();else{if(this.state.buf.length===1)throw this.error(new TomlError("Expected digit in milliseconds"));if(this.char===CHAR_HYPHEN||this.char===CHAR_PLUS)this.consume(),this.next(this.parseTimeZoneHour);else{if(this.char===CHAR_Z)return this.consume(),this.return(createDateTime(this.state.result+this.state.buf));if(this.atEndOfWord())return this.returnNow(createDateTimeFloat(this.state.result+this.state.buf));throw this.error(new TomlError("Unexpected character in datetime, expected period (.), minus (-), plus (+) or Z"))}}}parseTimeZoneHour(){if(isDigit(this.char)){if(this.consume(),/\d\d$/.test(this.state.buf))return this.next(this.parseTimeZoneSep)}else throw this.error(new TomlError("Unexpected character in datetime, expected digit"))}parseTimeZoneSep(){if(this.char===CHAR_COLON)this.consume(),this.next(this.parseTimeZoneMin);else throw this.error(new TomlError("Unexpected character in datetime, expected colon"))}parseTimeZoneMin(){if(isDigit(this.char)){if(this.consume(),/\d\d$/.test(this.state.buf))return this.return(createDateTime(this.state.result+this.state.buf))}else throw this.error(new TomlError("Unexpected character in datetime, expected digit"))}parseBoolean(){if(this.char===CHAR_t)return this.consume(),this.next(this.parseTrue_r);if(this.char===CHAR_f)return this.consume(),this.next(this.parseFalse_a)}parseTrue_r(){if(this.char===CHAR_r)return this.consume(),this.next(this.parseTrue_u);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseTrue_u(){if(this.char===CHAR_u)return this.consume(),this.next(this.parseTrue_e);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseTrue_e(){if(this.char===CHAR_e)return this.return(!0);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseFalse_a(){if(this.char===CHAR_a)return this.consume(),this.next(this.parseFalse_l);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseFalse_l(){if(this.char===CHAR_l)return this.consume(),this.next(this.parseFalse_s);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseFalse_s(){if(this.char===CHAR_s)return this.consume(),this.next(this.parseFalse_e);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseFalse_e(){if(this.char===CHAR_e)return this.return(!1);throw this.error(new TomlError("Invalid boolean, expected true or false"))}parseInlineList(){if(this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M||this.char===CTRL_J)return null;if(this.char===e.END)throw this.error(new TomlError("Unterminated inline array"));return this.char===CHAR_NUM?this.call(this.parseComment):this.char===CHAR_RSQB?this.return(this.state.resultArr||InlineList()):this.callNow(this.parseValue,this.recordInlineListValue)}recordInlineListValue(n){if(this.state.resultArr){const s=this.state.resultArr[_contentType],o=tomlType(n);if(s!==o)throw this.error(new TomlError(`Inline lists must be a single type, not a mix of ${s} and ${o}`))}else this.state.resultArr=InlineList(tomlType(n));return isFloat(n)||isInteger(n)?this.state.resultArr.push(n.valueOf()):this.state.resultArr.push(n),this.goto(this.parseInlineListNext)}parseInlineListNext(){if(this.char===CHAR_SP||this.char===CTRL_I||this.char===CTRL_M||this.char===CTRL_J)return null;if(this.char===CHAR_NUM)return this.call(this.parseComment);if(this.char===CHAR_COMMA)return this.next(this.parseInlineList);if(this.char===CHAR_RSQB)return this.goto(this.parseInlineList);throw this.error(new TomlError("Invalid character, expected whitespace, comma (,) or close bracket (])"))}parseInlineTable(){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===e.END||this.char===CHAR_NUM||this.char===CTRL_J||this.char===CTRL_M)throw this.error(new TomlError("Unterminated inline array"));return this.char===CHAR_RCUB?this.return(this.state.resultTable||InlineTable()):(this.state.resultTable||(this.state.resultTable=InlineTable()),this.callNow(this.parseAssign,this.recordInlineTableValue))}recordInlineTableValue(n){let s=this.state.resultTable,o=n.key.pop();for(let i of n.key){if(hasKey(s,i)&&(!isTable(s[i])||s[i][_declared]))throw this.error(new TomlError("Can't redefine existing key"));s=s[i]=s[i]||Table()}if(hasKey(s,o))throw this.error(new TomlError("Can't redefine existing key"));return isInteger(n.value)||isFloat(n.value)?s[o]=n.value.valueOf():s[o]=n.value,this.goto(this.parseInlineTableNext)}parseInlineTableNext(){if(this.char===CHAR_SP||this.char===CTRL_I)return null;if(this.char===e.END||this.char===CHAR_NUM||this.char===CTRL_J||this.char===CTRL_M)throw this.error(new TomlError("Unterminated inline array"));if(this.char===CHAR_COMMA)return this.next(this.parseInlineTable);if(this.char===CHAR_RCUB)return this.goto(this.parseInlineTable);throw this.error(new TomlError("Invalid character, expected whitespace, comma (,) or close bracket (])"))}}return t}return tomlParser.exports}var parsePrettyError,hasRequiredParsePrettyError;function requireParsePrettyError(){if(hasRequiredParsePrettyError)return parsePrettyError;hasRequiredParsePrettyError=1,parsePrettyError=e;function e(t,r){if(t.pos==null||t.line==null)return t;let n=t.message;if(n+=` at row ${t.line+1}, col ${t.col+1}, pos ${t.pos}:
`,r&&r.split){const s=r.split(/\n/),o=String(Math.min(s.length,t.line+3)).length;let i=" ";for(;i.length<o;)i+=" ";for(let c=Math.max(0,t.line-1);c<Math.min(s.length,t.line+2);++c){let a=String(c+1);if(a.length<o&&(a=" "+a),t.line===c){n+=a+"> "+s[c]+`
`,n+=i+"  ";for(let u=0;u<t.col;++u)n+=" ";n+=`^
`}else n+=a+": "+s[c]+`
`}}return t.message=n+`
`,t}return parsePrettyError}var parseString_1,hasRequiredParseString;function requireParseString(){if(hasRequiredParseString)return parseString_1;hasRequiredParseString=1,parseString_1=r;const e=requireTomlParser(),t=requireParsePrettyError();function r(n){globalThis.Buffer&&globalThis.Buffer.isBuffer(n)&&(n=n.toString("utf8"));const s=new e;try{return s.parse(n),s.finish()}catch(o){throw t(o,n)}}return parseString_1}var parseAsync_1,hasRequiredParseAsync;function requireParseAsync(){if(hasRequiredParseAsync)return parseAsync_1;hasRequiredParseAsync=1,parseAsync_1=r;const e=requireTomlParser(),t=requireParsePrettyError();function r(n,s){s||(s={});const o=0,i=s.blocksize||40960,c=new e;return new Promise((u,l)=>{setImmediate(a,o,i,u,l)});function a(u,l,h,f){if(u>=n.length)try{return h(c.finish())}catch(p){return f(t(p,n))}try{c.parse(n.slice(u,u+l)),setImmediate(a,u+l,l,h,f)}catch(p){f(t(p,n))}}}return parseAsync_1}var __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze({__proto__:null,default:__viteBrowserExternal}),require$$0=getAugmentedNamespace(__viteBrowserExternal$1),parseStream_1,hasRequiredParseStream;function requireParseStream(){if(hasRequiredParseStream)return parseStream_1;hasRequiredParseStream=1,parseStream_1=r;const e=require$$0,t=requireTomlParser();function r(o){return o?n(o):s()}function n(o){const i=new t;return o.setEncoding("utf8"),new Promise((c,a)=>{let u,l=!1,h=!1;function f(){if(l=!0,!u)try{c(i.finish())}catch(_){a(_)}}function p(_){h=!0,a(_)}o.once("end",f),o.once("error",p),m();function m(){u=!0;let _;for(;(_=o.read())!==null;)try{i.parse(_)}catch(w){return p(w)}if(u=!1,l)return f();h||o.once("readable",m)}})}function s(){const o=new t;return new e.Transform({objectMode:!0,transform(i,c,a){try{o.parse(i.toString(c))}catch(u){this.emit("error",u)}a()},flush(i){try{this.push(o.finish())}catch(c){this.emit("error",c)}i()}})}return parseStream_1}var hasRequiredParse;function requireParse(){return hasRequiredParse||(hasRequiredParse=1,parse.exports=requireParseString(),parse.exports.async=requireParseAsync(),parse.exports.stream=requireParseStream(),parse.exports.prettyError=requireParsePrettyError()),parse.exports}var stringify={exports:{}},hasRequiredStringify;function requireStringify(){if(hasRequiredStringify)return stringify.exports;hasRequiredStringify=1,stringify.exports=e,stringify.exports.value=w;function e(d){if(d===null)throw t("null");if(d===void 0)throw t("undefined");if(typeof d!="object")throw t(typeof d);if(typeof d.toJSON=="function"&&(d=d.toJSON()),d==null)return null;const y=a(d);if(y!=="table")throw t(y);return i("","",d)}function t(d){return new Error("Can only stringify objects, not "+d)}function r(){return new Error("Array values can't have mixed types")}function n(d){return Object.keys(d).filter(y=>c(d[y]))}function s(d){return Object.keys(d).filter(y=>!c(d[y]))}function o(d){let y=Array.isArray(d)?[]:Object.prototype.hasOwnProperty.call(d,"__proto__")?{["__proto__"]:void 0}:{};for(let A of Object.keys(d))d[A]&&typeof d[A].toJSON=="function"&&!("toISOString"in d[A])?y[A]=d[A].toJSON():y[A]=d[A];return y}function i(d,y,A){A=o(A);var S,O;S=n(A),O=s(A);var z=[],N=y||"";S.forEach(k=>{var L=a(A[k]);L!=="undefined"&&L!=="null"&&z.push(N+u(k)+" = "+_(A[k],!0))}),z.length>0&&z.push("");var j=d&&S.length>0?y+"  ":"";return O.forEach(k=>{z.push(E(d,j,k,A[k]))}),z.join(`
`)}function c(d){switch(a(d)){case"undefined":case"null":case"integer":case"nan":case"float":case"boolean":case"string":case"datetime":return!0;case"array":return d.length===0||a(d[0])!=="table";case"table":return Object.keys(d).length===0;default:return!1}}function a(d){return d===void 0?"undefined":d===null?"null":typeof d=="bigint"||Number.isInteger(d)&&!Object.is(d,-0)?"integer":typeof d=="number"?"float":typeof d=="boolean"?"boolean":typeof d=="string"?"string":"toISOString"in d?isNaN(d)?"undefined":"datetime":Array.isArray(d)?"array":"table"}function u(d){var y=String(d);return/^[-A-Za-z0-9_]+$/.test(y)?y:l(y)}function l(d){return'"'+p(d).replace(/"/g,'\\"')+'"'}function h(d){return"'"+d+"'"}function f(d,y){for(;y.length<d;)y="0"+y;return y}function p(d){return d.replace(/\\/g,"\\\\").replace(/[\b]/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/([\u0000-\u001f\u007f])/,y=>"\\u"+f(4,y.codePointAt(0).toString(16)))}function m(d){let y=d.split(/\n/).map(A=>p(A).replace(/"(?="")/g,'\\"')).join(`
`);return y.slice(-1)==='"'&&(y+=`\\
`),`"""
`+y+'"""'}function _(d,y){let A=a(d);return A==="string"&&(y&&/\n/.test(d)?A="string-multiline":!/[\b\t\n\f\r']/.test(d)&&/"/.test(d)&&(A="string-literal")),w(d,A)}function w(d,y){switch(y||(y=a(d)),y){case"string-multiline":return m(d);case"string":return l(d);case"string-literal":return h(d);case"integer":return g(d);case"float":return b(d);case"boolean":return $(d);case"datetime":return T(d);case"array":return R(d.filter(A=>a(A)!=="null"&&a(A)!=="undefined"&&a(A)!=="nan"));case"table":return P(d);default:throw t(y)}}function g(d){return String(d).replace(/\B(?=(\d{3})+(?!\d))/g,"_")}function b(d){if(d===1/0)return"inf";if(d===-1/0)return"-inf";if(Object.is(d,NaN))return"nan";if(Object.is(d,-0))return"-0.0";var y=String(d).split("."),A=y[0],S=y[1]||0;return g(A)+"."+S}function $(d){return String(d)}function T(d){return d.toISOString()}function v(d){return d==="float"||d==="integer"}function C(d){var y=a(d[0]);return d.every(A=>a(A)===y)?y:d.every(A=>v(a(A)))?"float":"mixed"}function x(d){const y=C(d);if(y==="mixed")throw r();return y}function R(d){d=o(d);const y=x(d);var A="[",S=d.map(O=>w(O,y));return S.join(", ").length>60||/\n/.test(S)?A+=`
  `+S.join(`,
  `)+`
`:A+=" "+S.join(", ")+(S.length>0?" ":""),A+"]"}function P(d){d=o(d);var y=[];return Object.keys(d).forEach(A=>{y.push(u(A)+" = "+_(d[A],!1))}),"{ "+y.join(", ")+(y.length>0?" ":"")+"}"}function E(d,y,A,S){var O=a(S);if(O==="array")return I(d,y,A,S);if(O==="table")return Z(d,y,A,S);throw t(O)}function I(d,y,A,S){S=o(S),x(S);var O=a(S[0]);if(O!=="table")throw t(O);var z=d+u(A),N="";return S.forEach(j=>{N.length>0&&(N+=`
`),N+=y+"[["+z+`]]
`,N+=i(z+".",y,j)}),N}function Z(d,y,A,S){var O=d+u(A),z="";return n(S).length>0&&(z+=y+"["+O+`]
`),z+i(O+".",y,S)}return stringify.exports}var hasRequiredToml;function requireToml(){return hasRequiredToml||(hasRequiredToml=1,toml.parse=requireParse(),toml.stringify=requireStringify()),toml}requireToml();class Vector2{constructor(t=0,r=0){this.x=t,this.y=r}static from(t){return new Vector2(t.x,t.y)}static zero(){return new Vector2(0,0)}static fromAngle(t){return new Vector2(Math.cos(t),Math.sin(t))}add(t){return new Vector2(this.x+t.x,this.y+t.y)}sub(t){return new Vector2(this.x-t.x,this.y-t.y)}scale(t){return new Vector2(this.x*t,this.y*t)}mult(t){return this.scale(t)}div(t){return t===0?(console.warn("Vector2.div: division by zero"),this):new Vector2(this.x/t,this.y/t)}negate(){return new Vector2(-this.x,-this.y)}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}magSq(){return this.x*this.x+this.y*this.y}normalize(){const t=this.mag();return t===0?this:new Vector2(this.x/t,this.y/t)}setMag(t){return this.normalize().scale(t)}limit(t){return this.magSq()>t*t?this.normalize().scale(t):this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}dist(t){const r=this.x-t.x,n=this.y-t.y;return Math.sqrt(r*r+n*n)}distSq(t){const r=this.x-t.x,n=this.y-t.y;return r*r+n*n}heading(){return Math.atan2(this.y,this.x)}rotate(t){const r=Math.cos(t),n=Math.sin(t);return new Vector2(this.x*r-this.y*n,this.x*n+this.y*r)}lerp(t,r){return new Vector2(this.x+(t.x-this.x)*r,this.y+(t.y-this.y)*r)}equals(t){return this.x===t.x&&this.y===t.y}approxEquals(t,r=1e-10){return Math.abs(this.x-t.x)<r&&Math.abs(this.y-t.y)<r}copy(){return new Vector2(this.x,this.y)}toObject(){return{x:this.x,y:this.y}}toString(){return`Vector2(${this.x}, ${this.y})`}toArray(){return[this.x,this.y]}}var alea$1={exports:{}},alea=alea$1.exports,hasRequiredAlea;function requireAlea(){return hasRequiredAlea||(hasRequiredAlea=1,(function(e){(function(t,r,n){function s(a){var u=this,l=c();u.next=function(){var h=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=h-(u.c=h|0)},u.c=1,u.s0=l(" "),u.s1=l(" "),u.s2=l(" "),u.s0-=l(a),u.s0<0&&(u.s0+=1),u.s1-=l(a),u.s1<0&&(u.s1+=1),u.s2-=l(a),u.s2<0&&(u.s2+=1),l=null}function o(a,u){return u.c=a.c,u.s0=a.s0,u.s1=a.s1,u.s2=a.s2,u}function i(a,u){var l=new s(a),h=u&&u.state,f=l.next;return f.int32=function(){return l.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,h&&(typeof h=="object"&&o(h,l),f.state=function(){return o(l,{})}),f}function c(){var a=4022871197,u=function(l){l=String(l);for(var h=0;h<l.length;h++){a+=l.charCodeAt(h);var f=.02519603282416938*a;a=f>>>0,f-=a,f*=a,a=f>>>0,f-=a,a+=f*4294967296}return(a>>>0)*23283064365386963e-26};return u}r&&r.exports?r.exports=i:this.alea=i})(alea,e)})(alea$1)),alea$1.exports}var xor128$1={exports:{}},xor128=xor128$1.exports,hasRequiredXor128;function requireXor128(){return hasRequiredXor128||(hasRequiredXor128=1,(function(e){(function(t,r,n){function s(c){var a=this,u="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var h=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^h^h>>>8},c===(c|0)?a.x=c:u+=c;for(var l=0;l<u.length+64;l++)a.x^=u.charCodeAt(l)|0,a.next()}function o(c,a){return a.x=c.x,a.y=c.y,a.z=c.z,a.w=c.w,a}function i(c,a){var u=new s(c),l=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,p=(u.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=u.next,h.quick=h,l&&(typeof l=="object"&&o(l,u),h.state=function(){return o(u,{})}),h}r&&r.exports?r.exports=i:this.xor128=i})(xor128,e)})(xor128$1)),xor128$1.exports}var xorwow$1={exports:{}},xorwow=xorwow$1.exports,hasRequiredXorwow;function requireXorwow(){return hasRequiredXorwow||(hasRequiredXorwow=1,(function(e){(function(t,r,n){function s(c){var a=this,u="";a.next=function(){var h=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(h^h<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,c===(c|0)?a.x=c:u+=c;for(var l=0;l<u.length+64;l++)a.x^=u.charCodeAt(l)|0,l==u.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(c,a){return a.x=c.x,a.y=c.y,a.z=c.z,a.w=c.w,a.v=c.v,a.d=c.d,a}function i(c,a){var u=new s(c),l=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,p=(u.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=u.next,h.quick=h,l&&(typeof l=="object"&&o(l,u),h.state=function(){return o(u,{})}),h}r&&r.exports?r.exports=i:this.xorwow=i})(xorwow,e)})(xorwow$1)),xorwow$1.exports}var xorshift7$1={exports:{}},xorshift7=xorshift7$1.exports,hasRequiredXorshift7;function requireXorshift7(){return hasRequiredXorshift7||(hasRequiredXorshift7=1,(function(e){(function(t,r,n){function s(c){var a=this;a.next=function(){var l=a.x,h=a.i,f,p;return f=l[h],f^=f>>>7,p=f^f<<24,f=l[h+1&7],p^=f^f>>>10,f=l[h+3&7],p^=f^f>>>3,f=l[h+4&7],p^=f^f<<7,f=l[h+7&7],f=f^f<<13,p^=f^f<<9,l[h]=p,a.i=h+1&7,p};function u(l,h){var f,p=[];if(h===(h|0))p[0]=h;else for(h=""+h,f=0;f<h.length;++f)p[f&7]=p[f&7]<<15^h.charCodeAt(f)+p[f+1&7]<<13;for(;p.length<8;)p.push(0);for(f=0;f<8&&p[f]===0;++f);for(f==8?p[7]=-1:p[f],l.x=p,l.i=0,f=256;f>0;--f)l.next()}u(a,c)}function o(c,a){return a.x=c.x.slice(),a.i=c.i,a}function i(c,a){c==null&&(c=+new Date);var u=new s(c),l=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,p=(u.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=u.next,h.quick=h,l&&(l.x&&o(l,u),h.state=function(){return o(u,{})}),h}r&&r.exports?r.exports=i:this.xorshift7=i})(xorshift7,e)})(xorshift7$1)),xorshift7$1.exports}var xor4096$1={exports:{}},xor4096=xor4096$1.exports,hasRequiredXor4096;function requireXor4096(){return hasRequiredXor4096||(hasRequiredXor4096=1,(function(e){(function(t,r,n){function s(c){var a=this;a.next=function(){var l=a.w,h=a.X,f=a.i,p,m;return a.w=l=l+1640531527|0,m=h[f+34&127],p=h[f=f+1&127],m^=m<<13,p^=p<<17,m^=m>>>15,p^=p>>>12,m=h[f]=m^p,a.i=f,m+(l^l>>>16)|0};function u(l,h){var f,p,m,_,w,g=[],b=128;for(h===(h|0)?(p=h,h=null):(h=h+"\0",p=0,b=Math.max(b,h.length)),m=0,_=-32;_<b;++_)h&&(p^=h.charCodeAt((_+32)%h.length)),_===0&&(w=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,_>=0&&(w=w+1640531527|0,f=g[_&127]^=p+w,m=f==0?m+1:0);for(m>=128&&(g[(h&&h.length||0)&127]=-1),m=127,_=512;_>0;--_)p=g[m+34&127],f=g[m=m+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,g[m]=p^f;l.w=w,l.X=g,l.i=m}u(a,c)}function o(c,a){return a.i=c.i,a.w=c.w,a.X=c.X.slice(),a}function i(c,a){c==null&&(c=+new Date);var u=new s(c),l=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,p=(u.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=u.next,h.quick=h,l&&(l.X&&o(l,u),h.state=function(){return o(u,{})}),h}r&&r.exports?r.exports=i:this.xor4096=i})(xor4096,e)})(xor4096$1)),xor4096$1.exports}var tychei$1={exports:{}},tychei=tychei$1.exports,hasRequiredTychei;function requireTychei(){return hasRequiredTychei||(hasRequiredTychei=1,(function(e){(function(t,r,n){function s(c){var a=this,u="";a.next=function(){var h=a.b,f=a.c,p=a.d,m=a.a;return h=h<<25^h>>>7^f,f=f-p|0,p=p<<24^p>>>8^m,m=m-h|0,a.b=h=h<<20^h>>>12^f,a.c=f=f-p|0,a.d=p<<16^f>>>16^m,a.a=m-h|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,c===Math.floor(c)?(a.a=c/4294967296|0,a.b=c|0):u+=c;for(var l=0;l<u.length+20;l++)a.b^=u.charCodeAt(l)|0,a.next()}function o(c,a){return a.a=c.a,a.b=c.b,a.c=c.c,a.d=c.d,a}function i(c,a){var u=new s(c),l=a&&a.state,h=function(){return(u.next()>>>0)/4294967296};return h.double=function(){do var f=u.next()>>>11,p=(u.next()>>>0)/4294967296,m=(f+p)/(1<<21);while(m===0);return m},h.int32=u.next,h.quick=h,l&&(typeof l=="object"&&o(l,u),h.state=function(){return o(u,{})}),h}r&&r.exports?r.exports=i:this.tychei=i})(tychei,e)})(tychei$1)),tychei$1.exports}var seedrandom$3={exports:{}},seedrandom$2=seedrandom$3.exports,hasRequiredSeedrandom$1;function requireSeedrandom$1(){return hasRequiredSeedrandom$1||(hasRequiredSeedrandom$1=1,(function(e){(function(t,r,n){var s=256,o=6,i=52,c="random",a=n.pow(s,o),u=n.pow(2,i),l=u*2,h=s-1,f;function p(T,v,C){var x=[];v=v==!0?{entropy:!0}:v||{};var R=g(w(v.entropy?[T,$(r)]:T??b(),3),x),P=new m(x),E=function(){for(var I=P.g(o),Z=a,d=0;I<u;)I=(I+d)*s,Z*=s,d=P.g(1);for(;I>=l;)I/=2,Z/=2,d>>>=1;return(I+d)/Z};return E.int32=function(){return P.g(4)|0},E.quick=function(){return P.g(4)/4294967296},E.double=E,g($(P.S),r),(v.pass||C||function(I,Z,d,y){return y&&(y.S&&_(y,P),I.state=function(){return _(P,{})}),d?(n[c]=I,Z):I})(E,R,"global"in v?v.global:this==n,v.state)}function m(T){var v,C=T.length,x=this,R=0,P=x.i=x.j=0,E=x.S=[];for(C||(T=[C++]);R<s;)E[R]=R++;for(R=0;R<s;R++)E[R]=E[P=h&P+T[R%C]+(v=E[R])],E[P]=v;(x.g=function(I){for(var Z,d=0,y=x.i,A=x.j,S=x.S;I--;)Z=S[y=h&y+1],d=d*s+S[h&(S[y]=S[A=h&A+Z])+(S[A]=Z)];return x.i=y,x.j=A,d})(s)}function _(T,v){return v.i=T.i,v.j=T.j,v.S=T.S.slice(),v}function w(T,v){var C=[],x=typeof T,R;if(v&&x=="object")for(R in T)try{C.push(w(T[R],v-1))}catch{}return C.length?C:x=="string"?T:T+"\0"}function g(T,v){for(var C=T+"",x,R=0;R<C.length;)v[h&R]=h&(x^=v[h&R]*19)+C.charCodeAt(R++);return $(v)}function b(){try{var T;return f&&(T=f.randomBytes)?T=T(s):(T=new Uint8Array(s),(t.crypto||t.msCrypto).getRandomValues(T)),$(T)}catch{var v=t.navigator,C=v&&v.plugins;return[+new Date,t,C,t.screen,$(r)]}}function $(T){return String.fromCharCode.apply(0,T)}if(g(n.random(),r),e.exports){e.exports=p;try{f=require$$0}catch{}}else n["seed"+c]=p})(typeof self<"u"?self:seedrandom$2,[],Math)})(seedrandom$3)),seedrandom$3.exports}var seedrandom$1,hasRequiredSeedrandom;function requireSeedrandom(){if(hasRequiredSeedrandom)return seedrandom$1;hasRequiredSeedrandom=1;var e=requireAlea(),t=requireXor128(),r=requireXorwow(),n=requireXorshift7(),s=requireXor4096(),o=requireTychei(),i=requireSeedrandom$1();return i.alea=e,i.xor128=t,i.xorwow=r,i.xorshift7=n,i.xor4096=s,i.tychei=o,seedrandom$1=i,seedrandom$1}var seedrandomExports=requireSeedrandom(),seedrandom=getDefaultExportFromCjs(seedrandomExports);class SeededRandom{rng;constructor(t=0){this.rng=seedrandom(String(t))}reset(t){this.rng=seedrandom(String(t))}random(t,r){const n=this.rng();return t===void 0?n:r===void 0?n*t:t+n*(r-t)}randomInt(t,r){return Math.floor(r===void 0?this.random(t):this.random(t,r))}randomBool(t=.5){return this.rng()<t}gaussian(){let t,r;do t=this.rng(),r=this.rng();while(t===0);return Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*r)}randomGaussian(t=0,r=1){return t+r*this.gaussian()}choice(t){if(t.length===0)throw new Error("Cannot pick from empty array");return t[Math.floor(this.rng()*t.length)]}shuffle(t){for(let r=t.length-1;r>0;r--){const n=Math.floor(this.rng()*(r+1));[t[r],t[n]]=[t[n],t[r]]}return t}}class BasalGeometry{curvedToCartesian(t,r){const n=this.getPointAtArcLength(t),s=this.getNormal(n);return n.add(s.scale(r))}}class StraightLineGeometry extends BasalGeometry{type="line";curvature_1=0;curvature_2=0;perimeter=1/0;projectPoint(t){return new Vector2(t.x,0)}getArcLength(t){return t.x}getPointAtArcLength(t){return new Vector2(t,0)}getNormal(t){return new Vector2(0,1)}}class CircularGeometry extends BasalGeometry{constructor(t,r){super(),this.curvature_1=t,this.curvature_2=r,this.radius=Math.abs(1/t),this.perimeter=2*Math.PI*this.radius,this.dir=-Math.sign(r),this.center=new Vector2(0,1/r)}type="circle";center;radius;perimeter;dir;projectPoint(t){const r=t.sub(this.center);return this.center.add(r.setMag(this.radius))}getArcLength(t){const r=t.sub(this.center);return Math.atan2(this.dir*r.x,this.dir*r.y)*this.radius}getPointAtArcLength(t){const r=t/this.radius;return new Vector2(this.center.x+this.dir*this.radius*Math.cos(r),this.center.y+this.dir*this.radius*Math.sin(r))}getNormal(t){return this.center.sub(t).setMag(Math.sign(this.curvature_2))}}class EllipticalGeometry extends BasalGeometry{constructor(t,r,n=360){super(),this.curvature_1=t,this.curvature_2=r,this.a=Math.abs(1/t),this.b=Math.abs(1/r),this.dir=-Math.sign(r),this.center=new Vector2(0,1/r),this.numPoints=n,this.points=this.discretizeCurve(),this.perimeter=this.points[this.points.length-1].arcLength}type="ellipse";center;a;b;dir;perimeter;points;numPoints;discretizeCurve(){const t=[];let r=0;for(let n=0;n<=this.numPoints;n++){const s=n/this.numPoints*2*Math.PI,o=this.center.x+this.dir*this.a*Math.cos(s),i=this.center.y+this.dir*this.b*Math.sin(s),c=new Vector2(o,i);if(n>0){const f=t[n-1].position,p=c.dist(f);r+=p}const a=c.sub(this.center).scale(this.dir),u=2*a.x/(this.a*this.a),l=2*a.y/(this.b*this.b),h=new Vector2(u,l).setMag(Math.sign(this.curvature_2));t.push({position:c,arcLength:r,theta:s,normal:h})}return t}findBracket(t,r){let n=0,s=this.points.length-1;for(;s-n>1;){const o=Math.floor((n+s)/2);r(this.points[o])<t?n=o:s=o}return[n,s]}interpolate(t,r,n,s){const o=s(t),i=s(r),c=(n-o)/(i-o);return{position:t.position.lerp(r.position,c),arcLength:t.arcLength+c*(r.arcLength-t.arcLength),theta:t.theta+c*(r.theta-t.theta),normal:t.normal.lerp(r.normal,c).normalize()}}projectPoint(t){let r=1/0,n=0;for(let p=0;p<this.points.length;p++){const m=t.distSq(this.points[p].position);m<r&&(r=m,n=p)}const s=n===0?this.points.length-1:n-1,o=n===this.points.length-1?0:n+1,i=this.points[n].position,c=this.points[s].position,a=this.points[o].position,u=this.projectOntoSegment(t,c,i),l=t.distSq(u),h=this.projectOntoSegment(t,i,a),f=t.distSq(h);return l<f?u:h}projectOntoSegment(t,r,n){const s=n.sub(r),o=t.sub(r),i=s.magSq();if(i<1e-10)return r;const c=Math.max(0,Math.min(1,o.dot(s)/i));return r.add(s.scale(c))}getArcLength(t){const r=this.projectPoint(t);let n=1/0,s=0;for(let o=0;o<this.points.length;o++){const i=r.distSq(this.points[o].position);i<n&&(n=i,s=o)}return this.points[s].arcLength}getPointAtArcLength(t){const r=(t%this.perimeter+this.perimeter)%this.perimeter,[n,s]=this.findBracket(r,i=>i.arcLength);return this.interpolate(this.points[n],this.points[s],r,i=>i.arcLength).position}getNormal(t){let r=1/0,n=0;for(let s=0;s<this.points.length;s++){const o=t.distSq(this.points[s].position);o<r&&(r=o,n=s)}return this.points[n].normal}}function createBasalGeometry(e,t,r=360){return e===0&&t===0?new StraightLineGeometry:Math.abs(e-t)<1e-10?new CircularGeometry(e,t):new EllipticalGeometry(e,t,r)}var CellPhase=(e=>(e[e.G1=0]="G1",e[e.G2=1]="G2",e[e.Mitosis=2]="Mitosis",e[e.Division=3]="Division",e))(CellPhase||{});function createInitialEHTState(){return{cells:[],ap_links:[],ba_links:[],t:0,step_count:0,basalGeometry:new StraightLineGeometry}}const boundaryTypeSchema=_enum(["periodic","box","none"]),toyGeneralSchema=object({N:number().int().positive(),soft_radius:number().positive(),repulsion_strength:number().nonnegative(),running_speed:number().nonnegative(),tumble_speed:number().nonnegative(),running_duration:number().positive(),tumbling_duration:number().positive(),tumbling_period:number().positive(),boundary_type:boundaryTypeSchema,domain_size:tuple([number().positive(),number().positive()]),t_end:number().positive(),dt:number().positive(),random_seed:number().int(),mu:number().positive(),n_substeps:number().int().positive(),N_max:number().int().positive(),w_screen:number().positive(),h_screen:number().positive()}),metadataSchema=object({model:literal("Toy"),version:string()}),toyParamsSchema=object({metadata:metadataSchema,general:toyGeneralSchema}),DEFAULT_TOY_GENERAL={N:20,soft_radius:5,repulsion_strength:10,running_speed:2,tumble_speed:.5,running_duration:5,tumbling_duration:2,tumbling_period:.5,boundary_type:"box",domain_size:[100,100],t_end:60,dt:.1,random_seed:42,mu:1,n_substeps:1,w_screen:100,h_screen:100},DEFAULT_TOY_PARAMS={metadata:{model:"Toy",version:"1.0.0"},general:DEFAULT_TOY_GENERAL};function projectOntoSegment(e,t,r){const n=r.sub(t),s=e.sub(t),o=n.magSq();if(o<1e-10)return t;const i=Math.max(0,Math.min(1,s.dot(n)/o));return t.add(n.scale(i))}function projectOntoApicalStrip(e,t){const r=t.cells;if(r.length===0)return e;if(r.length===1)return Vector2.from(r[0].A);let n=Vector2.from(r[0].A),s=e.distSq(n);for(let o=0;o<r.length-1;o++){const i=Vector2.from(r[o].A),c=Vector2.from(r[o+1].A),a=projectOntoSegment(e,i,c),u=e.distSq(a);u<s&&(s=u,n=a)}if(r.length>2){const o=Vector2.from(r[r.length-1].A),i=Vector2.from(r[0].A),c=projectOntoSegment(e,o,i);e.distSq(c)<s&&(n=c)}return n}function projectOntoBasalCurve(e,t){return t.basalGeometry.projectPoint(e)}function computeCellMetrics(e,t){const r=e.cells,n=[],o=10*Math.min(...Object.values(t.cell_types).map(i=>i.R_soft));for(const i of r){const c=Vector2.from(i.pos),a=Vector2.from(i.A),u=Vector2.from(i.B),l=projectOntoApicalStrip(c,e),h=projectOntoBasalCurve(c,e),f=a.dist(c),p=u.dist(c),m=c.dist(l),_=c.dist(h),w=l.sub(h),g=w.magSq();let b=.5;g>1e-10&&(b=c.sub(h).dot(w)/g);const $=b<0,T=b>1;n.push({cell:i,X:c,A:a,B:u,a:l,b:h,AX:f,BX:p,ax:m,bx:_,x:b,below_basal:$,above_apical:T,below_neighbours:!1})}for(let i=0;i<n.length;i++){const c=n[i];let a=!0;for(let u=0;u<n.length;u++){if(i===u)continue;const l=n[u];if(c.X.dist(l.X)<=o&&l.bx<=c.bx){a=!1;break}}c.below_neighbours=a&&n.length>1}return n}function generateCellGroups(e){const t=Object.keys(e.cell_types),r=[];r.push("all");for(const n of t)r.push(n);for(let n=0;n<t.length;n++)for(let s=n+1;s<t.length;s++)r.push(`${t[n]}+${t[s]}`);return r}function filterByGroup(e,t){if(t==="all")return e;if(t.includes("+")){const r=t.split("+");return e.filter(n=>r.includes(n.cell.typeIndex))}return e.filter(r=>r.cell.typeIndex===t)}function aggregateMetrics(e){if(e.length===0)return{ab_distance:0,AX:0,BX:0,ax:0,bx:0,x:0,below_basal:0,above_apical:0,below_neighbours:0};const t=n=>n.reduce((s,o)=>s+o,0)/n.length,r=n=>n.filter(s=>s).length/n.length;return{ab_distance:t(e.map(n=>n.A.dist(n.B))),AX:t(e.map(n=>n.AX)),BX:t(e.map(n=>n.BX)),ax:t(e.map(n=>n.ax)),bx:t(e.map(n=>n.bx)),x:t(e.map(n=>n.x)),below_basal:r(e.map(n=>n.below_basal)),above_apical:r(e.map(n=>n.above_apical)),below_neighbours:r(e.map(n=>n.below_neighbours))}}function computeEHTStatistics(e,t){const r={};if(!t){const n=e.cells.length>0?e.cells.reduce((s,o)=>s+Vector2.from(o.A).dist(Vector2.from(o.B)),0)/e.cells.length:0;return r.ab_distance_all=n,r}try{const n=computeCellMetrics(e,t),s=generateCellGroups(t);for(const o of s){const i=filterByGroup(n,o),c=aggregateMetrics(i);for(const[a,u]of Object.entries(c))r[`${a}_${o}`]=u}}catch(n){console.error("Failed to compute EHT statistics",n)}return r}function generateEHTStatistics(e){const t=[],r=generateCellGroups(e),n=[{id:"ab_distance",label:"AB Distance",description:"Apical-basal distance"},{id:"AX",label:"AX Distance",description:"Distance from A to X"},{id:"BX",label:"BX Distance",description:"Distance from B to X"},{id:"ax",label:"ax Distance",description:"Distance from X to apical projection"},{id:"bx",label:"bx Distance",description:"Distance from X to basal projection"},{id:"x",label:"x Position",description:"Position on basal-apical scale (0-1)"},{id:"below_basal",label:"Below Basal",description:"Fraction of cells below basal layer"},{id:"above_apical",label:"Above Apical",description:"Fraction of cells above apical layer"},{id:"below_neighbours",label:"Below Neighbours",description:"Fraction of cells below all neighbours"}];for(const s of r)for(const o of n)t.push({id:`${o.id}_${s}`,label:`${o.label} (${s})`,description:`${o.description} for ${s} cells`,compute:i=>computeEHTStatistics(i,e)[`${o.id}_${s}`]||0});return t}generateEHTStatistics({metadata:{},general:{},cell_prop:{},cell_types:{control:{}}});function mean(e){return e.length===0?0:e.reduce((t,r)=>t+r,0)/e.length}const TOY_STATISTICS=[{id:"n_cells",label:"Cell Count",description:"Total number of cells",compute:e=>e.cells.length},{id:"mean_speed",label:"Mean Speed",description:"Average speed of all cells (microns/min) estimated from polarity",compute:e=>e.cells.filter(t=>t.phase==="running").length/(e.cells.length||1)},{id:"avg_x",label:"Avg X Position",description:"Average X position of all cells",compute:e=>mean(e.cells.map(t=>t.position.x))},{id:"avg_y",label:"Avg Y Position",description:"Average Y position of all cells",compute:e=>mean(e.cells.map(t=>t.position.y))}];function computeToyStatistics(e){const t={};for(const r of TOY_STATISTICS)t[r.id]=r.compute(e);return t}function generateEHTBatchParameters(e){const t=[];t.push({path:"general.t_end",label:"t_end (End time)"},{path:"general.dt",label:"dt (Time step)"},{path:"general.random_seed",label:"Random seed",isInteger:!0},{path:"general.w_init",label:"w_init (Initial width)"},{path:"general.h_init",label:"h_init (Initial height)"},{path:"general.mu",label:"mu (Friction)"},{path:"general.n_substeps",label:"n_substeps",isInteger:!0},{path:"general.alg_dt",label:"alg_dt (Algorithm dt)"},{path:"general.p_div_out",label:"p_div_out (Division probability)"},{path:"general.perimeter",label:"Perimeter"},{path:"general.aspect_ratio",label:"Aspect ratio"}),t.push({path:"cell_prop.apical_junction_init",label:"Apical junction init"},{path:"cell_prop.max_basal_junction_dist",label:"Max basal junction dist"},{path:"cell_prop.basal_daming_ratio",label:"Basal damping ratio"},{path:"cell_prop.basal_membrane_repulsion",label:"Basal membrane repulsion"},{path:"cell_prop.cytos_init",label:"Cytos init"},{path:"cell_prop.diffusion",label:"Diffusion"});for(const[r,n]of Object.entries(e.cell_types)){const s=`cell_types.${r}`,o=r;t.push({path:`${s}.N_init`,label:`${o}: N_init`,isInteger:!0},{path:`${s}.location`,label:`${o}: location`},{path:`${s}.R_hard`,label:`${o}: R_hard`},{path:`${s}.R_hard_div`,label:`${o}: R_hard_div`},{path:`${s}.R_soft`,label:`${o}: R_soft`},{path:`${s}.dur_G2`,label:`${o}: dur_G2`},{path:`${s}.dur_mitosis`,label:`${o}: dur_mitosis`},{path:`${s}.k_apical_junction`,label:`${o}: k_apical_junction`},{path:`${s}.k_cytos`,label:`${o}: k_cytos`},{path:`${s}.max_cytoskeleton_length`,label:`${o}: max_cytos_length`},{path:`${s}.run`,label:`${o}: run probability`},{path:`${s}.running_speed`,label:`${o}: running_speed`},{path:`${s}.running_mode`,label:`${o}: running_mode`,isInteger:!0},{path:`${s}.stiffness_apical_apical`,label:`${o}: stiff_apical_apical`},{path:`${s}.stiffness_apical_apical_div`,label:`${o}: stiff_apical_apical_div`},{path:`${s}.stiffness_nuclei_apical`,label:`${o}: stiff_nuclei_apical`},{path:`${s}.stiffness_nuclei_basal`,label:`${o}: stiff_nuclei_basal`},{path:`${s}.stiffness_repulsion`,label:`${o}: stiff_repulsion`},{path:`${s}.stiffness_straightness`,label:`${o}: stiff_straightness`},{path:`${s}.lifespan_start`,label:`${o}: lifespan start`},{path:`${s}.lifespan_end`,label:`${o}: lifespan end`},{path:`${s}.INM`,label:`${o}: INM probability`},{path:`${s}.events.time_A_start`,label:`${o}: time_A start`},{path:`${s}.events.time_A_end`,label:`${o}: time_A end`},{path:`${s}.events.time_B_start`,label:`${o}: time_B start`},{path:`${s}.events.time_B_end`,label:`${o}: time_B end`},{path:`${s}.events.time_S_start`,label:`${o}: time_S start`},{path:`${s}.events.time_S_end`,label:`${o}: time_S end`},{path:`${s}.events.time_P_start`,label:`${o}: time_P start`},{path:`${s}.events.time_P_end`,label:`${o}: time_P end`})}return t}const EHT_BATCH_PARAMETERS=[{path:"general.perimeter",label:"Perimeter"},{path:"general.aspect_ratio",label:"Aspect ratio"},{path:"general.random_seed",label:"Random seed",isInteger:!0},{path:"general.t_end",label:"t_end (End time)"},{path:"cell_prop.apical_junction_init",label:"Apical junction init"},{path:"cell_prop.max_basal_junction_dist",label:"Max basal junction dist"},{path:"cell_prop.diffusion",label:"Diffusion"}];function ramanujanPerimeter(e,t){if(e===0&&t===0)return 0;if(e===t)return 2*Math.PI*e;const r=e+t,n=e-t,s=n*n/(r*r);return Math.PI*r*(1+3*s/(10+Math.sqrt(4-3*s)))}function computeEllipseFromPerimeter(e,t){if(t===0)return{a:1/0,b:1/0,curvature_1:0,curvature_2:0};const r=Math.sign(t),n=Math.abs(t),s=1,o=n,i=ramanujanPerimeter(s,o),c=e/i,a=c*s,u=c*o,l=a>0?r/a:0,h=u>0?r/u:0;return{a,b:u,curvature_1:l,curvature_2:h}}function createCell(e,t,r,n,s,o,i){const{basalPoint:c,apicalPoint:a,nucleusPosition:u}=n,l=e.general.h_init,h=r.random(s.lifespan_start,s.lifespan_end),f=t.cells.length>0?Math.max(...t.cells.map(p=>p.id))+1:0;if(i===void 0){const p=t.t-r.random(0,h);let m=r.random(s.events.time_A_start,s.events.time_A_end),_=r.random(s.events.time_B_start,s.events.time_B_end),w=r.random(s.events.time_S_start,s.events.time_S_end);const g=r.random()<=s.run?_:1/0;return s.hetero&&(r.random()>.7&&(m=1/0),r.random()>.7&&(_=1/0),r.random()>.7&&(w=1/0)),{id:f,typeIndex:o,pos:u.toObject(),A:a.toObject(),B:c.toObject(),R_soft:s.R_soft,R_hard:s.R_hard,eta_A:l/2,eta_B:l/2,has_A:!0,has_B:!0,phase:CellPhase.G1,birth_time:p,division_time:p+h,is_running:!1,running_mode:s.running_mode,has_inm:r.random()<=s.INM,time_A:m,time_B:_,time_S:w,time_P:g,stiffness_apical_apical:s.stiffness_apical_apical,stiffness_straightness:s.stiffness_straightness,stiffness_nuclei_apical:s.stiffness_nuclei_apical,stiffness_nuclei_basal:s.stiffness_nuclei_basal}}else return{id:f,typeIndex:o,pos:u.toObject(),A:a.toObject(),B:c.toObject(),R_soft:s.R_soft,R_hard:s.R_hard,eta_A:i.eta_A,eta_B:i.eta_B,has_A:i.has_A,has_B:i.has_B,phase:CellPhase.G1,birth_time:t.t,division_time:t.t+h,is_running:i.is_running,running_mode:i.running_mode,has_inm:i.has_inm,time_A:i.time_A,time_B:i.time_B,time_S:i.time_S,time_P:i.time_P,stiffness_apical_apical:s.stiffness_apical_apical,stiffness_straightness:i.stiffness_straightness,stiffness_nuclei_apical:i.stiffness_nuclei_apical,stiffness_nuclei_basal:i.stiffness_nuclei_basal}}function getCellType(e,t){return e.cell_types[t.typeIndex]||e.cell_types.control}function updateCellPhase(e,t,r){const n=e.division_time,s=n-t.dur_G2-t.dur_mitosis,o=n-t.dur_mitosis;r<s?e.phase=CellPhase.G1:r<o?e.phase=CellPhase.G2:r<n?e.phase=CellPhase.Mitosis:e.phase=CellPhase.Division}function initializeEHTSimulation(e,t,r){const n=e.general,s=computeEllipseFromPerimeter(n.perimeter,n.aspect_ratio);t.geometry={curvature_1:s.curvature_1,curvature_2:s.curvature_2};const{curvature_1:o,curvature_2:i}=t.geometry;t.basalGeometry=createBasalGeometry(o,i,360);const c=Object.entries(e.cell_types),a=c.reduce((g,[,b])=>g+b.N_init,0),u=[];for(let g=0;g<a;g++)u.push([-1+2*g/a,""]);c.sort((g,b)=>{const $=g[1].location!==""?1:0;return(b[1].location!==""?1:0)-$});for(const[g,b]of c)if(b.location!==""){let $;b.location==="top"?$=1:b.location==="bottom"?$=0:($=parseFloat(b.location),(isNaN($)||$<-1||$>1)&&($=0)),u.sort((v,C)=>Math.min(Math.abs(v[0]-$),Math.abs(v[0]+2-$))-Math.min(Math.abs(C[0]-$),Math.abs(C[0]+2-$)));let T=0;for(let v=0;v<u.length&&T<b.N_init;v++)u[v][1]===""&&(u[v]=[u[v][0],g],T++)}u.sort((g,b)=>g[0]-b[0]);let l=0;for(let g=0;g<u.length;g++)if(u[g][1]==="")for(;l<c.length;){const[b,$]=c[l];if(u.filter(v=>v[1]===b).length<$.N_init){u[g]=[u[g][0],b];break}else l++}u.sort((g,b)=>g[0]-b[0]);const h=ramanujanPerimeter(Math.abs(1/o),Math.abs(1/i)),f=n.full_circle?h:n.w_init,p=n.h_init,m=n.aspect_ratio<0?-1:1,_=[],w=[];for(let g=0;g<a;g++){const b=u[g][0]*(f/2)+h/4,$=t.basalGeometry.getPointAtArcLength(b),T=t.basalGeometry.getNormal($).scale(m),v=$.add(T.scale(p)),C=r.random(p/3,2*p/3),x=$.add(T.scale(C));_.push({basalPoint:$,apicalPoint:v,nucleusPosition:x}),w.push(u[g][1])}t.cells=[];for(let g=0;g<_.length;g++){const b=w[g],$=e.cell_types[b];if(!$){console.warn("No cell type found for key",b);continue}const T=createCell(e,t,r,_[g],$,b);t.cells.push(T)}for(let g=0;g<t.cells.length-1;g++)t.ap_links.push({l:g,r:g+1,rl:e.cell_prop.apical_junction_init}),t.ba_links.push({l:g,r:g+1});if(n.full_circle&&t.cells.length>2){const g=t.cells.length-1;t.ap_links.push({l:g,r:0,rl:e.cell_prop.apical_junction_init}),t.ba_links.push({l:g,r:0})}}function zeroForces(){return{f:Vector2.zero(),fA:Vector2.zero(),fB:Vector2.zero()}}function calcRepulsionForces(e,t,r){const n=e.cells,s=n.length;for(let o=0;o<s;o++){const i=n[o],c=getCellType(t,i),a=Vector2.from(i.pos);for(let u=0;u<o;u++){const l=n[u];if(Math.abs(i.pos.x-l.pos.x)>=2)continue;const h=getCellType(t,l),p=Vector2.from(l.pos).sub(a),m=p.mag(),_=i.R_soft+l.R_soft,w=c.stiffness_repulsion+h.stiffness_repulsion;if(m<_&&m>_/20){const g=-w*(_-m)/(m*_*_),b=p.scale(g);r[o].f=r[o].f.add(b),r[u].f=r[u].f.sub(b)}}}}function calcApicalNucleiForces(e,t,r){const n=e.cells;for(let s=0;s<n.length;s++){const o=n[s],i=Vector2.from(o.pos),c=Vector2.from(o.A),a=i.sub(c),u=a.mag();if(u>0){const l=o.eta_A+o.R_soft,f=2*o.stiffness_nuclei_apical*(u-l)/(u*l*l),p=a.scale(f);r[s].f=r[s].f.sub(p),r[s].fA=r[s].fA.add(p)}}}function calcBasalNucleiForces(e,t,r){const n=e.cells;for(let s=0;s<n.length;s++){const o=n[s],i=Vector2.from(o.pos),c=Vector2.from(o.B),a=i.sub(c),u=a.mag();if(u>0){const l=o.eta_B+o.R_soft,f=2*o.stiffness_nuclei_basal*(u-l)/(u*l*l),p=a.scale(f);r[s].f=r[s].f.sub(p),r[s].fB=r[s].fB.add(p)}}}function calcStraightnessForces(e,t,r){const n=e.cells;for(let s=0;s<n.length;s++){const o=n[s],i=Vector2.from(o.pos),c=Vector2.from(o.A),a=Vector2.from(o.B),u=i.sub(c),l=i.sub(a),h=u.mag(),f=l.mag(),p=u.dot(l);if(p!==0&&h>0&&f>0){const m=o.stiffness_straightness/(h*f),_=l.scale(-1).add(u.scale(p/(h*h))).scale(m),w=u.scale(-1).add(l.scale(p/(f*f))).scale(m);r[s].fA=r[s].fA.sub(_),r[s].f=r[s].f.add(_),r[s].f=r[s].f.add(w),r[s].fB=r[s].fB.sub(w)}}}function calcApicalJunctionForces(e,t,r){const n=e.cells,s=e.ap_links;for(const o of s){const i=n[o.l],c=n[o.r],a=Vector2.from(i.A),u=Vector2.from(c.A),l=a.sub(u),h=l.mag();if(h>1e-6){const f=.5*(i.stiffness_apical_apical+c.stiffness_apical_apical),p=l.scale(.25*f*(h-o.rl)/h);r[o.l].fA=r[o.l].fA.sub(p),r[o.r].fA=r[o.r].fA.add(p)}}}function calcAllForces(e,t){const r=e.cells.map(()=>zeroForces());return calcRepulsionForces(e,t,r),calcApicalNucleiForces(e,t,r),calcBasalNucleiForces(e,t,r),calcStraightnessForces(e,t,r),calcApicalJunctionForces(e,t,r),r}function projectHardSphereConstraints(e,t){const r=e.cells,n=r.length;for(let s=0;s<n;s++){const o=r[s];for(let i=0;i<s;i++){const c=r[i];if(Math.abs(o.pos.x-c.pos.x)>=1.5)continue;const a=o.R_hard+c.R_hard,u=Vector2.from(o.pos),l=Vector2.from(c.pos),h=u.dist(l)-a;if(h<0&&h!==-a){const p=u.sub(l).scale(.5*h/(h+a));o.pos.x-=p.x,o.pos.y-=p.y,c.pos.x+=p.x,c.pos.y+=p.y}}}}function projectBasalOrderingConstraints(e,t){const r=e.cells,n=e.ba_links,s=e.geometry?.curvature_1??0,o=e.geometry?.curvature_2??0;for(const i of n){const c=r[i.l],a=r[i.r],u=Vector2.from(c.B),l=Vector2.from(a.B);e.basalGeometry.getArcLength(u),e.basalGeometry.getArcLength(l),t.general.full_circle}}function projectMaxBasalDistanceConstraints(e,t){const r=e.cells,n=e.ba_links,s=t.cell_prop.max_basal_junction_dist;for(const o of n){const i=r[o.l],c=r[o.r],a=Vector2.from(i.B),u=Vector2.from(c.B),l=a.dist(u);if(l>s){const h=l-s,p=u.sub(a).normalize().scale(h/2);i.B.x+=p.x,i.B.y+=p.y,c.B.x-=p.x,c.B.y-=p.y}}}function projectBasalCurveConstraints(e,t){const r=e.cells;for(const n of r){const s=Vector2.from(n.B),o=e.basalGeometry.projectPoint(s);n.B.x=o.x,n.B.y=o.y}}function applyAllConstraints(e,t){projectHardSphereConstraints(e),projectBasalOrderingConstraints(e,t),projectMaxBasalDistanceConstraints(e,t),projectBasalCurveConstraints(e)}function processLoseApicalAdhesion(e,t){const r=e.cells[t];r.has_A=!1,r.stiffness_nuclei_apical*=.1;const n=[];let s={l:0,r:0,rl:0};for(let o=0;o<e.ap_links.length;o++){const i=e.ap_links[o];i.l===t&&(n.push(o),s.r=i.r),i.r===t&&(n.push(o),s.l=i.l)}if(n.length===1)e.ap_links.splice(n[0],1);else if(n.length===2){n.sort((c,a)=>a-c),e.ap_links.splice(n[0],1),e.ap_links.splice(n[1],1);const o=e.cells[s.l],i=e.cells[s.r];s.rl=Vector2.from(o.A).dist(Vector2.from(i.A)),e.ap_links.push(s)}}function processLoseBasalAdhesion(e,t){const r=e.cells[t];r.has_B=!1,r.stiffness_nuclei_basal*=.1;const n=[];let s={l:0,r:0};for(let o=0;o<e.ba_links.length;o++){const i=e.ba_links[o];i.l===t&&(n.push(o),s.r=i.r),i.r===t&&(n.push(o),s.l=i.l)}n.length===1?e.ba_links.splice(n[0],1):n.length===2&&(n.sort((o,i)=>i-o),e.ba_links.splice(n[0],1),e.ba_links.splice(n[1],1),e.ba_links.push(s))}function processLoseStraightness(e,t){const r=e.cells[t];r.stiffness_straightness=1}function processStartRunning(e,t){const r=e.cells[t];r.running_mode=3}function updateRunningState(e){e.is_running=!e.has_B&&e.B.y>-2&&(e.running_mode>=3||e.B.y<0&&e.running_mode>=1)}function processEMTEvents(e,t,r){const n=e.t;for(let s=0;s<e.cells.length;s++){const o=e.cells[s];n<=o.time_A&&n+r>o.time_A&&processLoseApicalAdhesion(e,s),n<=o.time_B&&n+r>o.time_B&&processLoseBasalAdhesion(e,s),n<=o.time_S&&n+r>o.time_S&&processLoseStraightness(e,s),(o.time_P>o.time_B&&n<=o.time_P&&n+r>o.time_P||o.time_P<=o.time_B&&n<=o.time_B&&n+r>o.time_B)&&processStartRunning(e,s),updateRunningState(o)}}function processCellDivisions(e,t,r){let n=0;for(let s=0;s<e.cells.length;s++){const o=e.cells[s];if(o.phase!==CellPhase.Division)continue;const i=getCellType(t,o),c={basalPoint:Vector2.from(o.B),apicalPoint:Vector2.from(o.A),nucleusPosition:Vector2.from(o.pos)};if(o.typeIndex==="emt"){const a=createCell(t,e,r,c,i,o.typeIndex,o);a.id=o.id,e.cells[s]=a}else if(r.random()<t.general.p_div_out){const u=createCell(t,e,r,c,i,o.typeIndex,o);u.id=o.id,e.cells[s]=u}else{n++;const u=createCell(t,e,r,c,i,o.typeIndex,o);u.id=o.id,e.cells[s]=u;const l=createCell(t,e,r,c,i,o.typeIndex,u),h=.05*u.R_soft;u.pos.x-=h,l.pos.x+=h,u.A.x-=h,l.A.x+=h,u.B.x-=h,l.B.x+=h;const f=e.cells.length;e.cells.push(l),updateApicalLinksAfterDivision(e,t,s,f),updateBasalLinksAfterDivision(e,t,s,f)}}return n}function updateApicalLinksAfterDivision(e,t,r,n){for(const s of e.ap_links)s.l===r&&(s.l=n);e.ap_links.push({l:r,r:n,rl:t.cell_prop.apical_junction_init})}function updateBasalLinksAfterDivision(e,t,r,n){for(const s of e.ba_links)s.l===r&&(s.l=n);e.ba_links.push({l:r,r:n})}function updateCytoskeleton(e,t,r){for(const n of e.cells){const s=getCellType(t,n),o=Vector2.from(n.pos),i=Vector2.from(n.A),c=Vector2.from(n.B),a=o.dist(i),u=o.dist(c);let l=0,h=0;switch(n.phase+(n.has_inm?0:10)){case CellPhase.G2:case CellPhase.Mitosis:const m=i.dist(c);l=0,h=Math.max(0,m-2*n.R_soft);break;default:l=Math.max(0,a-n.R_soft),h=Math.max(0,u-n.R_soft)}n.phase===CellPhase.G2&&(n.stiffness_apical_apical=s.stiffness_apical_apical_div),n.phase===CellPhase.Mitosis&&(n.R_hard=s.R_hard_div),n.has_A||(l=0),n.has_B||(h=0);const p=Math.exp(-r*s.k_cytos);if(n.eta_A=p*(n.eta_A-l)+l,n.has_B?n.eta_B=p*(n.eta_B-h)+h:n.running_mode>=2&&n.B.y>0?n.eta_B=Vector2.from(n.B).dist(o)-n.R_soft:n.eta_B=p*(n.eta_B-h)+h,!n.is_running||n.has_B){const m=s.max_cytoskeleton_length,_=n.eta_A+n.eta_B-m;if(m>0&&_>1){const w=n.eta_A+n.eta_B,g=n.eta_A*m/w,b=n.eta_B*m/w;n.eta_A=p*(n.eta_A-g)+g,n.eta_B=p*(n.eta_B-b)+b}}}}function updateApicalJunctions(e,t,r){for(const n of e.ap_links){const s=e.cells[n.l],o=e.cells[n.r],i=getCellType(t,s),c=getCellType(t,o),a=.5*i.k_apical_junction+.5*c.k_apical_junction;n.rl=n.rl*Math.exp(-r*a)}}function integrateForces(e,t,r,n,s){const o=t.general.mu,i=t.cell_prop.diffusion,c=Math.sqrt(s);for(let a=0;a<e.cells.length;a++){const u=e.cells[a],l=getCellType(t,u),h=r[a];if(u.pos.x+=c*i*n.gaussian(),u.pos.y+=c*i*n.gaussian(),u.pos.x+=s*h.f.x/o,u.pos.y+=s*h.f.y/o,u.A.x+=s*h.fA.x/o,u.A.y+=s*h.fA.y/o,u.is_running){const f=Vector2.from(u.B),p=Vector2.from(u.pos);if(f.dist(p)<5){const m=f.sub(p).normalize();u.B.x+=s*m.x*l.running_speed,u.B.y+=s*m.y*l.running_speed}}else u.B.x+=s*h.fB.x/o,u.B.y+=s*h.fB.y/o,u.has_B||(u.B.y+=s*h.fB.y/o)}}function performTimestep(e,t,r){const n=t.general,s=n.dt;for(const c of e.cells){const a=getCellType(t,c);updateCellPhase(c,a,e.t)}const o=processCellDivisions(e,t,r);processEMTEvents(e,t,s),updateCytoskeleton(e,t,s),updateApicalJunctions(e,t,s);const i=s/n.n_substeps;for(let c=0;c<n.n_substeps;c++){e.t+=i;const a=calcAllForces(e,t);integrateForces(e,t,a,r,i),applyAllConstraints(e,t)}return e.step_count++,o}function getNeighborIds(e,t,r){const n=[];for(const s of t)s.l===e?n.push(s.r):s.r===e&&n.push(s.l);return n.map(s=>r[s]?.id??s).join(";")}function getSnapshot(e){const t=[];for(let r=0;r<e.cells.length;r++){const n=e.cells[r];t.push({id:n.id,typeIndex:n.typeIndex,t:e.t,step_count:e.step_count,pos_x:n.pos.x,pos_y:n.pos.y,A_x:n.A.x,A_y:n.A.y,B_x:n.B.x,B_y:n.B.y,has_A:n.has_A,has_B:n.has_B,phase:n.phase,age:e.t-n.birth_time,is_running:n.is_running,running_mode:n.running_mode,has_inm:n.has_inm,eta_A:n.eta_A,eta_B:n.eta_B,R_soft:n.R_soft,R_hard:n.R_hard,time_A:n.time_A,time_B:n.time_B,time_S:n.time_S,time_P:n.time_P,apical_neighbors:getNeighborIds(r,e.ap_links,e.cells),basal_neighbors:getNeighborIds(r,e.ba_links,e.cells),curvature_1:e.geometry?.curvature_1??0,curvature_2:e.geometry?.curvature_2??0})}return t}function loadSnapshot(e,t){if(e.length===0)return{cells:[],ap_links:[],ba_links:[],t:0,step_count:0,basalGeometry:createBasalGeometry(0,0,360)};const r=e[0],n=Number(r.t),s=Number(r.step_count),o=Number(r.curvature_1),i=Number(r.curvature_2),c={cells:[],ap_links:[],ba_links:[],t:n,step_count:s,geometry:{curvature_1:o,curvature_2:i},basalGeometry:createBasalGeometry(o,i,360)},a=new Map;for(let u=0;u<e.length;u++){const l=e[u],h=Number(l.id);a.set(h,u);const f={id:h,typeIndex:String(l.typeIndex),pos:{x:Number(l.pos_x),y:Number(l.pos_y)},A:{x:Number(l.A_x),y:Number(l.A_y)},B:{x:Number(l.B_x),y:Number(l.B_y)},has_A:!!l.has_A,has_B:!!l.has_B,phase:Number(l.phase),birth_time:n-Number(l.age),division_time:0,is_running:!!l.is_running,running_mode:Number(l.running_mode),has_inm:!!l.has_inm,eta_A:Number(l.eta_A),eta_B:Number(l.eta_B),R_soft:Number(l.R_soft),R_hard:Number(l.R_hard),time_A:Number(l.time_A),time_B:Number(l.time_B),time_S:Number(l.time_S),time_P:Number(l.time_P),stiffness_apical_apical:1,stiffness_straightness:Number(l.time_S)<n?1:100,stiffness_nuclei_apical:l.has_A?1:.1,stiffness_nuclei_basal:l.has_B?1:.1},p=t.cell_types[f.typeIndex]||t.cell_types.control;f.stiffness_apical_apical=p.stiffness_apical_apical,l.has_A?f.stiffness_nuclei_apical=p.stiffness_nuclei_apical:f.stiffness_nuclei_apical=p.stiffness_nuclei_apical*.1,l.has_B?f.stiffness_nuclei_basal=p.stiffness_nuclei_basal:f.stiffness_nuclei_basal=p.stiffness_nuclei_basal*.1,f.time_S&&n>f.time_S?f.stiffness_straightness=1:f.stiffness_straightness=p.stiffness_straightness,f.division_time=f.birth_time+(p.lifespan_end+p.lifespan_start)/2,c.cells.push(f)}for(let u=0;u<e.length;u++){const l=e[u],h=u,f=String(l.apical_neighbors||"").split(";").filter(m=>m!=="");for(const m of f){const _=Number(m),w=a.get(_);if(w!==void 0&&w>h){c.ap_links.push({l:h,r:w,rl:t.cell_prop.apical_junction_init});const g=c.cells[h],b=c.cells[w],$=Math.sqrt(Math.pow(g.A.x-b.A.x,2)+Math.pow(g.A.y-b.A.y,2));c.ap_links[c.ap_links.length-1].rl=$}}const p=String(l.basal_neighbors||"").split(";").filter(m=>m!=="");for(const m of p){const _=Number(m),w=a.get(_);w!==void 0&&w>h&&c.ba_links.push({l:h,r:w})}}return c}console.log("[Models Worker] Loading worker-safe index");const TOY_BATCH_PARAMETERS=[{path:"general.N",label:"Number of cells",isInteger:!0},{path:"general.soft_radius",label:"Soft radius"},{path:"general.repulsion_strength",label:"Repulsion strength"},{path:"general.running_speed",label:"Running speed"},{path:"general.tumble_speed",label:"Tumble speed"},{path:"general.running_duration",label:"Running duration"},{path:"general.tumbling_duration",label:"Tumbling duration"},{path:"general.tumbling_period",label:"Tumbling period"},{path:"general.random_seed",label:"Random seed",isInteger:!0},{path:"general.t_end",label:"End time"}],EHTModelWorker={id:"EHT",name:"Epithelial-to-Hematopoietic Transition",version:"1.0.0",description:"Simulates cell mechanics, division, and EMT events in curved epithelial tissue.",defaultParams:DEFAULT_EHT_PARAMS,validateParams(e){return ehtParamsSchema.parse(e)},init:(e,t)=>{const r=t??e.general.random_seed,n=new SeededRandom(r),s=createInitialEHTState();return initializeEHTSimulation(e,s,n),s},step:(e,t,r)=>{const n=r.general.random_seed+"_"+e.step_count,s=new SeededRandom(n);return performTimestep(e,r,s),e},getSnapshot:e=>getSnapshot(e),loadSnapshot:(e,t)=>loadSnapshot(e,t),computeStats:(e,t)=>computeEHTStatistics(e,t),statistics:generateEHTStatistics(DEFAULT_EHT_PARAMS),generateStatistics:e=>generateEHTStatistics(e),generateBatchParameters:e=>generateEHTBatchParameters(e),batchParameters:EHT_BATCH_PARAMETERS,renderer:null,ui:null},ToyModelWorker={id:"Toy",name:"Run & Tumble (Toy)",version:"1.0.0",description:"Simple run-and-tumble model for demonstration purposes.",defaultParams:DEFAULT_TOY_PARAMS,validateParams(e){return toyParamsSchema.parse(e)},init:(e,t)=>{const r=t??e.general.random_seed,n=new SeededRandom(r),{N:s,domain_size:o}=e.general,[i,c]=o,a=[];for(let u=0;u<s;u++){const l=n.random(i),h=n.random(c),f=n.random(2*Math.PI),p=n.random()>.5?"running":"tumbling";a.push({id:u,position:new Vector2(l,h),prevPosition:new Vector2(l,h),polarity:new Vector2(Math.cos(f),Math.sin(f)),phase:p,phaseTime:0,timeSinceLastTumble:0})}return{time:0,cells:a}},step:(e,t,r)=>{const{soft_radius:n,repulsion_strength:s,running_speed:o,tumble_speed:i,mu:c,boundary_type:a,domain_size:u,running_duration:l,tumbling_duration:h,tumbling_period:f}=r.general,[p,m]=u,_=e.cells;for(const g of _)if(g.phaseTime+=t,g.phase==="running"){if(g.phaseTime>=l){g.phase="tumbling",g.phaseTime=0,g.timeSinceLastTumble=0;const b=Math.random()*2*Math.PI;g.polarity=new Vector2(Math.cos(b),Math.sin(b))}}else{if(g.timeSinceLastTumble+=t,g.timeSinceLastTumble>=f){const b=Math.random()*2*Math.PI;g.polarity=new Vector2(Math.cos(b),Math.sin(b)),g.timeSinceLastTumble=0}g.phaseTime>=h&&(g.phase="running",g.phaseTime=0)}const w=_.map(()=>Vector2.zero());for(let g=0;g<_.length;g++)for(let b=g+1;b<_.length;b++){const $=_[g],T=_[b],v=$.position.x-T.position.x,C=$.position.y-T.position.y,x=v*v+C*C,R=n;if(x<R*R&&x>0){const P=Math.sqrt(x),E=R-P,I=s*E*v/P,Z=s*E*C/P,d=new Vector2(I,Z);w[g]=w[g].add(d),w[b]=w[b].sub(d)}}for(let g=0;g<_.length;g++){const b=_[g],$=b.phase==="running"?o:i,T=b.polarity.mult($*c);w[g]=w[g].add(T)}for(let g=0;g<_.length;g++){const b=_[g],$=w[g];b.prevPosition=b.position;const T=$.x*t/c,v=$.y*t/c;b.position=new Vector2(b.position.x+T,b.position.y+v),a==="periodic"?b.position=new Vector2((b.position.x%p+p)%p,(b.position.y%m+m)%m):a==="box"&&(b.position=new Vector2(Math.max(0,Math.min(p,b.position.x)),Math.max(0,Math.min(m,b.position.y))))}return e.time+=t,e},getSnapshot:e=>e.cells.map(t=>({id:t.id,t:e.time,pos_x:t.position.x,pos_y:t.position.y,phase:t.phase,pol_x:t.polarity.x,pol_y:t.polarity.y})),loadSnapshot:(e,t)=>{if(e.length===0)return{time:0,cells:[]};const r=Number(e[0].t),n=e.map(s=>({id:Number(s.id),position:new Vector2(Number(s.pos_x),Number(s.pos_y)),prevPosition:new Vector2(Number(s.pos_x),Number(s.pos_y)),polarity:new Vector2(Number(s.pol_x),Number(s.pol_y)),phase:s.phase,phaseTime:0,timeSinceLastTumble:0}));return{time:r,cells:n}},computeStats:(e,t)=>computeToyStatistics(e),statistics:TOY_STATISTICS,generateStatistics:e=>TOY_STATISTICS,generateBatchParameters:e=>TOY_BATCH_PARAMETERS,batchParameters:TOY_BATCH_PARAMETERS,renderer:null,ui:null};modelRegistry.register(EHTModelWorker),modelRegistry.register(ToyModelWorker),modelRegistry.setDefault(EHTModelWorker.id);function runSimulation(e){const{modelName:t,baseParams:r,overrides:n,seed:s,timeSamples:o,runIndex:i}=e,c=modelRegistry.get(t);if(!c)throw new Error(`Model "${t}" not found in worker registry.`);const a=cloneDeep(r);for(const[f,p]of Object.entries(n))setNestedValue(a,f,p);a.general.random_seed=s;const u=new SimulationEngine({model:c,params:a});u.init();const l=[];let h=0;if(o.length>0&&o[0]<=0){const f=c.getSnapshot(u.getState());l.push({run_index:i,seed:s,time_h:0,sampled_params:n,data:f}),h=1}for(;!u.isComplete()&&h<o.length;){u.step();const f=u.getState(),p=f.t??0;for(;h<o.length&&p>=o[h];){const m=c.getSnapshot(f);l.push({run_index:i,seed:s,time_h:o[h],sampled_params:n,data:m}),h++}}return l}self.onmessage=e=>{const t=e.data;if(t.type==="run")try{const r=runSimulation(t),n={type:"complete",runIndex:t.runIndex,snapshots:r};self.postMessage(n)}catch(r){const n={type:"error",runIndex:t.runIndex,error:r instanceof Error?r.message:String(r)};self.postMessage(n)}}})();
//# sourceMappingURL=simulation.worker-i8ye_0yV.js.map
