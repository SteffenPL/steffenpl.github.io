(function(){"use strict";const f={w:100,h:100},x=.001,m=424242;function g(e,t,n){return Math.min(n,Math.max(t,e))}function F(e){let t=e;return()=>{t|=0,t=t+1831565813|0;let n=Math.imul(t^t>>>15,1|t);return n^=n+Math.imul(n^n>>>7,61|n),((n^n>>>14)>>>0)/4294967296}}function M(e){return e.map(t=>({x:t.x,y:t.y}))}function T(e){const t=new Float32Array(2*e.length);for(let n=0;n<e.length;n+=1)t[2*n]=e[n].x,t[2*n+1]=e[n].y;return t}function w(e,t,n=m){const o=F(n),s=[],i=1.95*t;for(let c=0;c<e;c+=1){let r=!1;for(let a=0;a<180;a+=1){const l={x:t+(f.w-2*t)*o(),y:t+(f.h-2*t)*o()};let u=!0;for(let y=0;y<s.length;y+=1){const h=s[y];if(Math.hypot(l.x-h.x,l.y-h.y)<i){u=!1;break}}if(u){s.push(l),r=!0;break}}r||s.push({x:t+(f.w-2*t)*o(),y:t+(f.h-2*t)*o()})}return s}function S(e,t){let n=0;const o=2*t;for(let s=0;s<e.length;s+=1){const i=e[s];for(let c=s+1;c<e.length;c+=1){const r=e[c],a=Math.hypot(i.x-r.x,i.y-r.y);a<o&&(n+=o-a)}}return n}function P(e,t){e.x=g(e.x,t,f.w-t),e.y=g(e.y,t,f.h-t)}function E(e,t,n,o){const s=.5*f.w,i=.5*f.h,c=.0125*n;for(let r=0;r<e.length;r+=1){const a=e[r];a.x+=t*(-c*(a.x-s)),a.y+=t*(-c*(a.y-i)),P(a,o)}}function v(e,t,n){let o=t.x-e.x,s=t.y-e.y,i=Math.hypot(o,s);const c=2*n;if(i>=c)return;i<1e-10&&(o=1,s=0,i=1);const r=c-i,a=o/i,l=s/i,u=.5*r;e.x-=u*a,e.y-=u*l,t.x+=u*a,t.y+=u*l}function b(e,t){for(let n=0;n<e.length;n+=1)for(let o=n+1;o<e.length;o+=1)v(e[n],e[o],t);for(let n=0;n<e.length;n+=1)P(e[n],t)}function j(e,t){const n=M(e);return{particles:n,t:0,dtCurrent:t.dtBase,pendingFrames:0,lastK:1,overlap:S(n,t.R)}}function N(e,t,n){const o=M(e.particles);return E(o,n,t.alpha,t.R),b(o,t.R),{particles:o,t:e.t+n,dtCurrent:n,pendingFrames:0,lastK:1,overlap:S(o,t.R)}}function B(e){return`N=${e.N}|R=${e.R.toFixed(4)}|a=${e.alpha.toFixed(4)}|T=${e.T.toFixed(4)}`}let d=0;const _=180,$=240;function p(e){self.postMessage(e)}self.onmessage=e=>{const t=e.data;if(!t||t.type!=="initReference")return;d+=1;const n=d,o=t.payload.params;if(B(o)!==t.payload.paramsSignature)return;const i=t.payload.seed??m,c=w(o.N,o.R,i);let r=j(c,o);const a=Math.ceil(o.T/x);let l=0,u=0,y=0,h=[T(r.particles)];p({type:"referenceProgress",payload:{ratio:0,maxComputedTime:0}});const k=()=>{if(n!==d)return;let C=0;for(;l<a&&C<_;){const D=Math.max(0,Math.min(x,o.T-r.t));if(D<=0)break;r=N(r,o,D),l+=1,C+=1,u+=1,h.push(T(r.particles)),u>=$&&(p({type:"referenceProgress",payload:{ratio:Math.min(1,l/Math.max(1,a)),maxComputedTime:r.t}}),u=0)}if(h.length>0&&(p({type:"referenceChunk",payload:{fromStep:y,statesChunk:h}}),y+=h.length,h=[]),l>=a||r.t>=o.T){p({type:"referenceProgress",payload:{ratio:1,maxComputedTime:o.T}}),p({type:"referenceDone"});return}setTimeout(k,0)};k()}})();
